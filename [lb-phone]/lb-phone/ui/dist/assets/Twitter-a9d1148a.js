import{r as i,$ as We,j as s,a as e,d as z,L as a,p as N,q as M,s as Y,C as x,u as te,E as J,_ as ne,a7 as se,a2 as X,ab as ae,F as b,ac as ge,cc as Oe,b as j,cd as _e,K as Q,aj as ve,ce as ye,a9 as Le,aD as oe,b0 as ke,cf as be,H as Fe,N as Se,m as Ie,ai as Ue,a3 as De,bW as xe,cg as Be,c0 as Me,ch as Ve,aM as Ae,ci as qe,cj as $e,ck as Re,cl as re,am as He,an as Ge,cm as je,cn as Ye,aa as ze,aP as Je,co as Ke,a4 as Qe,ba as Ne,bd as Xe,aw as Ze,P as Ce,A as et}from"./index-594e1857.js";import{T as de}from"./Textarea-251c47d2.js";import{S as tt}from"./Switch-ffaa3cda.js";const V={account:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,date_joined:162e10},accounts:{lb:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,date_joined:162e10,followers:13,following:2},breze:{username:"breze",name:"Breze",bio:"Developer @lb",verified:!1,date_joined:162e10,followers:0,following:0},loaf:{username:"loaf",name:"Loaf Scripts",bio:"Developer @lb",verified:!1,date_joined:162e10,followers:0,following:0}},tweets:[{user:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0},tweet:{id:"2",content:"LB Phone 2.0 is now released! Check it out at https://lbscripts.com",attachments:[],date_created:Date.now()-1e3*60*60*2,retweets:0,replies:1,likes:4,liked:!1,retweeted:!1,_replies:[{user:{username:"breze",name:"Breze"},tweet:{id:"4",content:"finally, been waiting for this for ages!",attachments:[],date_created:Date.now()-1e3*60*60*1,retweets:0,replies:0,likes:0,liked:!1,retweeted:!1}}]}},{user:{username:"breze",name:"Breze"},tweet:{id:"3",content:"wow, the birdy app really is cool",attachments:[],date_created:Date.now()-1e3*60*60*3,retweets:0,replies:0,likes:1,liked:!0,retweeted:!1}},{user:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0},tweet:{id:"1",content:"Hello, world!",attachments:[],date_created:Date.now()-1e3*60*60*5,retweets:0,replies:0,likes:0,liked:!1,retweeted:!1}}],notifications:[{type:"reply",username:"breze",name:"Breze",tweet_id:"2",content:"finally, been waiting for this for ages!",retweet_count:0,reply_count:0,like_count:0,timestamp:Date.now()-1e3*60*60*2},{type:"like",username:"loaf",name:"Loaf Scripts",tweet_id:"2",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3},{type:"follow",username:"breze",name:"Breze",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3}],messages:[{username:"breze",name:"Breze",content:"great job on the new update, really proud of you!",timestamp:Date.now()-1e3*60*60*4,messages:[{sender:"breze",name:"Breze",content:"great job on the new update, really proud of you!",attachments:[],timestamp:Date.now()-1e3*60*60*4}]},{username:"loaf",name:"Loaf Scripts",content:"thanks for responding, haha!",timestamp:Date.now()-1e3*60*60*24,messages:[{sender:"loaf",name:"Loaf Scripts",content:"thanks for responding, give me 5 mins..",attachments:[],timestamp:Date.now()-1e3*60*60*24},{sender:"lb",name:"LB",content:"no problem, happy to help!",attachments:[],timestamp:Date.now()-1e3*60*60*24+1e3},{sender:"loaf",name:"Loaf Scripts",content:"Hey LB, I have a question about the new update, can you help me?",attachments:[],timestamp:Date.now()-1e3*60*60*24+2e3}]}]};function ie(n){const{Func:c,User:E}=i.useContext(H),[r,g]=E;c.Profile;const[t,u]=c.LoggedIn,[h,w]=c.View,[m,A]=c.Timeline,S=()=>{N("AccountSwitcher",{action:"getAccounts",app:"Twitter"},null).then(v=>{var P;if(!v)return M("info","No accounts found");let _=r.isAdmin,o=(P=v==null?void 0:v.filter(I=>I!==r.username))==null?void 0:P.map(I=>({title:I,cb:()=>{N("AccountSwitcher",{action:"switch",app:"Twitter",account:I}).then(()=>{N("Twitter",{action:"isLoggedIn"}).then(p=>{p?(Y.APPS.TWITTER.account.set(p),g({...p,isAdmin:_}),w("timeline")):Y.APPS.TWITTER.account.set(!1)})})}}));x.ContextMenu.set({buttons:[{title:r.username},...o,{title:a("APPS.TWITTER.ADD_ACCOUNT"),cb:()=>{u(!1)}}]})})},f=We(()=>S(),{delay:250});return s("div",{className:"twitter-header",children:[s("div",{className:"twitter-header-top",children:[e("div",{...f,onClick:()=>c.fetchAndSetProfile(r.username),children:e("img",{className:"profile-picture",src:$(r.profile_picture)})}),n.search?e("div",{className:"search-container",children:e(z,{type:"text",placeholder:n.placeholder??a("APPS.TWITTER.SEARCH_TWITTER"),onChange:v=>n.search(v.target.value)})}):n.notifications?e("div",{className:"title",children:a("APPS.TWITTER.NOTIFICATIONS")}):e("div",{className:"logo",children:e("img",{src:"assets/img/icons/twitter/logo.png"})}),e("div",{})]}),h=="timeline"&&e("div",{className:"twitter-header-bottom",children:s("div",{className:"options",children:[e("div",{className:`option ${m==="default"?"active":""}`,onClick:()=>A("default"),children:a("APPS.TWITTER.ALL")}),e("div",{className:`option ${m==="following"?"active":""}`,onClick:()=>A("following"),children:a("APPS.TWITTER.FOLLOWING")})]})})]})}function st(n){const{Func:c,User:E}=i.useContext(H),r=te(j),[g]=E,t=n.data,[u,h]=i.useState([]),w=i.useRef(null),[m,A]=i.useState(0),[S,f]=i.useState(!1),[v,_]=i.useState(!1),o=i.useRef(0),[P,I]=i.useState({content:"",attachments:[]});i.useEffect(()=>{var l,W;J("Twitter")&&(f(!1),_(!1),A(0),h([]),N("Twitter",{action:"getMessages",data:{username:t.username,page:0}},(W=(l=V==null?void 0:V.messages)==null?void 0:l.find(d=>d.username===t.username))==null?void 0:W.messages).then(d=>{d&&h(d.reverse())}))},[]);const p=()=>{if(S||v)return;let l=document.querySelector("#last");if(!l)return;!Q(l)&&(_(!0),N("Twitter",{action:"getMessages",data:{page:m+1,username:t.username}},null).then(d=>{if(d&&d.length>0){let T=document.querySelector(".dm-message-container");o.current=T.scrollHeight,h([...d.reverse(),...u]),_(!1)}else f(!0)}),A(d=>d+1))};i.useEffect(()=>{let l=document.querySelector(".dm-message-container");const W=l.scrollHeight;l.scrollTop+=W-o.current,l.scroll},[u]);const C=()=>{if(P.content.length<=0&&P.attachments.length<=0)return;const l={sender:g.username,recipient:t.username,content:P.content,attachments:P.attachments,timestamp:new Date().getTime()};N("Twitter",{action:"sendMessage",data:l},!0).then(W=>{if(!W)return M("error","Failed to send message");w.current.value="",I({content:"",attachments:[]}),h([...u,l])})};return ne("twitter:newMessage",l=>{t.username===l.sender&&h([...u,l])}),s("div",{className:"slide left",children:[s("div",{className:"dm-header",children:[e("i",{className:"fal fa-arrow-left",onClick:()=>n.goBack()}),s("div",{className:"user",onClick:()=>c.fetchAndSetProfile(t.username),children:[e("div",{className:"profile-picture",children:e("img",{src:$(t.profile_picture)})}),s("div",{className:"name",children:[t.name,t.verified&&e("i",{className:"fas fa-badge-check verified"})]})]}),e("span",{})]}),e("div",{className:"dm-message-container",onScroll:p,children:e("div",{className:"message-body",children:u.map((l,W)=>{var D;let d,T=W===0?"last":"",F=l.sender===g.username?"self":"other",k=((D=u[W+1])==null?void 0:D.sender)===g.username?"self":"other";if(u[W+1]?d=Math.abs(l.timestamp-u[W+1].timestamp)/36e5:k=void 0,l.content.includes(".gif")){let O=l.content,L=O.split(" ").find(ee=>ee.includes(".gif"));l.content=O.replace(L,""),l.attachments.push(L)}return s("div",{className:`message ${F}`,id:T,children:[F=="other"?s("div",{className:"tweet-with-pfp",children:[e("div",{className:`profile-picture ${F!==k?"show":"hide"}`,children:e("img",{src:$(t.profile_picture)})}),s("div",{className:"tweet-content",children:[l.content&&e("div",{className:"content",children:se(l.content,!0)}),l.attachments.length>0&&e("div",{className:"attatchments",children:l.attachments.map((O,L)=>X(O)?e("video",{src:O,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:()=>{x.FullscreenImage.set(O)}},L):e(ae,{src:O,onClick:()=>{x.FullscreenImage.set(O)}},L))})]})]}):s(b,{children:[l.content&&e("div",{className:"content",children:se(l.content)}),l.attachments.length>0&&e("div",{className:"attatchments",children:l.attachments.map((O,L)=>X(O)?e("video",{src:O,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:()=>O},L):e(ae,{src:O,onClick:()=>{x.FullscreenImage.set(O)}},L))})]}),u[W+1]&&d>6?e("div",{className:"date",children:ge(l.timestamp)}):F!==k&&e("div",{className:"date",children:ge(l.timestamp)})]},W)})})}),e("div",{className:"attachments",children:P.attachments.map((l,W)=>s("div",{className:"attachment",children:[X(l)?e("video",{src:l,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e("img",{src:l}),e("i",{className:"fal fa-times",onClick:()=>{I({...P,attachments:P.attachments.filter((d,T)=>T!==W)})}})]}))}),s("div",{className:"message-bottom",children:[e(Oe,{onClick:()=>{var l,W,d;P.attachments.length<2&&x.Gallery.set({includeVideos:!0,allowExternal:(d=(W=(l=j)==null?void 0:l.value)==null?void 0:W.AllowExternal)==null?void 0:d.Birdy,onSelect:T=>I({...P,attachments:[...P.attachments,T.src]})})}}),r.EnableGIFs!==!1&&e("div",{className:"gif",onClick:()=>{x.Gif.set({onSelect:l=>I({...P,content:P.content.length>0?P.content+" "+l:l})})},children:"GIF"}),e(de,{placeholder:a("APPS.TWITTER.MESSAGE_PLACEHOLDER"),rows:3,value:P.content,onChange:l=>I({...P,content:l.target.value}),onKeyDown:l=>{l.key==="Enter"&&C()},ref:w}),e(_e,{className:"send",onClick:C})]})]})}function at(){const{Func:n,User:c}=i.useContext(H),[E]=c,[r,g]=i.useState(""),[t,u]=i.useState(""),[h,w]=i.useState([]),[m,A]=i.useState([]),[S,f]=i.useState(!1),[v,_]=n.DmUser;return i.useEffect(()=>{J("Twitter")&&N("Twitter",{action:"getRecentMessages",page:0},V.messages).then(o=>{if(!o)return M("error","Failed to fetch recent messages");A(o.filter(P=>P.username!==E.username))})},[]),i.useEffect(()=>{const o=setTimeout(()=>g(t),500);return()=>clearTimeout(o)},[t]),i.useEffect(()=>{r.length>0?S?N("Twitter",{action:"searchAccounts",query:r},Object.keys(V.accounts).filter(o=>o.toLowerCase().includes(r.toLowerCase()))).then(o=>{o&&w(o.filter(P=>P.username!==E.username))}):w(m.filter(o=>(o.username.includes(r)||o.name.includes(r))&&o.username!==E.username)):w([])},[r]),i.useEffect(()=>{g(""),w([])},[S]),e(b,{children:v&&v.username?e(st,{data:v,goBack:()=>_(null)}):s(b,{children:[e(ie,{search:o=>u(o),placeholder:a("APPS.TWITTER.SEARCH_DIRECT_MESSAGES")}),e("div",{className:"dms-container",children:r.length>0?e("div",{className:"dm-users",children:h.length>0?h.map(o=>s("div",{className:"item",onClick:()=>_(o),children:[s("div",{className:"data",children:[e("div",{className:"profile-picture",children:e("img",{src:$(o.profile_picture)})}),e("div",{className:"content",children:s("div",{className:"name",children:[e("span",{children:o.name}),s("span",{className:"username",children:["@",o.username]})]})})]}),e("div",{className:"timestamp",children:ve(o.timestamp)})]})):e("div",{className:"search-for",children:a("APPS.TWITTER.SEARCH_FOR").format({search:r})})}):e("div",{className:"dm-users",children:m.map(o=>(o.content&&(o.content.includes("imgur.com")||o.content.includes("tenor.com")||o.content.includes(".png"))&&(o.content=a("APPS.TWITTER.SENT_ATTACHMENT")),s("div",{className:"item",onClick:()=>_(o),children:[s("div",{className:"data",children:[e("div",{className:"profile-picture",onClick:P=>{P.stopPropagation(),n.fetchAndSetProfile(o.username)},children:e("img",{src:$(o.profile_picture)})}),s("div",{className:"content",children:[s("div",{className:"name",children:[e("span",{children:o.name}),s("span",{className:"username",children:["@",o.username]})]}),o.content&&e("div",{className:"text",children:o.content.length>30?o.content.substring(0,30)+"...":o.content})]})]}),e("div",{className:"timestamp",children:ve(o.timestamp)})]})))})}),e("div",{className:"new-tweet",onClick:()=>f(!0),children:e(ye,{})}),S&&s("div",{className:"new-message-container",children:[s("div",{className:"new-message-header",children:[e("div",{className:"cancel-text",onClick:()=>f(!1),children:a("APPS.TWITTER.CANCEL")}),e("div",{className:"title",children:a("APPS.TWITTER.NEW_MESSAGE")}),e("div",{})]}),s("div",{className:"new-message-body",children:[s("div",{className:"new-message-input",children:[a("APPS.TWITTER.TO"),":",e(z,{type:"text",maxLength:10,onChange:o=>g(o.target.value)})]}),e("div",{className:"results",children:h.map(o=>s("div",{className:"item",onClick:()=>_(o),children:[e("div",{className:"profile-picture",children:e("img",{src:$(o.profile_picture)})}),s("div",{className:"name",children:[s("span",{children:[o.name,o.verified&&e("i",{className:"fas fa-badge-check verified"})]}),s("span",{className:"username",children:["@",o.username]})]})]}))})]})]})]})})}function nt(){const{User:n,Func:c}=i.useContext(H),[E,r]=n,[g,t]=c.LoggedIn,[u,h]=i.useState(""),[w,m]=i.useState(1),[A,S]=i.useState(""),[f,v]=i.useState(""),[_,o]=i.useState(""),[P,I]=i.useState(null);i.useEffect(()=>{I(null)},[u,w]);const p=()=>{N("Twitter",{action:"login",data:{username:f,password:_}},{success:!!V.accounts[f],data:V.accounts[f]}).then(l=>{if(!(l!=null&&l.success))return I(l==null?void 0:l.error);N("isAdmin",null,!1).then(W=>{Y.APPS.TWITTER.account.set(l.data),r({...l.data,isAdmin:W}),t(!0)})})},C=()=>{let l=f.toLowerCase().replace(/\s/g,""),W=l.match(j.value.UsernameFilter);if(!W||(W==null?void 0:W[0])!==l){M("warning","Username did not match regex"),I("USERNAME_NOT_ALLOWED");return}N("Twitter",{action:"createAccount",data:{username:l.replace(/\s/g,""),password:_,name:A}},{success:!V.accounts[l]}).then(d=>{if(!(d!=null&&d.success))return I(d==null?void 0:d.error);let T={name:A,username:l,followers:0,following:0,date_joined:Math.floor(Date.now())};N("isAdmin",null,!1).then(F=>{Y.APPS.TWITTER.account.set(T),r({...T,isAdmin:F}),t(!0)})})};return i.useEffect(()=>{v(""),o("")},[u]),s("div",{className:"login-container",children:[u===""&&s(b,{children:[s("div",{className:"login-header",children:[e("div",{}),e("img",{src:"assets/img/icons/twitter/logo.png"}),e("div",{})]}),e("div",{className:"login-body",children:a("APPS.TWITTER.SIGN_UP_TEXT")}),s("div",{className:"create-account",children:[e("div",{className:"button",onClick:()=>h("register"),children:a("APPS.TWITTER.CREATE_ACCOUNT")}),e("div",{className:"text",children:a("APPS.TWITTER.TERMS_OF_SERVICE")})]}),s("div",{className:"login-text",children:[a("APPS.TWITTER.HAS_ACCOUNT"),e("span",{onClick:()=>h("login"),children:a("APPS.TWITTER.LOGIN")})]})]}),u==="register"&&s(b,{children:[s("div",{className:"login-header",children:[e("div",{className:"cancel",onClick:()=>{h(""),m(1)},children:a("APPS.TWITTER.CANCEL")}),e("div",{className:"profile-picture",children:e("img",{src:"assets/img/icons/twitter/logo.png"})}),e("div",{})]}),s("div",{className:"login",children:[e("div",{className:"text",children:a("APPS.TWITTER.CREATE_YOUR_ACCOUNT")}),e(z,{placeholder:a("APPS.TWITTER.NAME_PLACEHOLDER"),maxLength:30,onChange:l=>S(l.target.value)}),e(z,{className:"username",placeholder:a("APPS.TWITTER.USERNAME_PLACEHOLDER"),maxLength:15,onChange:l=>v(l.target.value.toLowerCase().replace(/\s/g,""))}),e(z,{type:"password",placeholder:a("APPS.TWITTER.PASSWORD_PLACEHOLDER"),maxLength:50,onChange:l=>o(l.target.value)}),P&&e("div",{className:"error-text",children:a(`APPS.TWITTER.${P}`)})]}),e("div",{className:"buttons",children:e("div",{className:`button ${_.length>0&&(f==null?void 0:f.length)>2?"active":""}`,onClick:()=>{_.length>0&&(f==null?void 0:f.length)>2&&C()},children:a("APPS.TWITTER.CREATE_ACCOUNT")})})]}),u==="login"&&s(b,{children:[s("div",{className:"login-header",children:[e("div",{className:"cancel",onClick:()=>{h(""),m(1)},children:a("APPS.TWITTER.CANCEL")}),e("div",{className:"profile-picture",children:e("img",{src:"assets/img/icons/twitter/logo.png"})}),e("div",{})]}),w===1&&s(b,{children:[s("div",{className:"login",children:[e("div",{className:"text",children:a("APPS.TWITTER.GET_STARTED")}),e(z,{placeholder:a("APPS.TWITTER.USERNAME_PLACEHOLDER"),maxLength:15,onChange:l=>v(l.target.value)})]}),s("div",{className:"footer",children:[e("div",{className:"forgot",children:a("APPS.TWITTER.FORGOT_PASSWORD")}),e("div",{className:`button ${f.length>2?"active":""}`,onClick:()=>{f.length>2&&m(w+1)},children:a("APPS.TWITTER.NEXT")})]})]}),w===2&&s(b,{children:[s("div",{className:"login",children:[e("div",{className:"text",children:a("APPS.TWITTER.ENTER_PASSWORD")}),e(z,{placeholder:a("APPS.TWITTER.USERNAME_PLACEHOLDER"),defaultValue:f,maxLength:15,type:"text",onChange:l=>v(l.target.value)}),e(z,{placeholder:a("APPS.TWITTER.PASSWORD_PLACEHOLDER"),type:"password",onChange:l=>o(l.target.value)}),e("div",{className:"error-text",children:a(`APPS.TWITTER.${P}`)})]}),e("div",{className:"buttons",children:e("div",{className:Le("button",_&&(f==null?void 0:f.length)>2&&"active"),onClick:()=>{_&&(f==null?void 0:f.length)>2&&p()},children:a("APPS.TWITTER.LOGIN")})})]})]})]})}function Z({data:n,last:c,pinned:E}){const{User:r,Func:g}=i.useContext(H),t=te(j),[u]=r,[h,w]=g.Tweet,[m,A]=g.View,[S,f]=g.Update;i.useState(!1);const v=i.useRef([]),[_,o]=i.useState(null),[P,I]=i.useState([]),[p,C]=i.useState({retweeted:!1,liked:!1}),[l,W]=i.useState({likes:0,retweets:0,replies:0});return i.useEffect(()=>{var d;if((d=n==null?void 0:n.tweet)!=null&&d.attachments)if(Array.isArray(n.tweet.attachments))I(n.tweet.attachments);else{const T=JSON.parse(n.tweet.attachments);T&&Array.isArray(T)&&I(JSON.parse(n.tweet.attachments))}C({retweeted:n.tweet.retweeted,liked:n.tweet.liked}),W({likes:n.tweet.likes,retweets:n.tweet.retweets,replies:n.tweet.replies})},[n]),i.useEffect(()=>{if(!J("Twitter"))return;if(!P||!v.current||v.current.length===0)return M("info","No attachments or video refs");const d=v.current.map(T=>{if(!T)return null;const F=new IntersectionObserver(k=>{k.forEach(D=>{D.isIntersecting?D.target.play().catch(O=>{M("error","Failed to play video",O)}):D.target.pause()})},{threshold:.5});return F.observe(T),F}).filter(Boolean);return()=>{d.forEach(T=>T.disconnect())}},[P]),ne("twitter:updateTweetData",d=>{d.tweetId===n.tweet.id&&W(T=>({...T,[d.data]:d.increment?T[d.data]+1:T[d.data]-1}))}),i.useEffect(()=>{if(n.tweet.date_created){let T=new Date(n.tweet.date_created),F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],k=T.getDate(),D=F[T.getMonth()],O=T.getFullYear();var d=Math.floor(new Date().getTime()-T.getTime())/1e3;d<0&&(d=1),O!==new Date().getFullYear()&&o(`${D} ${k}, ${O}`);let L=d/86400;return L>1?o(`${D} ${k}`):(L=d/3600,L>1?o(`${Math.floor(L)}h`):(L=d/60,L>1?o(`${Math.floor(L)}m`):o(`${Math.floor(L*60)}s`)))}},[n]),e(b,{children:n&&e(b,{children:s("div",{className:"tweet",id:c?"last":"",onClick:()=>{w(n),A("tweet")},children:[E&&s("div",{className:"pinned",children:[e("i",{className:"fas fa-thumbtack"})," Pinned Tweet"]}),n.tweet.retweetedByUsername&&s("div",{className:"retweeted",onClick:d=>{d.stopPropagation(),g.fetchAndSetProfile(n.tweet.retweetedByUsername)},children:[e("i",{className:"far fa-retweet"}),n.tweet.retweetedByName," ",a("APPS.TWITTER.RETWEETED")]}),s("div",{className:"tweet-body",children:[e("div",{className:"profile-picture",children:e("img",{src:$(n.user.profile_picture),onClick:d=>{d.stopPropagation(),g.fetchAndSetProfile(n.user.username)}})}),s("div",{className:"tweet-content",children:[s("div",{className:"tweet-header",onClick:d=>{d.stopPropagation(),g.fetchAndSetProfile(n.user.username)},children:[s("div",{className:"user",children:[e("span",{className:"name",children:n.user.name}),n.user.private&&e(oe,{}),n.user.verified&&e("i",{className:"fas fa-badge-check verified"}),s("span",{className:"username",children:["@",n.user.username]}),e("span",{className:"time",children:_})]}),(u.username===n.user.username||u.isAdmin)&&e("div",{className:"dots",children:e(ke,{onClick:d=>{var F;d.stopPropagation();let T=[u.username===n.user.username&&{title:E?a("APPS.TWITTER.UNPIN"):a("APPS.TWITTER.PIN"),cb:()=>{N("Twitter",{action:"pinTweet",tweet_id:n.tweet.id,toggle:!E},!0).then(k=>{if(!k)return M("error","Failed to pin tweet");if(E)return E=!1})}},{title:a("APPS.TWITTER.DELETE_POPUP.TITLE"),color:"red",cb:()=>{x.PopUp.set({title:a("APPS.TWITTER.DELETE_POPUP.TITLE"),description:a("APPS.TWITTER.DELETE_POPUP.DESCRIPTION"),buttons:[{title:a("APPS.TWITTER.DELETE_POPUP.CANCEL")},{title:a("APPS.TWITTER.DELETE_POPUP.PROCEED"),color:"red",cb:()=>{N("Twitter",{action:"deleteTweet",tweet_id:n.tweet.id},!0).then(()=>{f(!0)})}}]})}}].filter(Boolean);(F=t==null?void 0:t.PromoteBirdy)!=null&&F.Enabled&&!n.tweet.replyToId&&n.user.username===u.username&&T.push({title:a("APPS.TWITTER.PROMOTE"),cb:()=>{var k,D,O;x.PopUp.set({title:a("APPS.TWITTER.PROMOTE_POPUP.TITLE"),description:a("APPS.TWITTER.PROMOTE_POPUP.DESCRIPTION").format({price:t.CurrencyFormat.replace("%s",(D=(k=j)==null?void 0:k.value.PromoteBirdy)==null?void 0:D.Cost.toString()),views:(O=j)==null?void 0:O.value.PromoteBirdy.Views}),buttons:[{title:a("APPS.TWITTER.PROMOTE_POPUP.CANCEL")},{title:a("APPS.TWITTER.PROMOTE_POPUP.PROCEED"),cb:()=>{N("Twitter",{action:"promoteTweet",tweet_id:n.tweet.id},!0).then(L=>{n.tweet.promoted=!0})}}]})}}),x.ContextMenu.set({buttons:T})}})})]}),n.tweet.replyToId&&e("div",{className:"replying-to",onClick:d=>{d.stopPropagation(),N("Twitter",{action:"getTweet",tweetId:n.tweet.replyToId},V.tweets.find(T=>T.tweet.id===n.tweet.replyToId)).then(T=>{T&&T.tweet&&(w(T),A("tweet"))})},children:a("APPS.TWITTER.REPLYING_TO").format({name:`@${n.tweet.replyToAuthor}`})}),e("div",{className:"text",children:se(n.tweet.content,!0,(d,T)=>{T.stopPropagation(),g.fetchAndSetProfile(d)})}),(P==null?void 0:P.length)>0&&e("div",{className:"attatchments",children:P==null?void 0:P.map((d,T)=>e("div",{className:"attatchment",onClick:F=>{F.stopPropagation(),x.FullscreenImage.set(d)},children:X(d)?e("video",{src:d,muted:!0,controls:!1,loop:!0,autoPlay:!0,ref:F=>{v.current&&(v.current[T]=F)}}):e(ae,{src:d})},T))}),s("div",{className:"actions",children:[s("div",{className:"action comment",children:[e("i",{className:"far fa-comment"}),l.replies]}),s("div",{className:`action retweet ${p.retweeted?"active":""}`,children:[e("i",{className:"fal fa-retweet",onClick:d=>{d.stopPropagation(),x.PopUp.set({title:p.retweeted?a("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):a("APPS.TWITTER.RETWEET_POPUP.RETWEET"),description:a("APPS.TWITTER.RETWEET_POPUP.DESCRIPTION").format({action:p.retweeted?a("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):a("APPS.TWITTER.RETWEET_POPUP.RETWEET")}),buttons:[{title:a("APPS.TWITTER.RETWEET_POPUP.CANCEL")},{title:a("APPS.TWITTER.RETWEET_POPUP.PROCEED"),cb:()=>{N("Twitter",{action:"toggleRetweet",tweet_id:n.tweet.id,retweeted:!p.retweeted},!p.retweeted).then(T=>{C({...p,retweeted:T})})}}]})}}),l.retweets]}),s("div",{className:`action like ${p.liked?"active":""}`,children:[e("i",{className:"fal fa-heart",onClick:d=>{d.stopPropagation(),N("Twitter",{action:"toggleLike",tweet_id:n.tweet.id,liked:!p.liked},!p.liked).then(T=>{C({...p,liked:T})})}}),l.likes]})]}),n.tweet.promoted&&s("div",{className:"promoted",children:[e(be,{})," ",a("APPS.TWITTER.PROMOTED")]})]})]})]})})})}const ce=Fe(!1);function it(){const n=te(ce),[c,E]=i.useState(null),[r,g]=i.useState(0),[t,u]=i.useState(!1),[h,w]=i.useState(!1);return i.useEffect(()=>{J("Twitter")&&N("Twitter",{action:"getNotifications",page:0},{requests:[],notifications:V.notifications}).then(A=>{if(!A)return M("warning","Failed to fetch notifications");E(A)})},[]),s(b,{children:[e(ie,{notifications:!0}),e(Se,{children:n&&e(rt,{})}),s("div",{className:"notifications-container",onScroll:()=>{if(t||h)return;let A=document.querySelector("#last");if(!A)return;!Q(A)&&(w(!0),N("Twitter",{action:"getNotifications",page:r+1},null).then(f=>{f?(E(v=>({notifications:[...v.notifications,...f.notifications],requests:f.requests})),w(!1)):u(!0)}),g(f=>f+1))},children:[c!=null&&c.requests&&(c==null?void 0:c.requests)>0?s("div",{className:"notification-item follow",onClick:()=>ce.set(!0),children:[e("i",{className:"fas fa-user"}),e("div",{className:"content",children:s("div",{className:"title",children:[e("span",{children:c.requests})," ",a("APPS.TWITTER.FOLLOWER_REQUESTS")]})})]}):null,c==null?void 0:c.notifications.map((A,S)=>{let f=S===(c==null?void 0:c.notifications.length)-1?"last":"";return e(lt,{notification:A,last:f})})]})]})}const lt=({notification:n,last:c})=>{var r,g;const E=n.type;return s("div",{className:`notification-item ${E}`,id:c,children:[E==="like"&&s(b,{children:[e("img",{className:"icon",src:"./assets/img/icons/twitter/heart.svg"}),s("div",{className:"content",children:[e("div",{className:"profile-pictures",children:e("img",{src:$(n.profile_picture)})}),s("div",{className:"title",children:[e("span",{children:n.name})," ",a("APPS.TWITTER.LIKED_TWEET")]}),n.content&&e("div",{className:"tweet-content",children:((r=n.content)==null?void 0:r.length)>100?n.content.substring(0,100)+"...":n.content})]})]}),E==="retweet"&&s(b,{children:[e("i",{className:"fas fa-repeat"}),s("div",{className:"content",children:[e("div",{className:"profile-pictures",children:e("img",{src:$(n.profile_picture)})}),s("div",{className:"title",children:[e("span",{children:n.name})," ",a("APPS.TWITTER.RETWEETED_TWEET")]}),n.content&&e("div",{className:"tweet-content",children:((g=n.content)==null?void 0:g.length)>100?n.content.substring(0,100)+"...":n.content})]})]}),E==="follow"&&s(b,{children:[e("i",{className:"fas fa-user"}),s("div",{className:"content",children:[e("div",{className:"profile-pictures",children:e("img",{src:$(n.profile_picture)})}),s("div",{className:"title",children:[e("span",{children:n.name})," ",a("APPS.TWITTER.FOLLOWED")]})]})]}),E==="reply"&&e(Z,{data:{user:{profile_picture:n.profile_picture,name:n.name,username:n.username,verified:n.verified},tweet:{id:n.tweet_id,content:n.content,attachments:n.attachments,replies:n.reply_count,retweets:n.retweet_count,likes:n.like_count,liked:n.liked??!1,retweeted:n.retweeted??!1,date_created:n.timestamp,replyToId:n.replyToId,replyToAuthor:n.replyToAuthor}}})]})},rt=()=>{const{Func:n}=i.useContext(H),[c,E]=i.useState([]),[r,g]=i.useState(0),[t,u]=i.useState(!1),[h,w]=i.useState(!1);i.useEffect(()=>{J("Twitter")&&N("Twitter",{action:"getFollowRequests",page:0},null).then(S=>{if(!S)return M("warning","Failed to fetch follow requests");M("info","Fetched follow requests",S),E(S)})},[]);const m=()=>{if(t||h)return;let S=document.querySelector("#lastrequest");if(!S)return;!Q(S)&&(w(!0),N("Twitter",{action:"getFollowRequests",page:r+1},null).then(v=>{v&&(v==null?void 0:v.length)>0?(E(v),w(!1)):u(!0)}),g(v=>v+1))},A=(S,f)=>{if(!S||f===void 0)return M("warning","No username / accept provided as an argument, cancelling request");N("Twitter",{action:"handleFollowRequest",username:S,accept:f}).then(v=>{if(!v)return M("warning","Failed to handle follow request");E(_=>_.filter(o=>o.username!==S))})};return e(b,{children:s(Ie.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"userpanel-container requests",children:[s("div",{className:"userpanel-header",children:[e("div",{onClick:()=>ce.set(!1),children:e("i",{className:"far fa-arrow-left"})}),e("div",{className:"userpanel-title",children:a("APPS.TWITTER.FOLLOWER_REQUESTS")}),e("div",{})]}),e("div",{className:"items",onScroll:m,children:c.map((S,f)=>{let v=f===c.length-1?"lastrequest":"";return s("div",{id:v,className:"item",children:[s("div",{className:"item-header",children:[s("div",{className:"user",onClick:()=>n.fetchAndSetProfile(S.username),children:[e("div",{className:"profile-picture",children:e("img",{src:$(S.profile_picture)})}),s("div",{className:"name",children:[e("span",{children:S.name}),s("span",{className:"username",children:["@",S.username]})]}),S.isFollowingYou&&e("div",{className:"follows",children:a("APPS.TWITTER.FOLLOWS_YOU")})]}),s("div",{className:"actions",children:[e(Ue,{className:"primary",onClick:_=>{_.stopPropagation(),A(S.username,!0)}}),e(De,{className:"red",onClick:_=>{_.stopPropagation(),A(S.username,!1)}})]})]}),e("div",{className:"item-footer",children:S.bio})]},f)})})]})})};function ct(){const{Func:n}=i.useContext(H),[c,E]=n.View;return e("div",{className:"footer",children:[{value:"timeline",activeIcon:e(xe,{}),icon:e(Be,{})},{value:"search",activeIcon:e(Me,{}),icon:e(Ve,{})},{value:"notifications",activeIcon:e(Ae,{}),icon:e(qe,{})},{value:"dmlist",activeIcon:e($e,{}),icon:e(Re,{})}].map((g,t)=>{let u=c==g.value;return e("div",{"data-active":u,onClick:()=>E(g.value),children:u?g.activeIcon:g.icon},t)})})}function ot(){var o;const{User:n,Func:c,UserPanel:E}=i.useContext(H),[r,g]=E,[t,u]=i.useState([]),[h,w]=i.useState(0),[m,A]=i.useState(!1),[S,f]=i.useState(!1);let v={[a("APPS.TWITTER.FOLLOWING")]:"getFollowing",[a("APPS.TWITTER.FOLLOWERS")]:"getFollowers",[a("APPS.TWITTER.LIKED_BY")]:"getLikes",[a("APPS.TWITTER.RETWEETED_BY")]:"getRetweeters"};i.useEffect(()=>{J("Twitter")&&N("Twitter",{action:v[r.data.title],data:{tweet_id:r.data.tweet_id,username:r.data.username,page:0}}).then(P=>{u(P)})},[]);const _=()=>{if(m||S)return;!Q(document.querySelector("#last"))&&(f(!0),N("Twitter",{action:v[r.data.title],data:{tweet_id:r.data.tweet_id,username:r.data.username,page:h+1}}).then(I=>{I&&I.length>0?(u([...t,...I]),f(!1)):A(!0)}),w(I=>I+1))};return e(b,{children:s("div",{className:"userpanel-container",children:[s("div",{className:"userpanel-header",children:[e("div",{onClick:()=>{var P;(P=r.data)==null||P.cb(),g({display:!1,data:null})},children:e("i",{className:"far fa-arrow-left"})}),e("div",{className:"userpanel-title",children:(o=r==null?void 0:r.data)==null?void 0:o.title}),e("div",{})]}),e("div",{className:"items",onScroll:_,children:t.map((P,I)=>{let p=I===t.length-1;return e(dt,{account:P,last:p})})})]})})}const dt=n=>{const{User:c,Func:E}=i.useContext(H),[r,g]=c,t=n.account,u=n.last,[h,w]=i.useState(t.isFollowing);return e("div",{className:"item",id:u?"last":"",children:s(b,{children:[s("div",{className:"item-header",children:[s("div",{className:"user",onClick:()=>E.fetchAndSetProfile(t.username),children:[e("div",{className:"profile-picture",children:e("img",{src:$(t.profile_picture)})}),s("div",{className:"name",children:[e("span",{children:t.name}),s("span",{className:"username",children:["@",t.username]})]}),t.isFollowingYou&&e("div",{className:"follows",children:a("APPS.TWITTER.FOLLOWS_YOU")})]}),e("div",{className:"action",onClick:()=>{t.username!==r.username&&(h?x.PopUp.set({title:a("APPS.TWITTER.UNFOLLOW_POPUP.TITLE"),description:a("APPS.TWITTER.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:a("APPS.TWITTER.UNFOLLOW_POPUP.CANCEL")},{title:a("APPS.TWITTER.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Twitter",{action:"toggleFollow",data:{username:t.username,following:!h}},!0).then(()=>{w(m=>!m)})}}]}):N("Twitter",{action:"toggleFollow",data:{username:t.username,following:!h}},!0).then(m=>{w(A=>!A)}))},children:t.username===r.username?e("div",{className:"following",children:a("APPS.TWITTER.YOU")}):h?e("div",{className:"following",children:a("APPS.TWITTER.FOLLOWING")}):e("div",{className:"follow",children:a("APPS.TWITTER.FOLLOW")})})]}),e("div",{className:"item-footer",children:t.bio})]})})};function ut(){var he,fe,Pe,we,pe,Ee;const{User:n,Func:c,UserPanel:E}=i.useContext(H),[r,g]=n,[t,u]=c.Profile,[h,w]=E,[m,A]=c.Update,[S,f]=c.LoggedIn,[v,_]=c.DmUser,[o,P]=c.View,[I,p]=i.useState("tweets"),[C,l]=i.useState([]),[W,d]=i.useState(null),[T,F]=i.useState(null),[k,D]=i.useState(!1),[O,L]=i.useState(0),[ee,y]=i.useState(!1),[U,G]=i.useState(!1);i.useEffect(()=>{J("Twitter")&&(l([]),A(!1),y(!1),G(!1),L(0),N("Twitter",{action:"getTweets",page:0,filter:{type:I==="tweets"?"user":I,username:t.username}},V.tweets.filter(R=>{var q,B;switch(I){case"tweets":return R.user.username===t.username;case"replies":return(B=(q=R.tweet)==null?void 0:q._replies)==null?void 0:B.find(K=>K.tweet.username===t.username);case"media":return R.tweet.attachments.length>0&&R.user.username===t.username;case"liked":return[];default:return[]}})).then(R=>{l(R)}))},[I,m]);const le=()=>{if(ee||U)return;let R=document.querySelector("#last");if(!R)return;!Q(R)&&(G(!0),N("Twitter",{action:"getTweets",page:O+1,filter:{type:I==="tweets"?"user":I,username:t.username}},null).then(B=>{B&&B.length>0?(l([...C,...B]),G(!1)):y(!0)}),L(B=>B+1))};i.useEffect(()=>{var R;if(t.date_joined){const q=new Date(t.date_joined);let B=q.toLocaleDateString((R=j.value)==null?void 0:R.DateLocale,{month:"long"}),K=q.getFullYear();d(`${B} ${K}`),F($(t.profile_picture)),r.username===t.username&&g({...r,...t})}},[t]);const me=i.useRef(!0);i.useEffect(()=>{if(me.current){me.current=!1;return}N("Twitter",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}})},[t.isFollowing]),ne("twitter:updateProfileData",R=>{R.username===t.username&&u({...t,[R.data]:R.increment?t[R.data]+1:t[R.data]-1})});const Te={tweets:a("APPS.TWITTER.TWEETS"),replies:a("APPS.TWITTER.REPLIES"),media:a("APPS.TWITTER.MEDIA"),liked:a("APPS.TWITTER.LIKES")};return s(b,{children:[k&&s("div",{className:"edit-profile-container",children:[s("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>D(!1),children:a("APPS.TWITTER.CANCEL")}),e("div",{className:"title",children:a("APPS.TWITTER.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>{N("Twitter",{action:"updateProfile",data:{name:t.name,bio:t.bio,profile_picture:t.profile_picture,header:t.header,private:t.private}},!0).then(R=>{if(!R)return M("warning","Could not save profile, updateProfile did not callback");D(!1),Y.APPS.TWITTER.account.set(t)})},children:a("APPS.TWITTER.SAVE")})]}),e("div",{className:"banner-wrapper",children:t.header?s(b,{children:[e("img",{className:"profile-banner",src:t.header,onClick:()=>{var R,q,B;x.Gallery.set({allowExternal:(B=(q=(R=j)==null?void 0:R.value)==null?void 0:q.AllowExternal)==null?void 0:B.Birdy,onSelect:K=>u({...t,header:K.src})})}}),e(re,{})]}):e("div",{className:"profile-banner",onClick:()=>{var R,q,B;x.Gallery.set({allowExternal:(B=(q=(R=j)==null?void 0:R.value)==null?void 0:q.AllowExternal)==null?void 0:B.Birdy,onSelect:K=>u({...t,header:K.src})})},children:e(re,{})})}),s("div",{className:"profile-info",children:[s("div",{className:"logo",onClick:()=>{var R,q,B;x.Gallery.set({allowExternal:(B=(q=(R=j)==null?void 0:R.value)==null?void 0:q.AllowExternal)==null?void 0:B.Birdy,onSelect:K=>u({...t,profile_picture:K.src})})},children:[e("div",{style:{backgroundImage:`url(${t.profile_picture??T})`}}),e(re,{})]}),s("div",{className:"items",children:[s("div",{className:"item",children:[a("APPS.TWITTER.NAME"),e(z,{onChange:R=>u({...t,name:R.target.value}),defaultValue:t.name})]}),s("div",{className:"item",children:[a("APPS.TWITTER.BIO"),e(de,{onChange:R=>u({...t,bio:R.target.value}),rows:2,maxLength:100,defaultValue:t.bio})]}),s("div",{className:"item",children:[a("APPS.TWITTER.JOIN_DATE"),e(z,{disabled:!0,value:W})]}),s("div",{className:"item",children:[a("APPS.TWITTER.PROTECTED_POSTS"),e(tt,{checked:t.private,onChange:()=>u({...t,private:!t.private})})]})]}),s("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{x.PopUp.set({title:a("APPS.TWITTER.SIGN_OUT_POPUP.TITLE"),description:a("APPS.TWITTER.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:a("APPS.TWITTER.SIGN_OUT_POPUP.CANCEL")},{title:a("APPS.TWITTER.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{N("Twitter",{action:"signOut"},!0).then(()=>{f(!1),Y.APPS.TWITTER.account.set(!1)})}}]})},children:e("div",{children:a("APPS.TWITTER.SIGN_OUT")})}),((Pe=(fe=(he=j)==null?void 0:he.value)==null?void 0:fe.ChangePassword)==null?void 0:Pe.Birdy)&&e("div",{className:"button red",onClick:()=>He("Twitter",()=>{}),children:e("div",{children:a("APPS.TWITTER.CHANGE_PASSWORD")})}),((Ee=(pe=(we=j)==null?void 0:we.value)==null?void 0:pe.DeleteAccount)==null?void 0:Ee.Birdy)&&e("div",{className:"button red",onClick:()=>{Ge("Twitter",()=>{f(null),g(null),Y.APPS.TWITTER.account.set(null)})},children:e("div",{children:a("APPS.TWITTER.DELETE_ACCOUNT")})})]})]})]}),s("div",{className:"profile",children:[s("div",{className:"profile-header",children:[t.header?e(ae,{src:t.header}):e("div",{}),e("div",{className:"go-back",onClick:()=>P("timeline"),children:e(je,{})})]}),s("div",{className:"profile-details",children:[s("div",{className:"top",children:[e("div",{className:"profile-picture",children:e("img",{src:T})}),e("div",{className:"action-buttons",children:s(b,{children:[t.username!==r.username&&s(b,{children:[e("div",{className:"button",onClick:()=>{_({username:t.username,name:t.name,profile_picture:T,verified:t.verified}),P("dmlist")},children:e(Re,{})}),t.isFollowing&&e("div",{className:"button",onClick:()=>{x.PopUp.set({title:a("APPS.TWITTER.NOTIFICATIONS_POPUP.TITLE"),description:a("APPS.TWITTER.NOTIFICATIONS_POPUP.DESCRIPTION").format({action:(t.notificationsEnabled?a("APPS.TWITTER.NOTIFICATIONS_POPUP.DISABLE"):a("APPS.TWITTER.NOTIFICATIONS_POPUP.ENABLE")).toLowerCase(),name:t.username}),buttons:[{title:a("APPS.TWITTER.NOTIFICATIONS_POPUP.CANCEL")},{title:a("APPS.TWITTER.NOTIFICATIONS_POPUP.PROCEED"),color:t.notificationsEnabled?"red":null,cb:()=>{N("Twitter",{action:"toggleNotifications",data:{username:t.username,toggle:!t.notificationsEnabled}},!t.notificationsEnabled).then(R=>u({...t,notificationsEnabled:R}))}}]})},children:t.notificationsEnabled?e(Ae,{}):e(Ye,{})})]}),t.username===r.username?e("div",{className:"edit",onClick:()=>D(!0),children:a("APPS.TWITTER.EDIT_PROFILE")}):t.isFollowing?e("div",{className:"following",onClick:()=>{x.PopUp.set({title:a("APPS.TWITTER.UNFOLLOW_POPUP.TITLE"),description:a("APPS.TWITTER.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:a("APPS.TWITTER.UNFOLLOW_POPUP.CANCEL")},{title:a("APPS.TWITTER.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{u({...t,isFollowing:!1,notificationsEnabled:!1})}}]})},children:a("APPS.TWITTER.FOLLOWING")}):e(b,{children:e("div",{className:"follow",onClick:()=>{t.private?N("Twitter",{action:"toggleFollow",data:{username:t.username,following:!0}},!0).then(R=>{R&&u({...t,requested:!t.requested})}):u({...t,isFollowing:!0})},children:t.requested?a("APPS.TWITTER.PENDING"):a("APPS.TWITTER.FOLLOW")})})]})})]}),s("div",{className:"profile-bottom",children:[s("div",{className:"name-area",children:[s("span",{className:"name",children:[t.name," ",t.verified&&e("i",{className:"fas fa-badge-check verified"}),t.private&&e(oe,{})]}),s("span",{className:"username",children:["@",t.username,t.isFollowingYou&&e("div",{className:"follows",children:a("APPS.TWITTER.FOLLOWS_YOU")})]})]}),e("div",{className:"bio",children:se(t.bio,!0)}),s("div",{className:"joindate",children:[e("i",{className:"far fa-calendar-alt"}),a("APPS.TWITTER.JOINED").format({date:W})]}),s("div",{className:"stats",children:[s("div",{"data-disabled":!t.isFollowing&&t.private&&t.username!==r.username,onClick:()=>{!t.isFollowing&&t.private&&t.username!==r.username||w({display:!0,data:{title:a("APPS.TWITTER.FOLLOWING"),username:t.username,cb:()=>c.fetchAndSetProfile(t.username)}})},children:[e("span",{children:t.following})," ",a("APPS.TWITTER.FOLLOWING")]}),s("div",{"data-disabled":!t.isFollowing&&t.private&&t.username!==r.username,onClick:()=>{!t.isFollowing&&t.private&&t.username!==r.username||w({display:!0,data:{title:a("APPS.TWITTER.FOLLOWERS"),username:t.username,cb:()=>c.fetchAndSetProfile(t.username)}})},children:[e("span",{children:t.followers})," ",a("APPS.TWITTER.FOLLOWERS")]})]}),!(!t.isFollowing&&t.private&&t.username!==r.username)&&e("div",{className:"categories",children:Object.keys(Te).map(R=>e("div",{className:`category ${I===R?"active":""}`,onClick:()=>p(R),children:Te[R]},R))})]})]}),!t.isFollowing&&t.private&&t.username!==r.username?s("div",{className:"protected-tweets-container",children:[e("div",{className:"title",children:a("APPS.TWITTER.PROTECTED_TWEETS_TITLE")}),e("div",{className:"description",children:a("APPS.TWITTER.PROTECTED_TWEETS_DESCRIPTION").format({username:t.username})})]}):e("div",{className:"profile-tweets-container",children:s("div",{className:"tweets",onScroll:le,children:[t.pinnedTweet&&I==="tweets"&&e(Z,{data:t.pinnedTweet,pinned:!0}),C.map((R,q)=>{let B=q===C.length-1;return e(Z,{data:R,last:B})})]})})]})]})}function mt(){const{Func:n}=i.useContext(H),[c,E]=i.useState(""),[r,g]=i.useState(""),[t,u]=i.useState([]),[h,w]=i.useState([]),[m,A]=i.useState(""),[S,f]=i.useState(0),[v,_]=i.useState(!1),[o,P]=i.useState(!1);i.useEffect(()=>{J("Twitter")&&N("Twitter",{action:"getRecentHashtags"}).then(p=>{p&&w(p)})},[]),i.useEffect(()=>{const p=setTimeout(()=>E(r),500);return()=>clearTimeout(p)},[r]),i.useEffect(()=>{c.length>0&&N("Twitter",{action:"searchAccounts",query:c},Object.keys(V.accounts).filter(p=>p.toLowerCase().includes(c.toLowerCase())||V.accounts[p].name.toLowerCase().includes(c.toLowerCase())).map(p=>V.accounts[p])).then(p=>{p&&u(p)})},[c]);const I=()=>{if(v||o||m.length===0)return;let p=document.querySelector("#last");if(!p)return;!Q(p)&&(P(!0),N("Twitter",{action:"searchTweets",query:m,page:S+1},null).then(l=>{l&&l.length>0?(u([...t,...l]),P(!1)):_(!0)}),f(l=>l+1))};return s(b,{children:[e(ie,{search:p=>g(p)}),e("div",{className:"searchpage-container",children:c.length>0||m.length>0?e(b,{children:e("div",{className:"search-results",onScroll:I,children:t.length>0?t.map(p=>{if(p.tweet){let C=t.length-1===t.indexOf(p);return e(Z,{data:p,last:C})}else{let C=p;return s("div",{className:"item",onClick:()=>n.fetchAndSetProfile(C.username),children:[e("div",{className:"profile-picture",children:e("img",{src:$(C.profile_picture)})}),s("div",{className:"name",children:[s("span",{children:[C.name,C.verified&&e("i",{className:"fas fa-badge-check verified"}),C.private&&e(oe,{})]}),s("span",{className:"username",children:["@",C.username]})]})]})}}):e("div",{className:"search-for",children:a("APPS.TWITTER.SEARCH_FOR").format({search:c})})})}):s(b,{children:[s("div",{className:"twitter-banner",children:[e("img",{src:"./assets/img/icons/twitter/banner.png"}),e("div",{className:"text",children:a("APPS.TWITTER.START_SEARCHING")})]}),h.length>0&&s("div",{className:"recent-hashtags",children:[e("div",{className:"title",children:a("APPS.TWITTER.TRENDING_HASHTAGS")}),e("div",{className:"hashtags",children:h.map(p=>s("div",{className:"item",children:[s("div",{className:"hashtag",onClick:()=>{N("Twitter",{action:"searchTweets",query:p.hashtag,page:0}).then(C=>{C&&(A(p.hashtag),u(C))})},children:["#",p.hashtag]}),s("div",{className:"uses",children:[ze(p.uses,!0)," ",p.uses>1?"Tweets":"Tweet"]})]}))})]})]})})]})}function ue(n){var t,u;const{User:c}=i.useContext(H),[E]=c,[r,g]=i.useState({content:"",attachments:(t=n.data)!=null&&t.attachments?(u=n.data)==null?void 0:u.attachments:[]});return s("div",{className:"new-tweet-container",children:[s("div",{className:"new-tweet-header",children:[e("div",{className:"cancel-text",onClick:()=>n.goBack(),children:a("APPS.TWITTER.CANCEL")}),e("div",{className:"tweet-button",onClick:()=>{if(r.content.length>0||r.attachments.length>0){let h=[...r.content.split(" ").filter(w=>w.startsWith("#")).filter((w,m,A)=>A.indexOf(w)===m).map(w=>w.replace("#",""))];N("Twitter",{action:"sendTweet",data:{username:E.username,content:r.content,attachments:r.attachments.length>0?r.attachments:null,replyTo:n.isReply,hashtags:h}},!0).then(w=>{if(!w)return M("error","Failed to send tweet!");n.onSend()})}},children:a("APPS.TWITTER.TWEET")})]}),s("div",{className:"message-container",children:[s("div",{className:"message-top",children:[E&&e("div",{className:"profile-picture",children:e("img",{src:$(E.profile_picture)})}),e(de,{maxLength:280,id:"textArea",value:r.content,onChange:h=>{g({...r,content:h.target.value});let w=h.target.scrollHeight;h.target.style.height=w+"px"},placeholder:n.isReply?a("APPS.TWITTER.TWEET_REPLY"):a("APPS.TWITTER.TWEET_GENERAL")})]}),e("div",{className:"tweet-attatchments",children:r.attachments.map((h,w)=>s("div",{className:"tweet-attatchment",children:[X(h)?e("video",{src:h,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e("img",{src:h}),e("i",{className:"fal fa-times",onClick:()=>{g({...r,attachments:r.attachments.filter((m,A)=>A!==w)})}})]},w))}),s("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{var h,w,m;r.attachments.length<2&&x.Gallery.set({includeVideos:!0,allowExternal:(m=(w=(h=j)==null?void 0:h.value)==null?void 0:w.AllowExternal)==null?void 0:m.Birdy,onSelect:A=>g({...r,attachments:[...r.attachments,A.src]})})},children:e(Je,{})}),e("div",{className:"button",onClick:()=>{x.Emoji.set({onSelect:h=>g(w=>({content:`${w.content}${h.emoji}`,attachments:w.attachments}))})},children:e(Ke,{})})]})]})]})}function Tt(){const{User:n,Func:c}=i.useContext(H),[E]=c.Timeline,[r]=n,[g,t]=c.Update,[u,h]=i.useState([]),[w,m]=i.useState(!1),[A,S]=i.useState(0),[f,v]=i.useState(!1),[_,o]=i.useState(!1),[P,I]=i.useState(!1);return ne("twitter:newTweet",C=>{var W,d,T;if(!C)return M("warning","No tweet data was provided for the twitter:newTweet event, returning.");if((W=C.tweet)!=null&&W.replyToId)return M("info","Tweet is reply, not adding to timeline");if(!((d=C.tweet)!=null&&d.content)||E==="following")return;h([C,...u]);let l=(T=document.querySelector(".tweets-container"))==null?void 0:T.scrollTop;I(l&&l>0)}),i.useEffect(()=>{if(!J("Twitter"))return;v(!1),o(!1),t(!1),S(0),h([]);let C=E==="following"?{type:"following",username:r.username}:null;N("Twitter",{action:"getTweets",page:0,filters:C},V.tweets).then(l=>{if(!l)return M("warning","No tweets returned from server");h(l)})},[E,g,r==null?void 0:r.username]),s(b,{children:[e(ie,{}),e(Se,{children:P?e(ht,{hide:()=>I(!1)}):null}),w&&e("div",{className:"reply-area",children:e(ue,{onSend:()=>m(!1),goBack:()=>m(!1)})}),e("div",{className:"tweets-container",onScroll:()=>{var d;if(f||_)return;let C=(d=document.querySelector(".tweets-container"))==null?void 0:d.scrollTop;C&&P&&C<1&&I(!1);let l=document.querySelector("#last");if(!l)return;!Q(l)&&(o(!0),N("Twitter",{action:"getTweets",page:A+1,filter:{type:E==="following"?"following":void 0,username:E==="following"?r.username:void 0}},null).then(T=>{T&&T.length>0?(h([...u,...T]),o(!1)):v(!0)}),S(T=>T+1))},children:u==null?void 0:u.map((C,l)=>{let W=l===u.length-1;return e(Z,{data:C,last:W},l)})})]})}const ht=({hide:n})=>s(Ie.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},className:"new-tweets",onClick:()=>{let c=document.querySelector(".tweets-container");c&&(c.scrollTo({top:0,behavior:"smooth"}),n==null||n())},children:[e(Qe,{}),a("APPS.TWITTER.NEW_POSTS")]});function ft(){const{Func:n,User:c,UserPanel:E}=i.useContext(H),[r,g]=n.Tweet,[t,u]=n.View,[h,w]=E,[m,A]=i.useState(r),[S,f]=i.useState([]),[v,_]=i.useState(null),[o,P]=i.useState([]),[I,p]=i.useState(!1),[C,l]=i.useState(0),[W,d]=i.useState(!1),[T,F]=i.useState(!1),[k,D]=i.useState({retweeted:!1,liked:!1}),[O,L]=i.useState({likes:0,retweets:0});i.useEffect(()=>{var y;if(A(r),P([]),(y=m==null?void 0:m.tweet)!=null&&y.attachments)if(Array.isArray(m.tweet.attachments))P(m.tweet.attachments);else{const U=JSON.parse(m.tweet.attachments);U&&Array.isArray(U)&&P(JSON.parse(m.tweet.attachments))}D({retweeted:m.tweet.retweeted,liked:m.tweet.liked}),L({likes:m.tweet.likes,retweets:m.tweet.retweets})},[m,r]),i.useEffect(()=>{if(m.tweet.date_created){const y=new Date(m.tweet.date_created);let U=y.getDate(),G=y.getMonth()+1,le=y.getFullYear();_(`${y.getHours()}:${y.getMinutes()}· ${U}/${G}/${le}`)}},[m]),ne("twitter:updateTweetData ",y=>{y.tweetId===m.tweet.id&&L({...O,[y.data]:y.increment?O[y.data]+1:O[y.data]-1})}),i.useEffect(()=>{var y;J("Twitter")&&(f([]),N("Twitter",{action:"getTweets",page:0,filter:{type:"replyTo",tweet_id:r.tweet.id}},(y=V.tweets.find(U=>U.tweet.id===r.tweet.id))==null?void 0:y.tweet._replies).then(U=>{f(U)}))},[r,I]);const ee=()=>{if(W||T)return;let y=document.querySelector("#last");if(!y)return;!Q(y)&&(F(!0),N("Twitter",{action:"getTweets",page:C+1,filter:{type:"replyTo",tweet_id:m.tweet.id}},null).then(G=>{G&&G.length>0?(f([...S,...G]),F(!1)):d(!0)}),l(G=>G+1))};return s(b,{children:[s("div",{className:`viewtweet-container ${I?"replying":""}`,children:[s("div",{className:"viewtweet-header",children:[e("div",{onClick:()=>u("timeline"),children:e("i",{className:"far fa-arrow-left"})}),e("div",{className:"viewtweet-title",children:a("APPS.TWITTER.TWEET")}),e("div",{})]}),s("div",{className:"viewtweet-body",children:[s("div",{className:"viewtweet-content-header",children:[e("div",{className:"profile-picture",onClick:()=>n.fetchAndSetProfile(m.user.username),children:e("img",{src:$(m.user.profile_picture)})}),s("div",{className:"profile-name",children:[s("div",{className:"name",children:[m.user.name," ",m.user.verified&&e("i",{className:"fas fa-badge-check verified"})]}),s("span",{children:["@",m.user.username]})]})]}),m.tweet.replyToId&&s("div",{className:"replying-to",onClick:y=>{y.stopPropagation(),N("Twitter",{action:"getTweet",tweetId:m.tweet.replyToId},V.tweets.find(U=>U.tweet.id===m.tweet.replyToId)).then(U=>{g(U)})},children:[a("APPS.TWITTER.REPLYING_TO").format({name:""})," ",s("span",{children:["@",m.tweet.replyToAuthor]})]}),s("div",{className:"content",children:[se(m.tweet.content,!0,n.fetchAndSetProfile),(o==null?void 0:o.length)>0&&e("div",{className:"attachment",children:o.map((y,U)=>X(y)?e(Pt,{src:y,id:U,onClick:()=>{x.FullscreenImage.set(y)}},U):e(ae,{src:y,onClick:()=>{x.FullscreenImage.set(y)}},U))})]}),e("div",{className:"date",children:v})]}),s("div",{className:"stats",children:[s("div",{className:"stats-item",onClick:()=>{w({display:!0,data:{title:a("APPS.TWITTER.RETWEETED_BY"),tweet_id:m.tweet.id,cb:()=>{g(m),u("tweet")}}})},children:[e("span",{children:O.retweets})," Retweets"]}),s("div",{className:"stats-item",onClick:()=>{w({display:!0,data:{title:a("APPS.TWITTER.LIKED_BY"),tweet_id:m.tweet.id,cb:()=>{g(m),u("tweet")}}})},children:[e("span",{children:O.likes})," ",a("APPS.TWITTER.LIKES")]})]}),s("div",{className:"buttons",children:[e("div",{className:"button comment",children:e("i",{className:"fal fa-comment",onClick:()=>p(!0)})}),e("div",{className:`button retweet ${k.retweeted?"active":""}`,children:e("i",{className:"fal fa-retweet",onClick:()=>{x.PopUp.set({title:k.retweeted?a("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):a("APPS.TWITTER.RETWEET_POPUP.RETWEET"),description:a("APPS.TWITTER.RETWEET_POPUP.DESCRIPTION").format({action:k.retweeted?a("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):a("APPS.TWITTER.RETWEET_POPUP.RETWEET")}),buttons:[{title:a("APPS.TWITTER.RETWEET_POPUP.CANCEL")},{title:k.retweeted?a("APPS.TWITTER.RETWEET_POPUP.UNDO_RETWEET"):a("APPS.TWITTER.RETWEET_POPUP.RETWEET"),cb:()=>{N("Twitter",{action:"toggleRetweet",tweet_id:m.tweet.id,retweeted:!k.retweeted},!k.retweeted).then(y=>{D({...k,retweeted:y})})}}]})}})}),e("div",{className:`button like ${k.liked?"active":""}`,children:e("i",{className:"fal fa-heart",onClick:y=>{y.stopPropagation(),N("Twitter",{action:"toggleLike",tweet_id:m.tweet.id,liked:!k.liked},!k.liked).then(U=>{D({...k,liked:U})})}})})]}),e("div",{className:"tweet-replies",children:e("div",{className:"tweets",onScroll:ee,children:S.map((y,U)=>{let G=U===S.length-1;return e(Z,{data:y,last:G},U)})})})]}),I&&e("div",{className:"reply-area",children:e(ue,{onSend:()=>p(!1),goBack:()=>p(!1),isReply:m.tweet.id})})]})}const Pt=({src:n,id:c,onClick:E})=>e("video",{src:n,id:c,autoPlay:!0,loop:!0,muted:!0,onClick:()=>E()}),gt=["#gay","#pride","#99kr"],H=i.createContext(null);function vt(){var k,D;const n=te(Ce.Settings),c=(k=te(et))==null?void 0:k.active,[E,r]=i.useState(null),[g,t]=i.useState(!1),[u,h]=i.useState("timeline"),[w,m]=i.useState("default"),[A,S]=i.useState(null),[f,v]=i.useState(null),[_,o]=i.useState(null),[P]=i.useState(!1),[I,p]=i.useState(!1),[C,l]=i.useState({display:!1,data:null}),[W,d]=i.useState(!0);i.useEffect(()=>{var O,L;c&&((O=c==null?void 0:c.data)==null?void 0:O.view)==="profile"&&T((L=c==null?void 0:c.data)==null?void 0:L.username)},[c]),i.useEffect(()=>{N("isAdmin",null,!1).then(O=>{if(Y.APPS.TWITTER.account.value){r({...Y.APPS.TWITTER.account.value,isAdmin:O}),t(!0),d(!1);return}else{if(Y.APPS.TWITTER.account.value===!1)return d(!1);N("Twitter",{action:"isLoggedIn"},V.account).then(L=>{L?(Y.APPS.TWITTER.account.set(L),r({...L,isAdmin:O}),t(!0)):Y.APPS.TWITTER.account.set(!1),d(!1)})}})},[]),i.useEffect(()=>{C.display&&h("userpanel")},[C]),i.useEffect(()=>(Ne.ReceiveAppNotifications.set(!_),()=>{Ne.ReceiveAppNotifications.set(!0)}),[u]);const T=O=>{if(!O)return M("warning","No username provided.");N("Twitter",{action:"getProfile",data:{username:O}},V.accounts[O]).then(L=>{if(!L)return M("warning","No profile found for",O);v(L),h("profile")})},F={timeline:e(Tt,{}),profile:e(ut,{}),tweet:e(ft,{}),search:e(mt,{}),notifications:e(it,{}),userpanel:e(ot,{}),dmlist:e(at,{})};return e(H.Provider,{value:{User:[E,r],Func:{View:[u,h],Timeline:[w,m],Profile:[f,v],Tweet:[A,S],Update:[I,p],LoggedIn:[g,t],DmUser:[_,o],fetchAndSetProfile:T},UserPanel:[C,l]},children:W||n!=null&&n.airplaneMode?e("div",{className:"loading",children:e(Xe,{size:40,lineWeight:5,speed:2,color:((D=n==null?void 0:n.display)==null?void 0:D.theme)==="dark"?"#fff":"#000"})}):e("div",{className:"twitter-container",children:g===!0?s(b,{children:[F==null?void 0:F[u],u==="new-tweet"&&e("div",{className:"reply-area",children:e(ue,{data:c==null?void 0:c.data,goBack:()=>h("timeline"),onSend:()=>h("timeline")})}),u==="timeline"&&!P&&e("div",{className:"new-tweet",onClick:()=>h("new-tweet"),children:e(Ze,{})}),e(ct,{})]}):e(nt,{})})})}const $=n=>{var c;return n??`./assets/img/avatar-placeholder-${(c=Ce.Settings.value)==null?void 0:c.display.theme}.svg`};export{H as TwitterContext,vt as default,$ as getAvatar,gt as rainbowHashtags};
