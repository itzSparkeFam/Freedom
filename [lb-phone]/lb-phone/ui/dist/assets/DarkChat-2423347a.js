import{u as E,r as S,s as i,p as g,q as p,j as r,m as b,S as M,a as t,L as e,aw as Z,C as R,aV as ee,b as U,am as te,an as ne,w as ae,$ as se,c4 as re,aj as ie,x as le,P as y,E as j,_ as q,I as ce,ag as oe,A as Ae,a7 as me,ac as X,d as L,cu as de,a4 as he,K as ue,t as $,H as G}from"./index-594e1857.js";const _={username:"lb",channels:[{id:1,name:"guns",members:7,lastMessage:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{id:2,name:"comics",members:134,lastMessage:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{id:3,name:"cars",members:23,lastMessage:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12}],messages:{guns:[{content:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{content:"yo, does anyone have any weapons for sale?",sender:"rya2n",timestamp:Date.now()-1e3*60*60*6},{content:"sup",sender:"lb",timestamp:Date.now()-1e3*60*60*17}],comics:[{content:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{content:"any good cominc recommendations?",sender:"yungblood",timestamp:Date.now()-1e3*60*60*10},{content:"just finished reading the new batman comic, its amazing",sender:"batmanfan123",timestamp:Date.now()-1e3*60*60*24}],cars:[{content:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12},{content:"anyone know where i can get a good deal on a car?",sender:"anonymous",timestamp:Date.now()-1e3*60*60*14},{content:"i have a 2018 camaro for sale, 15k",sender:"camaroguy",timestamp:Date.now()-1e3*60*60*18},{content:"i have a 2017 mustang for sale, 10k",sender:"mustangguy",timestamp:Date.now()-1e3*60*60*20},{content:"looking for a quite new car in good condition for around 10k, anyone know where i can find one?",sender:"lb",timestamp:Date.now()-1e3*60*60*22}]}};function Pe(){var O,k;const a=E(u),c=E(D),[P,o]=S.useState(""),[m,s]=S.useState(""),T=E(y.Settings),d=E(i.APPS.DARKCHAT.channels);S.useEffect(()=>{i.APPS.DARKCHAT.channels.value||g("DarkChat",{action:"getChannels"},_.channels).then(l=>{if(!l)return p("warning","Failed to fetch channels");i.APPS.DARKCHAT.channels.set(l)})},[c]);const w=()=>{g("AccountSwitcher",{action:"getAccounts",app:"DarkChat"},null).then(l=>{var H;if(!l)return p("info","No accounts found");let N=(H=l==null?void 0:l.filter(v=>v!==c))==null?void 0:H.map(v=>({title:v,cb:()=>{g("AccountSwitcher",{action:"switch",app:"DarkChat",account:v}).then(()=>{D.set(v),i.APPS.DARKCHAT.username.set(v),i.APPS.DARKCHAT.channels.reset(),u.set("channels")})}}));R.ContextMenu.set({buttons:[{title:c},...N,{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:()=>{u.set("signup"),D.reset(),i.APPS.DARKCHAT.username.reset(),i.APPS.DARKCHAT.channels.reset()}},{title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),color:"red",cb:()=>{R.PopUp.set({title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),description:e("APPS.MAIL.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:e("APPS.MAIL.SIGN_OUT_POPUP.CANCEL")},{title:e("APPS.MAIL.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{g("DarkChat",{action:"logout"},!0).then(v=>{if(!v)return p("warning","Failed to logout, success returned false");D.reset(),i.APPS.DARKCHAT.username.reset(),i.APPS.DARKCHAT.channels.reset(),u.set("signin")})}}]})}}]})})};return r(b.div,{...M("left",a,.2),className:"animation-container",children:[r("div",{className:"darkchat-header",children:[r("div",{className:"top",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.TITLE")}),r("div",{className:"buttons",children:[t(Z,{onClick:()=>{c&&R.PopUp.set({title:e("APPS.DARKCHAT.NEW_ROOM"),description:e("APPS.DARKCHAT.NEW_ROOM_TEXT"),input:{placeholder:e("APPS.DARKCHAT.ROOM_CODE"),type:T!=null&&T.streamerMode?"password":"text",minCharacters:3,onChange:l=>s(l)},buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.JOIN"),color:"blue",cb:()=>{s(l=>(g("DarkChat",{action:"joinChannel",channel:l},!_.channels.find(N=>N.name===l)&&{timestamp:Date.now(),name:l,members:Math.floor(Math.random()*100),lastMessage:"Welcome to the channel!",sender:"admin"}).then(N=>{if(!N)return p("warning","Failed to join channel");K.set(N),u.set("chat"),i.APPS.DARKCHAT.channels.set([N,...d])}),l))}}]})}}),t(ee,{className:"elipse",onClick:()=>{var l,N,H,v;R.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:w},((N=(l=U)==null?void 0:l.value)==null?void 0:N.ChangePassword.DarkChat)&&{title:e("APPS.DARKCHAT.CHANGE_PASSWORD"),cb:()=>{setTimeout(()=>{te("DarkChat",()=>{})},250)}},((v=(H=U)==null?void 0:H.value)==null?void 0:v.DeleteAccount.DarkChat)&&{title:e("APPS.DARKCHAT.DELETE_ACCOUNT"),color:"red",cb:()=>{setTimeout(()=>{ne("DarkChat",()=>{D.reset(),i.APPS.DARKCHAT.username.set(null),i.APPS.DARKCHAT.channels.set(null),u.set("signin")})},250)}}]})}})]})]}),t(ae,{placeholder:e("APPS.DARKCHAT.SEARCH"),theme:"dark",onChange:l=>o(l.target.value)})]}),(d==null?void 0:d.length)===0&&r("div",{className:"no-channels",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.NO_CHATS")}),t("div",{className:"description",children:e("APPS.DARKCHAT.NO_CHATS_TEXT")})]}),t("div",{className:"channels-body",children:(k=(O=d==null?void 0:d.sort((l,N)=>N.timestamp-l.timestamp))==null?void 0:O.filter(l=>l.name.toLowerCase().includes(P.toLowerCase())))==null?void 0:k.map(l=>t(Ce,{channel:l},l.id))})]})}const Ce=({channel:a})=>{const c=E(D),P=E(y.Settings),o=s=>/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(s),m=se(s=>{R.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),color:"red",cb:()=>{R.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),description:e("APPS.DARKCHAT.LEAVE_CHANNEL.DESCRIPTION"),buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.PROCEED"),cb:()=>{g("DarkChat",{action:"leaveChannel",channel:a.name},!0).then(T=>{if(!T)return p("warning","Failed to leave channel");u.set("channels"),K.set(null);let d=i.APPS.DARKCHAT.channels.value.filter(w=>w.name!==a.name);i.APPS.DARKCHAT.channels.set(d)})}}]})}}]})});return r("div",{...m,className:"channel",onClick:()=>{c&&(K.set(a),u.set("chat"))},children:[r("div",{className:"channel-info",children:[r("div",{className:"members",children:[t(re,{}),t("span",{children:a.members})]}),r("div",{className:"channel-content",children:[t("div",{className:"channel-name",children:P.streamerMode?"*****":a.name}),a.lastMessage&&r("div",{className:"recent-message",children:[r("b",{children:[a.sender,":"]})," ",o(a.lastMessage)?e("APPS.MESSAGES.SENT_LOCATION_SHORT"):a.lastMessage]})]})]}),r("div",{className:"right",children:[t("div",{className:"timestamp",children:ie(a.timestamp)}),t(le,{})]})]})};function Se(){const a=E(y.Settings),c=E(K),P=E(D),o=E(u),[m,s]=S.useState([]),[T,d]=S.useState(""),w=S.useRef(null),O=S.useRef(0),[k,l]=S.useState(0),[N,H]=S.useState(!1),[v,x]=S.useState(!1);S.useEffect(()=>{var n;j("DarkChat")&&g("DarkChat",{action:"getMessages",channel:c.name,page:0},(n=_.messages)==null?void 0:n[c.name]).then(A=>{A&&A.length>0?(s(A.reverse()),A.length<15&&H(!0)):H(!0)})},[]);const Y=n=>{if(N||v)return;let A=document.querySelector("#last");if(!A)return;!ue(A)&&(x(!0),g("DarkChat",{action:"getMessages",channel:c.name,page:k+1},null).then(C=>{if(C&&(C==null?void 0:C.length)>0){let f=document.querySelector(".chat-wrapper");O.current=f.scrollHeight,s([...C.reverse(),...m]),x(!1),C.length<15&&H(!0)}else H(!0)}),l(C=>C+1))};S.useEffect(()=>{let n=document.querySelector(".chat-wrapper");const A=n.scrollHeight;n.scrollTop+=A-O.current,n.scroll},[m]);const V=()=>{if(T.length>0){let n={sender:P,content:T,timestamp:new Date().getTime()};g("DarkChat",{action:"sendMessage",content:T,channel:c.name},!0).then(()=>{d(""),w.current.value="",s([...m,n]);let A=i.APPS.DARKCHAT.channels.value.map(h=>(h.name===c.name&&(h.lastMessage=n.content,h.sender=P,h.timestamp=new Date().getTime()),h));i.APPS.DARKCHAT.channels.set(A)})}},B=()=>{R.PopUp.set({title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{g("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(n=>{if(!n)return;let A={content:`<!SENT-LOCATION-X=${$(n.x,2)}Y=${$(n.y,2)}!>`,sender:P,timestamp:new Date().getTime()};g("DarkChat",{action:"sendMessage",...A,channel:c.name},!0).then(h=>{if(h){s(f=>[...f,A]),d(""),w.current.value="";let C=i.APPS.DARKCHAT.channels.value.map(f=>(f.name===c.name&&(f.lastMessage=A.content,f.sender=P,f.timestamp=new Date().getTime()),f));i.APPS.DARKCHAT.channels.set(C)}else s(C=>[...C,{...A,delivered:!1}])})})}}]})};q("darkChat:newMessage",n=>{if(c.name!==n.channel||!j("DarkChat"))return;let A=i.APPS.DARKCHAT.channels.value.map(h=>(h.name===n.channel&&(h.lastMessage=n.content,h.sender=n.sender,h.timestamp=new Date().getTime()),h));i.APPS.DARKCHAT.channels.set(A),s([...m,{...n,timestamp:new Date().getTime()}])});const z=n=>{if(n)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(n)};return r(b.div,{...M("right",o,.2),className:"animation-container",children:[t("div",{className:"darkchat-header chat",children:r("div",{className:"top",children:[t(ce,{onClick:()=>{u.set("channels"),K.set(null)}}),r("div",{className:"content",children:[t("div",{className:"title",children:a.streamerMode?"*****":c.name}),r("div",{className:"members",children:[c.members," ",c.members===1?e("APPS.DARKCHAT.MEMBER"):e("APPS.DARKCHAT.MEMBERS")]})]}),t(oe,{onClick:()=>{R.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_ROOM"),description:e("APPS.DARKCHAT.LEAVE_ROOM_TEXT"),buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE"),color:"red",cb:()=>{g("DarkChat",{action:"leaveChannel",channel:c.name},!0).then(n=>{if(!n)return p("warning","Failed to leave channel");u.set("channels"),K.set(null);let A=i.APPS.DARKCHAT.channels.value.filter(h=>h.name!==c.name);i.APPS.DARKCHAT.channels.set(A)})}}]})}})]})}),t("div",{className:"chat-wrapper",onScroll:Y,children:t("div",{className:"chat-body",children:m.map((n,A)=>{var W;let h,C=null,f=A===0?"last":"",I=n.sender===P?"self":"other",F=((W=m[A+1])==null?void 0:W.sender)===P?"self":"other";if(m[A+1]?h=Math.abs(n.timestamp-m[A+1].timestamp)/36e5:F=void 0,z(n.content)){let J=n.content.match(/X=(-?\d*\.?\d*)Y/)[1],Q=n.content.match(/Y=(-?\d*\.?\d*)!>/)[1];C={x:J,y:Q}}return r("div",{className:`message ${I}`,id:f,children:[C?t("div",{className:"location",onClick:()=>{Ae.patch({active:{name:"Maps",data:{location:[C.y,C.x],name:`${n.sender}'s location`}}})},children:t("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}})}):t("div",{className:"content",children:me(n.content)}),m[A+1]&&h>6?r("div",{className:"date",children:[I=="other"&&t("div",{className:"user",children:n.sender}),X(n.timestamp)]}):I!==F&&r("div",{className:"date",children:[I=="other"&&t("div",{className:"user",children:n.sender}),X(n.timestamp)]})]},A)})})}),t("div",{className:"chat-bottom",children:r("div",{className:"input",children:[t(L,{type:"text",placeholder:e("APPS.DARKCHAT.INPUT_PLACEHOLDER"),value:T,ref:w,onChange:n=>d(n.target.value),onKeyDown:n=>{if(n.key==="Enter")return V()}}),r("div",{className:"buttons",children:[t("div",{className:"location",children:t(de,{onClick:B})}),T.length>0&&t("div",{className:"send",onClick:V,children:t(he,{})})]})]})})]})}function pe(){const[a,c]=S.useState({username:"",password:""}),P=()=>{g("DarkChat",{action:"login",username:a.username,password:a.password},{success:!0}).then(o=>{o&&o.success?(D.set(a.username),i.APPS.DARKCHAT.username.set(a.username),u.set("channels")):o&&o.reason&&(p("error",o.reason),R.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${o.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]}))})};return t(b.div,{...M("right","signin",.2),className:"animation-container",children:r("div",{className:"form",children:[t("div",{className:"form-header",children:t("div",{className:"title",children:e("APPS.DARKCHAT.LOGIN")})}),r("div",{className:"form-content",children:[r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),t("div",{className:"input",children:t(L,{type:"text",placeholder:"anonymous",maxLength:50,onChange:o=>{c({...a,username:o.target.value.toLowerCase()})}})})]}),r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),t("div",{className:"input",children:t(L,{type:"password",placeholder:"••••••••••",minLength:3,onChange:o=>{c({...a,password:o.target.value})}})})]}),t("div",{className:"button",onClick:()=>P(),children:e("APPS.DARKCHAT.LOGIN")})]}),r("div",{className:"footer",children:[e("APPS.DARKCHAT.NO_ACCOUNT")," ",t("span",{onClick:()=>u.set("signup"),children:e("APPS.DARKCHAT.SIGN_UP")})]})]})})}function De(){const[a,c]=S.useState({username:"",password:""}),P=()=>{if(a.username===""||a.password==="")return p("warning","Username or password is empty");let o=a==null?void 0:a.username.toLowerCase().replace(/\s/g,""),m=o.match(U.value.UsernameFilter);if(!m||(m==null?void 0:m[0])!==o||o.length<3||o.length>15){p("warning","Username did not match regex"),R.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e("APPS.DARKCHAT.USERNAME_NOT_ALLOWED"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}g("DarkChat",{action:"register",username:a.username,password:a.password},{success:!0}).then(s=>{if(!s)return p("warning","Darkchat response is null");if(s&&s.success)p("info","Account created successfully"),D.set(a.username),i.APPS.DARKCHAT.username.set(a.username),u.set("channels");else if(s&&s.reason){p("warning",s.reason),R.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${s.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}})};return t(b.div,{...M("left","signup",.2),className:"animation-container",children:r("div",{className:"form",children:[t("div",{className:"form-header",children:t("div",{className:"title",children:e("APPS.DARKCHAT.SIGN_UP")})}),r("div",{className:"form-content",children:[r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),t("div",{className:"input",children:t(L,{type:"text",placeholder:"anonymous",maxLength:50,onChange:o=>{c({...a,username:o.target.value.toLowerCase()})}})})]}),r("div",{className:"item",children:[t("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),t("div",{className:"input",children:t(L,{type:"password",placeholder:"••••••••••",minLength:3,onChange:o=>{c({...a,password:o.target.value})}})})]}),t("div",{className:"button",onClick:()=>P(),children:e("APPS.DARKCHAT.SIGN_UP")})]}),r("div",{className:"footer",children:[e("APPS.DARKCHAT.ALREADY_HAVE")," ",t("span",{onClick:()=>u.set("signin"),children:e("APPS.DARKCHAT.LOGIN")})]})]})})}const ge={channels:t(Pe,{}),chat:t(Se,{}),signin:t(pe,{}),signup:t(De,{})},u=G("signup"),K=G(null),D=G(null);function Ne(){const a=E(u),[c,P]=S.useState(""),[o,m]=S.useState(!0);return S.useEffect(()=>{if(i.APPS.DARKCHAT.username.value){D.set(i.APPS.DARKCHAT.username.value),m(!1);return}g("DarkChat",{action:"getUsername"},_.username).then(s=>{if(m(!1),!s||!(s!=null&&s.username))return p("warning","Darkchat response is null");D.set(s.username),i.APPS.DARKCHAT.username.set(s.username),s.password?u.set("channels"):R.PopUp.set({title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),description:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.DESCRIPTION"),input:{type:"password",placeholder:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.PLACEHOLDER"),minLength:3,maxLength:50,onChange:T=>P(T)},buttons:[{title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),cb:()=>{P(T=>(g("DarkChat",{action:"setPassword",password:T},{success:!0}).then(d=>{if(!d||d!=null&&d.reason)return p("error",d.reason);u.set("channels")}),""))}}]})})},[]),q("darkchat:logout",s=>{if(!s)return p("warning","No username provided to logout");if(!D.value)return p("warning","No username stored in cache to logout");if(s!==(D==null?void 0:D.value))return p("warning","Username provided does not match current logged in username, not logging out");D.set(null),u.set("signin"),i.APPS.DARKCHAT.username.set(null),i.APPS.DARKCHAT.channels.set(null)}),t("div",{className:"darkchat-container",children:!o&&ge[a]})}export{K as ActiveChannel,D as Username,u as View,Ne as default};
