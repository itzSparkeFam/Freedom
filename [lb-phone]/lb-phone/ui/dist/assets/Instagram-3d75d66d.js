import{H as Ue,r as s,u as ae,cp as _e,q as _,b9 as Xe,p as N,ba as Se,_ as te,C as z,L as n,j as a,a as e,a3 as ve,bM as Je,N as Ee,cq as xe,d as le,F as j,m as Ce,b as he,aU as Oe,b5 as He,P as fe,a2 as oe,cr as Qe,R as Ze,a7 as Ie,J as et,E as ue,b6 as pe,T as tt,A as Me,cs as We,ct as qe,K as me,s as ie,x as Be,I as we,w as Ge,a9 as $e,aj as ge,am as at,an as st,aD as nt,cu as it,t as rt,ab as Ve,ac as Fe,aP as ct,c9 as lt,bW as ot,cg as mt,c0 as dt,ch as ut,af as ft,cv as ht,bd as gt}from"./index-594e1857.js";import{S as vt}from"./Switch-ffaa3cda.js";import{T as ze}from"./Textarea-251c47d2.js";import{formatNumber as Pt}from"./Tiktok-84cfc176.js";import"./Slider-fb8d9803.js";const ce=Ue({host:"",participants:[],viewers:0});function At(){var Y,re,de,Ne;const{View:i,Account:d,Func:S}=s.useContext(K),c=ae(he),[A,v]=i,[l]=d,m=ae(ce),[g,I]=s.useState(!1),[r,t]=s.useState(!1),[P,C]=s.useState(null),[T,f]=s.useState(""),p=s.useRef(null),O=s.useRef(null),G=s.useRef(null),[L,M]=s.useState(null),[x,E]=s.useState(null),[b,D]=s.useState(null),[o,u]=s.useState([]),[R,V]=s.useState([]),[h,W]=s.useState([]);s.useEffect(()=>{p.current.scrollTop=p.current.scrollHeight},[h]),s.useEffect(()=>{const w=c.rtc?new _e({config:c.rtc}):new _e;return w.on("open",F=>{M({peer:w,id:F})}),w.on("call",F=>{F.on("close",()=>{V(B=>B.filter(ee=>ee.connectionId!==F.connectionId))}),V(B=>[...B,F])}),_("info","Created peer"),()=>{try{for(let F of R)F.close()}catch{_("error","Failed to close calls")}try{w.destroy()}catch{_("error","Failed to destroy peer")}}},[]),s.useEffect(()=>{if(!b||G!=null&&G.current||!L)return;_("info","Creating game render");let w=new Xe(b);G.current=w,w.resizeByAspect(3/4);const F=window.innerWidth;F>1280&&w.setQuality(1280/F);let B;if(x||g){_("info","Host is true, creating call"),g?N("Instagram",{action:"setLive",username:l.username,verified:l.verified,id:L.id}):x&&N("Instagram",{action:"joinLive",username:x,streamId:L.id}).then(Q=>{if(E(null),!Q)return _("error","Failed to join live");t(!0)});const ee=b.captureStream(24);B=Q=>{_("info","Answering call",Q),Q.answer(ee)},L.peer.on("call",B)}return()=>{B&&L.peer.off("call",B),G.current&&G.current.destroy(),G.current=null}},[b,L]);const y=w=>{w.forEach(F=>{if(F.username===l.username)return _("info","Skipping self");_("info","Adding participant",F);const B=document.createElement("canvas"),ee=B.captureStream(0),Q=L.peer.call(F.id,ee);V(Pe=>[...Pe,Q]),Q.on("close",B.remove),Q.on("error",B.remove),Q.on("stream",Pe=>{N("Instagram",{action:"addCall",id:Q.connectionId,username:F.username}),u(Te=>[...Te,{stream:Pe,username:F.username}])})})},$=w=>{w.forEach(F=>{_("info","Removing participant",F),F.username===l.username&&t(!1),u(B=>B.filter(ee=>ee.username!==F.username))})};s.useEffect(()=>{const w=m.participants;if(!w||!L)return _("warning","No participants");const F=w.filter(ee=>!o.find(Q=>Q.username===ee.username));F.length&&y(F),_("info","Added",F);const B=o.filter(ee=>!w.find(Q=>Q.username===ee.username));B.length&&$(B),_("info","Removed",B)},[m.participants,L]),s.useEffect(()=>{const w=l.username===(m==null?void 0:m.host);return I(w),Se.ShouldClose.set(!1),w&&u(F=>[...F,{username:m.host}]),()=>{Se.ShouldClose.set(!0)}},[]);const q=()=>{z.PopUp.set({title:g?n("APPS.INSTAGRAM.END_LIVE_POPUP.TITLE"):n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.END_LIVE_POPUP.DESCRIPTION").format({action:(g?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE")).toLowerCase()}),buttons:[{title:n("APPS.INSTAGRAM.END_LIVE_POPUP.CANCEL")},{title:g?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{H(g)}}]})},k=()=>{N("Instagram",{action:"sendLiveMessage",data:{user:{username:l.username,avatar:l.avatar,verified:l.verified},live:m.host,content:T}}),f("")},H=(w,F)=>{if(g)N("Instagram",{action:"endLive"}).then(()=>{v("feed")});else if(r&&N("Instagram",{action:"endLive"}).then(()=>{v("feed")}),N("Instagram",{action:"stopViewing",username:m.host}),w)Se.ShouldClose.set(!0),ce.patch({ended:!0});else{if(F===!1)return;v("feed")}};return te("instagram:addMessage",w=>{w.live===m.host&&W(F=>[...F,w])}),te("instagram:updateViewers",w=>{w.username===(m==null?void 0:m.host)&&ce.patch({viewers:w.viewers})}),te("instagram:setLive",w=>{ce.set(w)}),te("instagram:liveEnded",w=>{w===(m==null?void 0:m.host)&&H(!0)}),te("instagram:stopLive",()=>v("feed")),te("instagram:endCall",w=>{const F=R.find(B=>B.connectionId===w);F&&(F.close(),V(B=>B.filter(ee=>ee.connectionId!==w)))}),te("instagram:invitedLive",w=>{w===(m==null?void 0:m.host)&&z.PopUp.set({title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.DESCRIPTION").format({username:w}),buttons:[{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.NO")},{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.YES"),cb:()=>{E(w),u(F=>[...F,{username:l.username}])}}]})}),te("instagram:joinedLive",w=>{w.host===(m==null?void 0:m.host)&&ce.patch({participants:[...m.participants,w]})}),te("instagram:leftLive",w=>{w.host===(m==null?void 0:m.host)&&(_("info","left live",w),ce.patch({participants:m.participants.filter(F=>F.username!==w.participant)}))}),a("div",{className:"instagram-live-container",children:[e("div",{className:"instagram-streams","data-streams":o.length.toString(),children:o.map((w,F)=>w.username===l.username?a("div",{className:"instagram-stream",children:[e("canvas",{ref:B=>{_("info","setting canvas ref",B),D(B)}}),!g&&e(ve,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{N("Instagram",{action:"endLive"}),t(!1)}}]})}})]}):e(St,{host:g,stream:w.stream,username:w.username},`stream-${F}`))}),m.ended&&a("div",{className:"instagram-stream-ended",children:[e(Je,{onClick:()=>v("feed")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.LIVE_ENDED")})]}),e(Ee,{children:P&&e(pt,{username:m.host,type:P,host:P==="participants"?g||r:g,endLive:H,close:()=>C(null)})}),a("div",{className:"instagram-live",children:[a("div",{className:"live-header",children:[a("div",{className:"profile",onClick:()=>{o.length>1?C("participants"):!g&&!r&&(H(),S.fetchAndSetProfile(m.host))},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar((re=(Y=m==null?void 0:m.participants)==null?void 0:Y[0])==null?void 0:re.avatar)})`}}),a("div",{className:"name",children:[e(Nt,{usernames:m.participants.map(w=>w.username)}),((Ne=(de=m==null?void 0:m.participants)==null?void 0:de[0])==null?void 0:Ne.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(xe,{})]})]}),a("div",{className:"stats",children:[e("div",{className:"live",children:n("APPS.INSTAGRAM.LIVE")}),a("div",{className:"viewers",onClick:()=>C("viewers"),children:[e("i",{className:"fas fa-eye"}),m.viewers]}),e("i",{className:"far fa-times x",onClick:()=>{g||r?q():H(!1)}})]})]}),a("div",{className:"comment-section",children:[e("div",{className:"comment-feed",ref:p,children:h.map((w,F)=>{let B=S.getAvatar(w.user.avatar);return a("div",{className:"comment",children:[e("img",{src:B}),a("div",{className:"info",children:[a("div",{className:"name",children:[w.user.username,w.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"comment-text",children:w.content})]})]},F)})}),a("div",{className:"comment-input",children:[e(le,{type:"text",ref:O,placeholder:n("APPS.INSTAGRAM.COMMENT_PLACEHOLDER"),onChange:w=>f(w.target.value),onKeyDown:w=>{w.key==="Enter"&&T.replace(/ /g,"").length>0&&(k(),O.current.value="")}}),e("i",{className:"far fa-paper-plane",onClick:()=>{T.replace(/ /g,"").length>0&&(k(),O.current.value="")}}),(g||r)&&e("i",{className:"fas fa-repeat",onClick:()=>{N("Instagram",{action:"flipCamera"})}})]})]})]})]})}const St=i=>{const d=s.useRef(null);return s.useEffect(()=>{if(!(d!=null&&d.current))return _("warning","No video ref");d.current.srcObject=i.stream,d.current.play().catch(()=>_("error","Failed to play video stream"))},[i==null?void 0:i.stream]),a("div",{className:"instagram-stream",children:[i.host&&e(ve,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:i.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:i.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{N("Instagram",{action:"removeLive",username:i.username}).then(()=>{})}}]})}}),e("video",{autoPlay:!0,ref:d})]})},Nt=i=>{let d=i.usernames.map((S,c)=>S).join(", ");return d.length>9&&(d=d.substring(0,9)+"..",d[d.length-3]===","&&(d=d.substring(0,d.length-3)+"..")),e(j,{children:d})},pt=i=>{var v;const{Func:d}=s.useContext(K),S=(v=ae(ce))==null?void 0:v.participants,[c,A]=s.useState([]);return s.useEffect(()=>{var l;if(i.type==="participants"){A((l=ce.value)==null?void 0:l.participants);return}N("Instagram",{action:"getLiveViewers",username:i.username}).then(m=>{m&&A(m)})},[]),a(Ce.div,{className:"story-modal","data-type":"live",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[e("div",{className:"close-border",onClick:()=>i.close()}),e("div",{className:"title",children:i.type==="viewers"?n("APPS.INSTAGRAM.WHOS_WATCHING"):n("APPS.INSTAGRAM.IN_THIS_ROOM")})]}),e("div",{className:"story-modal-content",children:e("div",{className:"viewers",children:c.map((l,m)=>a("div",{className:"item",children:[a("div",{className:"user",onClick:()=>{i.host||(i.endLive(!1,!1),d.fetchAndSetProfile(l.username))},children:[e("div",{className:"profile-picture",children:e("img",{src:d.getAvatar(l.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:l.name})]})]}),i.host&&i.type==="viewers"&&(S.find(g=>g.username===l.username)?e("div",{className:"remove",onClick:g=>{g.stopPropagation(),z.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:l.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:l.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{N("Instagram",{action:"removeLive",username:l.username}).then(()=>{})}}]})},children:n("APPS.INSTAGRAM.REMOVE")}):e("div",{className:"invite",onClick:g=>{g.stopPropagation(),N("Instagram",{action:"inviteLive",username:l.username})},children:n("APPS.INSTAGRAM.INVITE")}))]},m))})})]})};function Ye(i){const d=ae(fe.Settings);return e(j,{children:i.liked?e(Oe,{onClick:i.onClick,color:"#ed4956"}):e(He,{onClick:i.onClick,color:d.display.theme==="dark"?"#ffffff":"#262626"})})}function Ke(i){const{Account:d,View:S,Func:c,UserPanel:A}=s.useContext(K),[v]=d,[l,m]=S,[g,I]=A,[r,t]=s.useState(i.data),P=s.useRef(null),[C,T]=s.useState(0),[f,p]=s.useState(!1),O=ae(tt),G=ae(Me),L={pos:{startLeft:0,startX:0},onMouseDown:E=>{ue("Instagram")&&(L.pos={startLeft:P.current.scrollLeft,startX:E.clientX},P.current.style.userSelect="none",document.addEventListener("mouseup",L.onMouseUp),document.addEventListener("mousemove",L.onMove))},onMove:E=>{const b=(E.clientX-L.pos.startX)/pe();P.current.scrollLeft=L.pos.startLeft-b;const D=P.current.getBoundingClientRect();(D.left*pe()-5>E.clientX||E.clientX>D.right*pe()-5)&&L.onMouseUp()},onMouseUp:()=>{P.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",L.onMouseUp),document.removeEventListener("mousemove",L.onMove);const E=JSON.parse(r.media),b=P.current.clientWidth;let D=C;const o=P.current.scrollLeft-L.pos.startLeft;o>b/2&&D<E.length-1?D++:o<-b/2&&D>0&&D--,M(D)}},M=E=>{P.current.scrollTo({left:E*P.current.offsetWidth,behavior:"smooth"}),T(E)};te("instagram:updatePostData",E=>{if(!E||E.postId!==r.id)return _("warning","instagram:updatePostData","Post ID's do not match");t(b=>({...b,[E.data]:E.increment?b[E.data]+1:b[E.data]-1}))});const x=E=>{if(E.detail===2){if(!r.id)return;r.liked||N("Instagram",{action:"toggleLike",data:{postId:r.id,toggle:!r.liked,isComment:!1}},!r.liked).then(b=>{t(D=>({...D,liked:b})),p(!0),setTimeout(()=>p(!1),1e3)})}};return a("div",{className:"post",id:i.last?"last":"","data-id":r.id,"data-active":i.active,children:[a("div",{className:"post-header",children:[e("img",{className:"profile-picture",onClick:()=>c.fetchAndSetProfile(r.username),src:c.getAvatar(r.avatar)}),a("div",{className:"post-info",children:[a("div",{className:"name",onClick:()=>c.fetchAndSetProfile(r.username),children:[r.username,r.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),r.location&&e("div",{className:"location",children:r.location})]})]}),a("div",{className:"post-body",children:[f&&e("div",{className:"popup-heart","data-visible":f,children:e(Oe,{})}),e("div",{className:"image-container",ref:P,onMouseDown:L.onMouseDown,children:JSON.parse(r.media).map((E,b)=>{var D;return e("div",{className:"image",onClick:x,children:oe(E)?e(It,{attachment:E,active:i.active&&!(O!=null&&O.visible)&&((D=G==null?void 0:G.active)==null?void 0:D.name)==="Instagram"}):e("img",{src:E})},b)})}),a("div",{className:"actions",children:[a("div",{className:"like-comment",children:[e(Ye,{liked:r.liked,onClick:()=>{r.id&&N("Instagram",{action:"toggleLike",data:{postId:r.id,toggle:!r.liked,isComment:!1}},!r.liked).then(E=>{t(b=>({...b,liked:E}))})}}),e(Qe,{onClick:()=>c.fetchAndSetComments({id:r.id,username:r.username,avatar:r.avatar,verified:r.verified,caption:r.caption,timestamp:r.timestamp})}),(r.username===v.username||v.isAdmin)&&e(Ze,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.TITLE"),description:n("APPS.INSTAGRAM.DELETE_POST_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"deletePost",id:r.id},!0).then(E=>{if(!E)return _("error","Instagram","Failed to delete post");m("feed")})}}]})}})]}),JSON.parse(r.media).length>1&&e("div",{className:"scroll-dots",children:JSON.parse(r.media).map((E,b)=>e("div",{className:`dot ${C==b?"active":""}`,onClick:()=>M(b)},b))})]}),a("div",{className:"liked-by",onClick:()=>{I({display:!0,data:{title:n("APPS.INSTAGRAM.LIKED_BY"),postId:r.id,cb:()=>{m("feed")}}})},children:[r.like_count," ",n("APPS.INSTAGRAM.LIKES")]}),a("div",{className:"caption",children:[e("span",{className:"user",onClick:E=>{E.stopPropagation(),c.fetchAndSetProfile(r.username)},children:r.username}),Ie(r.caption)," "]}),e("div",{className:"comments",onClick:E=>{E.stopPropagation(),c.fetchAndSetComments({id:r.id,username:r.username,avatar:r.avatar,verified:r.verified,caption:r.caption,timestamp:r.timestamp})},children:r.comment_count>0?n("APPS.INSTAGRAM.VIEW_ALL_COMMENTS").format({count:r.comment_count}):n("APPS.INSTAGRAM.FIRST_COMMENT")}),e("div",{className:"date",children:et(r.timestamp)})]})]})}const It=i=>{var v;const[d,S]=s.useState(i.active),c=ae(fe.Settings),A=s.useRef(null);return s.useEffect(()=>{var l,m,g;S(i.active),!(!A.current||!((l=c==null?void 0:c.sound)!=null&&l.volume))&&i.active&&(A.current.volume=c.sound.volume,A.current.currentTime=0,i.active?(m=A.current)==null||m.play().catch(I=>{}):(g=A.current)==null||g.pause().catch(I=>{}))},[i.active]),s.useEffect(()=>{var l;!A.current||!((l=c==null?void 0:c.sound)!=null&&l.volume)||i.active&&(A.current.volume=c.sound.volume)},[(v=c==null?void 0:c.sound)==null?void 0:v.volume]),e("video",{ref:A,src:i.attachment,autoPlay:!0,loop:!0,muted:!i.active,onLoadedMetadata:l=>{i.active&&(l.currentTarget.volume=c.sound.volume)}})},X={account:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0},accounts:{lb:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,following:2,followers:13,posts:2,followingList:["loaf","breze"],followerList:["loaf","breze"]},breze:{username:"breze",name:"Breze",bio:`Hey, its breze 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","loaf"],followerList:["lb","loaf"]},loaf:{username:"loaf",name:"Loaf Scripts",bio:`Loaf Scritps official account 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","breze"],followerList:["lb","breze"]}},posts:[{id:"1",username:"breze",name:"Breze",verified:!0,caption:"sunsets are the best",media:'["https://r2.fivemanage.com/images/GRBUI6C4orbD.webp", "https://r2.fivemanage.com/images/rafgjPwSYnn2.png"]',location:"Sandy Shores",like_count:2,comment_count:0,timestamp:Date.now()-1e3*60*60*24*1},{id:"2",username:"lb",name:"LB",verified:!0,caption:"dump",media:'["https://r2.fivemanage.com/images/upTPndukc2PD.webp", "https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp"]',location:"Los Santos",like_count:8,comment_count:2,timestamp:Date.now()-1e3*60*60*24*2}],stories:[{id:"1",username:"lb",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,seen:0,media:[{id:"2",image:"https://r2.fivemanage.com/images/oRKcdeTA8oBy.png",timestamp:Date.now()-1e3*60*60*4,seen:!1,views:2,viewers:[{username:"Breze"},{username:"Loaf"}]}]},{id:"2",username:"breze",verified:!0,seen:0,media:[{id:"1",image:"https://r2.fivemanage.com/images/otBLdXG7WFeu.webp",timestamp:Date.now()-1e3*60*60*2,seen:!1},{id:"2",image:"https://r2.fivemanage.com/images/ZsmnyJOA2rc5.png",timestamp:Date.now()-1e3*60*60*3,seen:!1}]},{id:"3",username:"loaf",verified:!0,seen:1,media:[{id:"1",image:"https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp",timestamp:Date.now()-1e3*60*60*3,seen:!0},{id:"2",image:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*4,seen:!0}]}],comments:[{postId:"2",user:{username:"breze",verified:!0},comment:{id:"1",content:"nice",timestamp:Date.now()-1e3*60*60*24,likes:0}},{postId:"2",user:{username:"loaf",verified:!0},comment:{id:"2",content:"haha, nice picture",timestamp:Date.now()-1e3*60*60*22,likes:1,liked:!0}}],messages:[{id:"1",username:"breze",name:"Breze",verified:!0,content:"hey",messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,content:"yoo, your last post was fire",messages:[{id:"3",sender:"loaf",content:"yoo, your last post was fire",timestamp:Date.now()-1e3*60*60*8}],timestamp:Date.now()-1e3*60*60*8}],notifications:[{type:"like_photo",username:"loaf",name:"Loaf Scripts",postId:"1",photo:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function Et(){const{Account:i,View:d,Func:S,Stories:c}=s.useContext(K),[A,v]=d,[l]=i,[m,g]=s.useState([]),[I,r]=s.useState([]),[t,P]=c,[C,T]=s.useState(0),[f,p]=s.useState(!1),[O,G]=s.useState(!1),[L,M]=s.useState(null);s.useEffect(()=>{ue("Instagram")&&N("Instagram",{action:"getPosts",filters:{following:!0},page:0},X.posts).then(o=>{if(!o)return _("error","Failed to fetch posts");g(o)})},[]),s.useEffect(()=>{ue("Instagram")&&A==="feed"&&(N("Instagram",{action:"getLives"}).then(o=>{o&&r(o)}),N("Instagram",{action:"getStories"},X.stories).then(o=>{if(!o)return _("warning","Failed to fetch stories");P([...o.sort((u,R)=>{if(u.seen===R.seen)return 0;if(u.seen===1)return 1;if(R.seen===1)return-1})])}))},[A]);const x=new IntersectionObserver(E,{rootMargin:"20px",threshold:.5});function E(o){o.forEach(u=>{if(u.isIntersecting){let V=u.target.getAttribute("data-id");M(V)}})}const b=()=>{if(f||O)return;let o=document.querySelector("#last");if(!o)return;document.querySelectorAll(".post").forEach(V=>x.observe(V)),!me(o)&&(G(!0),N("Instagram",{action:"getPosts",filters:{following:!0},page:C+1},null).then(V=>{V&&V.length>0?(g([...m,...V]),G(!1)):p(!0)}),T(V=>V+1))};s.useEffect(()=>{const o=document.querySelector(".stories");return o==null||o.addEventListener("wheel",u=>{u.preventDefault(),o.scrollLeft+=u.deltaY}),()=>{o==null||o.removeEventListener("wheel",u=>{u.preventDefault(),o.scrollLeft+=u.deltaY})}},[]),te("instagram:updateLives",o=>{o&&r(o)});const D=()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.GO_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"goLive",user:{username:l.username,avatar:S.getAvatar(l==null?void 0:l.avatar),verified:l.verified}}).then(o=>{if(!o)return _("error","Failed to go live");ce.set({host:l.username,participants:[{username:l.username,name:l.username,avatar:S.getAvatar(l==null?void 0:l.avatar),verified:l.verified}],viewers:0}),v("live")})}}]})};return a(j,{children:[a("div",{className:"instagram-header feed-header",children:[a("div",{className:"name",children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e(We,{onClick:()=>v("dmList")})]}),a("div",{className:"feed",onScroll:b,children:[e("div",{className:"stories-wrapper",children:a("div",{className:"stories",children:[a("div",{className:"story self",onClick:()=>{z.ContextMenu.set({buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE"),cb:()=>D()},{title:n("APPS.INSTAGRAM.CREATE_STORY"),cb:()=>{var o,u,R;z.Gallery.set({includeVideos:!0,allowExternal:(R=(u=(o=he)==null?void 0:o.value)==null?void 0:u.AllowExternal)==null?void 0:R.InstaPic,onSelect:V=>{N("Instagram",{action:"addToStory",media:V.src},Math.random().toString(36).substring(7)).then(h=>{if(!h)return _("error","Failed to add story");P([{username:l.username,avatar:l.avatar,verified:l.verified,seen:0,id:h},...t.filter(W=>W.username!==l.username)])})}})}}]})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(l==null?void 0:l.avatar)})`},children:e("div",{className:"plus",children:e("i",{className:"far fa-plus"})})}),e("div",{className:"name",children:n("APPS.INSTAGRAM.YOUR_STORY")})]}),Object.keys(I).map(o=>{var u;return a("div",{className:"story",onClick:()=>{var R;N("Instagram",{action:"viewLive",username:((R=I[o])==null?void 0:R.participant)??o}).then(V=>{var y,$,q,k;if(!V)return _("error","Failed to view live, perhaps it ended?");let h=(y=I[o])!=null&&y.participant?I[($=I[o])==null?void 0:$.participant]:I[o],W=(h==null?void 0:h.participants)??[];W.unshift({username:((q=I[o])==null?void 0:q.participant)??o,name:h.name,avatar:h.avatar,verified:h.verified,id:h.id}),ce.set({host:((k=I[o])==null?void 0:k.participant)??o,participants:W,viewers:V}),v("live")})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar((u=I[o])==null?void 0:u.avatar)})`},children:e("img",{className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"})}),e("div",{className:"name",children:o})]},o)}),t.map(o=>a("div",{className:"story",onClick:u=>{let[R,V]=qe(u);S.fetchAndSetStory(o,null,{x:R,y:V})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(o==null?void 0:o.avatar)})`},children:e("img",{className:"circle","data-seen":o.seen===1,src:"./assets/img/icons/instagram/StoryCircle.svg"})}),e("div",{className:"name",children:o.username})]},o.username))]})}),m.length===0&&e("div",{className:"no-posts",children:n("APPS.INSTAGRAM.EMPTY_FEED")}),m.map((o,u)=>{let R=u===m.length-1;return e(Ke,{data:o,active:L===o.id,last:R},o.id)})]})]})}function De(){const{View:i,Account:d,LoggedIn:S}=s.useContext(K),c=ae(fe.Settings),[A,v]=s.useState(""),[l,m]=s.useState(""),[g,I]=s.useState(""),[r,t]=i,[P,C]=d,[T,f]=S,[p,O]=s.useState("login"),G=()=>{N("Instagram",{action:"logIn",username:l,password:g},{success:!!X.accounts[l],account:X.accounts[l]}).then(M=>{if(M.success&&M.account)N("isAdmin",null,!1).then(x=>{ie.APPS.INSTAGRAM.account.set(M.account),C({...M.account,isAdmin:x}),t("feed"),f(!0)});else{if(M.error)return z.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n(`APPS.INSTAGRAM.${M.error}`),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});_("error","Instagram LogIn Error",M.error)}})},L=()=>{let M=l.toLowerCase().replace(/\s/g,""),x=M.match(he.value.UsernameFilter);if(!x||(x==null?void 0:x[0])!==M||M.length<3||M.length>15){_("warning","Username did not match regex"),z.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});return}N("Instagram",{action:"createAccount",name:A,username:M,password:g},{success:!X.accounts[M]}).then(E=>{if(E.success)N("isAdmin").then(b=>{let D={name:A,username:M,posts:0,followers:0,following:0};ie.APPS.INSTAGRAM.account.set(D),C({...D,isAdmin:b}),t("feed"),f(!0)});else{if(E.error)return z.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n(`APPS.INSTAGRAM.${E.error}`),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});_("error","couldn't create account",E)}})};return s.useEffect(()=>{v(""),m(""),I("")},[p]),e("div",{className:"log-in",children:a(j,{children:[e("div",{className:"wrapper",children:p==="login"?a(j,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":c.display.theme}),a("div",{className:"form",children:[e(le,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:M=>m(M.target.value.replace(/\s/g,"")),maxLength:15},1),e(le,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:M=>I(M.target.value),maxLength:50},3),e("div",{className:"button",onClick:G,children:n("APPS.INSTAGRAM.LOG_IN")})]})]}):a(j,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":c.display.theme}),a("div",{className:"form",children:[e(le,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),type:"text",onChange:M=>v(M.target.value),maxLength:20},2),e(le,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:M=>m(M.target.value.replace(/\s/g,"")),maxLength:15},4),e(le,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:M=>I(M.target.value),maxLength:50}),e("div",{className:"button",onClick:L,children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]})]})}),e("div",{className:"footer",children:p==="login"?a(j,{children:[n("APPS.INSTAGRAM.NOT_HAVE_ACCOUNT")," ",e("span",{onClick:()=>O("createAccount"),children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]}):a(j,{children:[n("APPS.INSTAGRAM.HAVE_ACCOUNT")," ",e("span",{onClick:()=>O("login"),children:n("APPS.INSTAGRAM.LOG_IN")})]})})]})})}const Le=Ue(!1);function Ct(){var P,C,T,f,p;const{Func:i}=s.useContext(K),d=ae(Me),[S,c]=s.useState(null),A=ae(Le),[v,l]=s.useState(0),[m,g]=s.useState(!1),[I,r]=s.useState(!1);s.useEffect(()=>{ue("Instagram")&&N("Instagram",{action:"getNotifications"},X.notifications).then(O=>{if(!O)return _("warning","Failed to fetch notifications, or no results?");c(O)})},[d==null?void 0:d.active]);const t=()=>{if(m||I)return;let O=document.querySelector("#last");if(!O)return;!me(O)&&(r(!0),N("Instagram",{action:"getNotifications",page:v+1},null).then(L=>{L&&(L==null?void 0:L.notifications.length)>0?(c(M=>({...M,notifications:[...M.notifications,...L.notifications]})),r(!1)):g(!0)}),l(L=>L+1))};return a("div",{className:"notifications-container",children:[e(Ee,{children:A&&e(Tt,{})}),e("div",{className:"notifications-header",children:n("APPS.INSTAGRAM.ACTIVITY")}),a("div",{className:"notifications-body",onScroll:t,children:[((P=S==null?void 0:S.requests)==null?void 0:P.total)>0&&a("div",{className:"follow-requests",onClick:()=>Le.set(!0),children:[a("div",{className:"item-data",children:[e("div",{className:"profile-pictures","data-multiple":S.requests.total>1,children:S.requests.recent.map((O,G)=>e("img",{src:i.getAvatar(O.avatar)},G))}),a("div",{className:"item-body",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("div",{className:"subtitle",children:S.requests.total>1?n("APPS.INSTAGRAM.ANDOTHERS").format({username:(C=S.requests.recent[0])==null?void 0:C.username,amount:((T=S.requests)==null?void 0:T.total)-1}):(f=S.requests.recent[0])==null?void 0:f.username})]})]}),a("div",{className:"actions",children:[e("div",{className:"blue-dot"}),e(Be,{})]})]}),(p=S==null?void 0:S.notifications)==null?void 0:p.map((O,G)=>{let L=G===S.notifications.length-1?"last":"";return e(wt,{notification:O,last:L},G)})]})]})}const Tt=()=>{const{Func:i}=s.useContext(K),[d,S]=s.useState(""),[c,A]=s.useState([]),[v,l]=s.useState(0),[m,g]=s.useState(!1),[I,r]=s.useState(!1),t=[{class:"follow",label:n("APPS.INSTAGRAM.CONFIRM"),action:!0},{class:"following",label:n("APPS.INSTAGRAM.DELETE"),action:!1}];s.useEffect(()=>{N("Instagram",{action:"getFollowRequests",page:0},[]).then(C=>{if(!C)return _("warning","Failed to fetch follow requests");_("info","Fetched follow requests",C),A(C)})},[]);const P=()=>{if(m||I)return;let C=document.querySelector("#lastrequest");if(!C)return;!me(C)&&(r(!0),N("Instagram",{action:"getFollowRequests",page:v+1},null).then(f=>{f&&(f==null?void 0:f.length)>0?(A(f),r(!1)):g(!0)}),l(f=>f+1))};return a(Ce.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"requests-container",children:[a("div",{className:"requests-header",children:[e("div",{className:"icon",children:e(we,{onClick:()=>Le.set(!1)})}),e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("span",{})]}),a("div",{className:"requests-body",children:[e(Ge,{placeholder:n("SEARCH"),onChange:C=>S(C.target.value)}),e("div",{className:"items",onScroll:P,children:c.filter(C=>C.username.toLowerCase().includes(d.toLowerCase())||C.name.toLowerCase().includes(d.toLowerCase())).map((C,T)=>{let f=T===c.length-1?"lastrequest":"";return a("div",{id:f,className:"item",children:[a("div",{className:"user",onClick:()=>i.fetchAndSetProfile(C.username),children:[e("img",{className:"avatar",src:i.getAvatar(C.avatar)}),a("div",{className:"user-info",children:[a("div",{className:"username",children:[C.username,C.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:C.name})]})]}),e("div",{className:"buttons",children:t.map((p,O)=>e("div",{className:$e("button",p.class),onClick:G=>{G.stopPropagation(),N("Instagram",{action:"handleFollowRequest",username:C.username,accept:p.action},!0).then(L=>{if(!L)return _("warning","Failed to handle follow request");A(M=>M.filter(x=>x.username!==C.username))})},children:p.label},O))})]},T)})})]})]})},wt=({notification:i,last:d})=>{const{Account:S,Func:c}=s.useContext(K),[A]=S,[v,l]=s.useState(i.isFollowing);switch(i.type){case"like_photo":return a("div",{className:"notification-item",id:d,onClick:()=>c.fetchAndSetPost(i.postId),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:c.getAvatar(i.avatar),onClick:g=>{g.stopPropagation(),c.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_PHOTO"),e("span",{className:"date",children:ge(i.timestamp)})]})]}),oe(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"like_comment":return e("div",{className:"notification-item",id:d,onClick:()=>c.fetchAndSetPost(i.postId,!0),children:a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:c.getAvatar(i.avatar),onClick:g=>{g.stopPropagation(),c.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_COMMENT").format({comment:i.comment}),e("span",{className:"date",children:ge(i.timestamp)})]})]})});case"comment":return a("div",{className:"notification-item",id:d,onClick:()=>c.fetchAndSetPost(i.postId,!0),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:c.getAvatar(i.avatar),onClick:g=>{g.stopPropagation(),c.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.COMMENTED").format({comment:i.comment}),e("span",{className:"date",children:ge(i.timestamp)})]})]}),oe(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"follow":return a("div",{className:"notification-item",id:d,onClick:()=>c.fetchAndSetProfile(i.username),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:c.getAvatar(i.avatar),onClick:()=>c.fetchAndSetProfile(i.username)}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.FOLLOWED"),e("span",{className:"date",children:ge(i.timestamp)})]})]}),e("div",{className:`button ${v?"following":"follow"}`,onClick:g=>{g.stopPropagation(),A.username!==i.username&&(v?z.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:i.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"toggleFollow",data:{username:i.username,following:!v}},!0).then(()=>{l(I=>!I)})}}]}):N("Instagram",{action:"toggleFollow",data:{username:i.username,following:!v}},!0).then(()=>{l(I=>!I)}))},children:v?n("APPS.INSTAGRAM.FOLLOWING"):n("APPS.INSTAGRAM.FOLLOW")})]})}};function Rt(){var F,B,ee,Q,Pe,Te;const{View:i,Profile:d,Account:S,Func:c,GoBack:A,Post:v,UserPanel:l,LoggedIn:m,Dm:g}=s.useContext(K),[I,r]=i,[t,P]=d,[C,T]=m,[f,p]=S,[O,G]=v,[L,M]=g,[x,E]=l,[b,D]=A,[o,u]=s.useState(!1),[R,V]=s.useState(!1),[h,W]=s.useState(null),[y,$]=s.useState(0),[q,k]=s.useState(!1),[H,Y]=s.useState(!1);s.useEffect(()=>{ue("Instagram")&&t.username&&(u(f.username===t.username),N("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:0}).then(U=>{U&&W(U)}))},[t==null?void 0:t.username]);const re=()=>{if(q||H)return;let U=document.querySelector("#last");if(!U)return;!me(U)&&(Y(!0),N("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:y+1}).then(Z=>{Z&&Z.length>0?(W([...h,...Z]),Y(!1)):k(!0)}),$(Z=>Z+1))},de=()=>{if(!t.name)return _("warning","Name is required, not saving");N("Instagram",{action:"updateProfile",data:{name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}},!0).then(U=>{if(!U)return _("warning","Failed to update profile");ie.APPS.INSTAGRAM.account.set({...f,name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}),V(!1),_("info","Successfully updated profile")})};te("instagram:updateProfileData",U=>{U.username===t.username&&P({...t,[U.data]:U.increment?t[U.data]+1:t[U.data]-1})});const Ne=s.useRef(!0);s.useEffect(()=>{if(Ne.current){Ne.current=!1;return}N("Instagram",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}},!0)},[t.isFollowing]);const w=()=>{N("AccountSwitcher",{action:"getAccounts",app:"Instagram"}).then(U=>{var se;if(!U)return _("info","No accounts found");let J=f.isAdmin,Z=(se=U==null?void 0:U.filter(ne=>ne!==t.username))==null?void 0:se.map(ne=>({title:ne,cb:()=>{N("AccountSwitcher",{action:"switch",app:"Instagram",account:ne}).then(Re=>{N("Instagram",{action:"isLoggedIn"}).then(Ae=>{Ae?(ie.APPS.INSTAGRAM.account.set(Ae),p({...Ae,isAdmin:J}),r("feed"),T(!0)):ie.APPS.INSTAGRAM.account.set(null)})})}}));z.ContextMenu.set({buttons:[{title:f.username},...Z,{title:n("APPS.INSTAGRAM.ADD_ACCOUNT"),cb:()=>{T(!1)}}]})})};return e(j,{children:t&&a("div",{className:"profile",children:[e(Ee,{children:R&&a(Ce.div,{className:"edit-profile",initial:{y:750,opacity:.75},animate:{y:0,opacity:1},exit:{y:750,opacity:.75},transition:{duration:.3,ease:"easeInOut"},children:[a("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>V(!1),children:n("CANCEL")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>de(),children:n("APPS.INSTAGRAM.DONE")})]}),a("div",{className:"edit-profile-body",children:[a("div",{className:"profile-picture",onClick:()=>{var U,J,Z;z.Gallery.set({allowExternal:(Z=(J=(U=he)==null?void 0:U.value)==null?void 0:J.AllowExternal)==null?void 0:Z.InstaPic,onSelect:se=>{P({...t,avatar:se.src}),p({...f,avatar:se.src})}})},children:[e("img",{src:c.getAvatar(t.avatar),alt:"profile"}),e("span",{children:n("APPS.INSTAGRAM.CHANGE_PICTURE")})]}),a("div",{className:"profile-items",children:[a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.NAME")}),e(le,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),onChange:U=>{P({...t,name:U.target.value})},maxLength:30,defaultValue:t.name})]}),a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.BIO")}),e(ze,{placeholder:n("APPS.INSTAGRAM.BIO"),onChange:U=>{P({...t,bio:U.target.value})},maxLength:100,defaultValue:t.bio??""})]}),a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.PRIVATE")}),e("div",{className:"switch-wrapper",children:e(vt,{checked:t.private,onChange:()=>P({...t,private:!t.private})})})]})]}),a("div",{className:"buttons",children:[e("div",{className:"button blue",onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"signOut"},!0).then(U=>{if(!U)return _("error","Failed to sign out");T(null),p(null),ie.APPS.INSTAGRAM.account.set(null)})}}]})},children:n("APPS.INSTAGRAM.SIGN_OUT")}),((ee=(B=(F=he)==null?void 0:F.value)==null?void 0:B.ChangePassword)==null?void 0:ee.InstaPic)&&e("div",{className:"button red",onClick:()=>at("Instagram",()=>{}),children:n("APPS.INSTAGRAM.CHANGE_PASSWORD")}),((Te=(Pe=(Q=he)==null?void 0:Q.value)==null?void 0:Pe.DeleteAccount)==null?void 0:Te.InstaPic)&&e("div",{className:"button red",onClick:()=>{st("Instagram",()=>{T(null),p(null),ie.APPS.INSTAGRAM.account.set(null)})},children:n("APPS.INSTAGRAM.DELETE_ACCOUNT")})]})]})]})}),o?e("div",{className:"instagram-header",children:a("div",{className:"name",style:{cursor:"pointer"},onClick:()=>w(),children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(xe,{})]})}):a("div",{className:"profile-header",children:[e("i",{className:"fas fa-chevron-left",onClick:()=>{b!=null&&b.cb?b.cb():r("feed")}}),a("div",{className:"name",children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("span",{})]}),a("div",{className:"profile-body",children:[a("div",{className:"profile-wrapper",children:[a("div",{className:"top",children:[a("div",{className:"profile-picture",style:{backgroundImage:`url(${c.getAvatar(t.avatar)})`},children:[t.isLive&&(!t.private||t.isFollowing||!o)?e("img",{onClick:()=>{N("Instagram",{action:"getLives"}).then(U=>{var Z;let J=t.username;N("Instagram",{action:"viewLive",username:((Z=U[J])==null?void 0:Z.participant)??J}).then(se=>{var Ae,be,ke,ye;if(!se)return _("error","Failed to view live, perhaps it ended?");let ne=(Ae=U[J])!=null&&Ae.participant?U[(be=U[J])==null?void 0:be.participant]:U[J],Re=(ne==null?void 0:ne.participants)??[];Re.unshift({username:((ke=U[J])==null?void 0:ke.participant)??J,name:ne.name,avatar:ne.avatar,verified:ne.verified,id:ne.id}),ce.set({host:((ye=U[J])==null?void 0:ye.participant)??J,participants:Re,viewers:se}),r("live")})})},className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"}):null,t.hasStory&&!t.isLive&&(!t.private||t.isFollowing||o)?e("img",{className:"circle","data-seen":t.seenStory===1,src:"./assets/img/icons/instagram/StoryCircle.svg",onClick:U=>{let[J,Z]=qe(U);c.fetchAndSetStory({username:t.username,avatar:t.avatar,verified:t.verified},null,{x:J,y:Z})}}):null]}),a("div",{className:"stats",children:[a("div",{children:[e("div",{className:"value",children:t.posts}),e("div",{className:"label",children:t.posts===1?n("APPS.INSTAGRAM.POST"):n("APPS.INSTAGRAM.POSTS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!o,onClick:()=>{!t.isFollowing&&t.private&&!o||E({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWERS"),username:t.username,cb:()=>{P(t),r("profile"),E({display:!1})}}})},children:[e("div",{className:"value",children:t.followers}),e("div",{className:"label",children:t.followers===1?n("APPS.INSTAGRAM.FOLLOWER"):n("APPS.INSTAGRAM.FOLLOWERS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!o,onClick:()=>{!t.isFollowing&&t.private&&!o||E({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWING"),username:t.username,cb:()=>{P(t),r("profile"),E({display:!1})}}})},children:[e("div",{className:"value",children:t.following}),e("div",{className:"label",children:n("APPS.INSTAGRAM.FOLLOWING")})]})]})]}),e("div",{className:"name",children:t.name}),e("div",{className:"description",children:Ie(t.bio)??""}),e("div",{className:"buttons",children:o?o&&e("div",{className:"button edit",onClick:()=>V(!0),children:n("APPS.INSTAGRAM.EDIT_PROFILE")}):a(j,{children:[e("div",{className:$e("button",t.requested||t.isFollowing?"following":"follow"),onClick:()=>{t.isFollowing?z.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{P({...t,isFollowing:!1})}}]}):t.private?N("Instagram",{action:"toggleFollow",data:{username:t.username,following:!0}},!0).then(U=>{U&&P({...t,requested:!t.requested})}):P({...t,isFollowing:!0})},children:t.isFollowing?n("APPS.INSTAGRAM.FOLLOWING"):t.requested?n("APPS.INSTAGRAM.REQUESTED"):n("APPS.INSTAGRAM.FOLLOW")}),!t.private||t.isFollowing?e("div",{className:"button following",onClick:()=>{M({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),r("dm")},children:n("APPS.INSTAGRAM.MESSAGE")}):null]})})]}),t.private&&!t.isFollowing&&!o?a("div",{className:"private-account",children:[e("div",{className:"icon",children:e(nt,{})}),e("div",{className:"title",children:n("APPS.INSTAGRAM.PRIVATE_ACCOUNT")}),e("div",{className:"description",children:n("APPS.INSTAGRAM.PRIVATE_ACCOUNT_DESCRIPTION")})]}):e("div",{className:"posts",onScroll:re,children:h&&h.map((U,J)=>{let Z=J===h.length-1?"last":"",se=JSON.parse(U.media)[0];return e("div",{id:Z,onClick:()=>{D({cb:()=>{P(t),r("profile"),G(null),D(null)}}),G(U),r("post")},children:oe(se)?e("video",{src:se,muted:!0,autoPlay:!0,loop:!0}):e("img",{src:se})},J)})})]})]})})}function Lt(){const{Func:i,View:d,GoBack:S,Post:c}=s.useContext(K),[A,v]=d,[l,m]=S,[g,I]=c,[r,t]=s.useState(""),[P,C]=s.useState(""),[T,f]=s.useState([]);s.useState([]);const[p,O]=s.useState([]),[G,L]=s.useState(0),[M,x]=s.useState(!1),[E,b]=s.useState(!1);s.useEffect(()=>{ue("Instagram")&&N("Instagram",{action:"getPosts",page:0},X.posts).then(o=>{if(!o)return _("warning","No posts received in getPosts");O(o)})},[]),s.useEffect(()=>{const o=setTimeout(()=>t(P),500);return()=>clearTimeout(o)},[P]),s.useEffect(()=>{r.length>0&&N("Instagram",{action:"search",query:r},Object.keys(X.accounts).map(o=>X.accounts[o])).then(o=>{o&&f(o)})},[r]);const D=()=>{if(M||E||r.length>0)return;let o=document.querySelector("#last");if(!o)return;!me(o)&&(b(!0),N("Instagram",{action:"getPosts",page:G+1},null).then(R=>{R&&R.length>0?(O([...p,...R]),b(!1)):x(!0)}),L(R=>R+1))};return a("div",{className:"search-container",children:[e("div",{className:"search-header",children:e(Ge,{placeholder:n("SEARCH"),onChange:o=>C(o.target.value)})}),e("div",{className:"search-body",onScroll:D,children:r.length>0?e("div",{className:"search-results",children:T.map(o=>a("div",{className:"item",onClick:()=>i.fetchAndSetProfile(o.username),children:[e("div",{className:"profile-picture",children:e("img",{src:i.getAvatar(o.avatar),alt:"profile"})}),a("div",{className:"user",children:[a("div",{className:"username",children:[o.username,o.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:o.name})]})]}))}):e("div",{className:"feed-grid",children:p.map((o,u)=>{let V=Math.floor(u/3)%2==0,h=!1;h=u%3==(V?1:0),p[u+1]||(h=!1);let W=JSON.parse(o.media)[0],y=u==p.length-1?"last":"";return e("div",{id:y,className:`grid-post${h?" big":""}`,onClick:()=>{m({cb:()=>{v("search"),m(null)}}),I(o),v("post")},children:oe(W)?e("video",{src:W,autoPlay:!0,loop:!0,muted:!0}):e("img",{src:W,alt:"post"})},u)})})})]})}function Ot(){const{View:i,GoBack:d,Comments:S,Account:c,Func:A}=s.useContext(K),[v]=c,[l,m]=i,[g]=d,[I,r]=S,[t,P]=s.useState(""),C=s.useRef(null),[T,f]=s.useState(0),[p,O]=s.useState(!1),[G,L]=s.useState(!1),M=()=>{t.length!==0&&N("Instagram",{action:"postComment",data:{postId:I.post.id,comment:t}},Math.random().toString(36).substring(7)).then(E=>{if(!E)return _("error","Failed to post comment, no ");P(""),C.current.value="",r({...I,post:I.post,comments:[{user:{username:v.username,avatar:v.avatar,verified:v.verified},comment:{id:E,content:t,timestamp:new Date().getTime(),likes:0,liked:!1}},...I.comments]})})},x=()=>{if(p||G)return;let E=document.querySelector("#last");if(!E)return;!me(E)&&(L(!0),N("Instagram",{action:"getComments",postId:I.post.id,page:T+1},null).then(D=>{D&&D.length>0?(r({...I,comments:[...I.comments,...D]}),L(!1)):O(!0)}),f(D=>D+1))};return a("div",{className:"comments-container",children:[a("div",{className:"comments-header",children:[e(we,{onClick:()=>{g&&(g!=null&&g.cb)?g.cb():m("feed")}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.COMMENTS")}),e("span",{})]}),a("div",{className:"comments-body",onScroll:x,children:[a("div",{className:"post-info",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(I.post.avatar),alt:"profile"})}),a("div",{className:"post-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",children:[I.post.username,I.post.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),Ie(I.post.caption)]}),e("div",{className:"actions",children:e("div",{className:"date",children:je(I.post.timestamp)})})]})]}),I.comments.map((E,b)=>{let D=b===I.comments.length-1;return e(Mt,{data:E,last:D},b)})]}),a("div",{className:"add-comment",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(v.avatar),alt:"profile"})}),a("div",{className:"input-container",children:[e(le,{type:"text",ref:C,placeholder:n("APPS.INSTAGRAM.ADD_COMMENT_AS").format({name:v.username}),onKeyPress:E=>{E.key==="Enter"&&M()},onChange:E=>P(E.target.value)}),e("div",{className:"send",onClick:M,children:n("APPS.INSTAGRAM.POST")})]})]})]})}const Mt=({data:i,last:d})=>{const{Func:S}=s.useContext(K),[c,A]=s.useState(i.comment.liked),[v,l]=s.useState(i.comment.likes);return te("instagram:updateCommentLikes",m=>{!m||m.commentId!==i.comment.id||l(g=>g+(m.increment?1:-1))}),a("div",{className:"comment",id:d&&"last",children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",onClick:()=>S.fetchAndSetProfile(i.user.username),children:e("img",{src:S.getAvatar(i.user.avatar),alt:"profile"})}),a("div",{className:"comment-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",onClick:()=>S.fetchAndSetProfile(i.user.username),children:[i.user.username,i.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),i.comment.content]}),a("div",{className:"actions",children:[e("div",{className:"date",children:je(i.comment.timestamp)}),a("div",{className:"likes",children:[v," ",n("APPS.INSTAGRAM.LIKES").toLowerCase()]})]})]})]}),e(Ye,{liked:c,onClick:()=>{i.comment.id&&N("Instagram",{action:"toggleLike",data:{postId:i.comment.id,toggle:!c,isComment:!0}},!c).then(m=>{A(m)})}})]})},je=i=>{const d=new Date(i),c=new Date().getTime()-d.getTime(),A=Math.floor(c/(1e3*60*60*24)),v=Math.floor(c/(1e3*60*60)),l=Math.floor(c/(1e3*60));let m="";return A<1?v<1?m=`${l}m`:m=`${v}h`:A<30?m=`${A}d`:m=`${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`,m};function Gt(){const{View:i}=s.useContext(K),[d,S]=i,[c,A]=s.useState(0),[v,l]=s.useState([]),[m,g]=s.useState(""),[I,r]=s.useState(null);return s.useEffect(()=>{var t,P,C;c===0&&z.Gallery.set({allowExternal:(C=(P=(t=he)==null?void 0:t.value)==null?void 0:P.AllowExternal)==null?void 0:C.InstaPic,multiSelect:!0,includeVideos:!0,onCancel:()=>S("feed"),onSelect:T=>{T!=null&&T.length?l(T.map(f=>f.src)):l([T.src]),A(1)}})},[c]),e("div",{className:"newpost-container","data-camera":!1,children:c===1&&a(j,{children:[a("div",{className:"newpost-header",children:[e(we,{onClick:()=>A(0)}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{N("Instagram",{action:"newPost",data:{caption:m,location:I,images:v}},!0).then(t=>{if(!t)return _("warning","Failed to post");S("feed")})},children:n("APPS.INSTAGRAM.POST")})]}),e("div",{className:"newpost-body",children:a("div",{className:"newpost-content",children:[a("div",{className:"caption",children:[e("div",{className:"attachments",style:{width:`calc(4rem + ${v.length*20}px)`},children:v.slice(0,5).map((t,P)=>e("div",{className:"attachment",style:{left:`${P*20}px`,top:`${P*5}px`,zIndex:P+1},children:oe(t)?e(bt,{src:t}):e("img",{src:t,alt:"image"})},P))}),e("div",{className:"text-area",children:e(ze,{onChange:t=>g(t.target.value),placeholder:n("APPS.INSTAGRAM.CAPTION_PLACEHOLDER")})})]}),e("div",{className:"item",onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.CHOOSE_LOCATION.TITLE"),description:n("APPS.INSTAGRAM.CHOOSE_LOCATION.DESCRIPTION"),input:{type:"text",maxCharacters:30,onChange:t=>r(t)},buttons:[{title:n("APPS.INSTAGRAM.CHOOSE_LOCATION.CANCEL")},{title:n("APPS.INSTAGRAM.CHOOSE_LOCATION.PROCEED")}]})},children:I?a(j,{children:[a("div",{className:"label",children:[e(it,{}),I]}),e(ve,{onClick:t=>{t.stopPropagation(),r(null)}})]}):a(j,{children:[e("div",{className:"label",children:n("APPS.INSTAGRAM.LOCATION")}),e(Be,{})]})})]})})]})})}const bt=({src:i})=>{const[d,S]=s.useState(null);return a(j,{children:[e("video",{src:i,crossOrigin:"anonymous",controls:!1,onMouseOver:A=>A.currentTarget.play(),onMouseOut:A=>A.currentTarget.pause(),onLoadedMetadata:A=>S(A.currentTarget.duration)}),d&&e("div",{className:"video-duration",children:(A=>{const v=Math.floor(A/60),l=rt(A-v*60,0);return`${v}:${l<10?"0"+l:l}`})(d)})]})};function kt(){const{View:i,Post:d,GoBack:S}=s.useContext(K),[c,A]=i,[v]=S,[l]=d;return e(j,{children:l&&e("div",{className:"viewpost-container",children:a(j,{children:[a("div",{className:"viewpost-header",children:[e(we,{onClick:()=>{v&&(v.cb?v.cb():A(v.view))}}),e("div",{className:"name",children:l.username??"Unknown"}),e("span",{})]}),e("div",{className:"profile-body",children:e(Ke,{data:l})})]})})})}function yt(){const{Func:i,Account:d,Dm:S,View:c,GoBack:A}=s.useContext(K);ae(fe.Settings);const[v]=d,[l,m]=c,[g,I]=S,[r,t]=A,[P,C]=s.useState([]),T=s.useRef(null),f=s.useRef(0),[p,O]=s.useState({content:"",attachments:[]}),[G,L]=s.useState(0),[M,x]=s.useState(!1),[E,b]=s.useState(!1);s.useEffect(()=>{var u;x(!1),b(!1),L(0),C([]),N("Instagram",{action:"getMessages",page:0,username:g.username},((u=X.messages.find(R=>R.username===g.username))==null?void 0:u.messages)??[]).then(R=>{R&&C(R.reverse())})},[]),te("instagram:newMessage",u=>{if(g.username!==u.sender)return;C([...P,u]);let R=document.querySelector(".dm-body-container");R.scrollTop=R.scrollHeight});const D=()=>{p.content.length===0&&p.attachments.length===0||N("Instagram",{action:"sendMessage",username:g.username,message:{content:p.content,attachments:p.attachments.length>0?p.attachments:null}},!0).then(u=>{if(!u)return;T.current.value="",C([...P,{sender:v.username,recipient:g.username,content:p.content,attachments:p.attachments,timestamp:Date.now()}]),O({content:"",attachments:[]});let R=document.querySelector(".dm-body-container");R.scrollTop=R.scrollHeight})},o=()=>{if(M||E)return;let u=document.querySelector("#last");if(!u)return;!me(u)&&(b(!0),N("Instagram",{action:"getMessages",page:G+1,username:g.username},null).then(V=>{if(V&&V.length>0){let h=document.querySelector(".dm-body-container");f.current=h.scrollHeight,C([...V.reverse(),...P]),b(!1)}else x(!0)}),L(V=>V+1))};return s.useEffect(()=>{let u=document.querySelector(".dm-body-container");const R=u.scrollHeight;u.scrollTop+=R-f.current,u.scroll},[P]),a("div",{className:"dm-container",children:[a("div",{className:"dm-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{r&&r.cb?(r.cb(),t(null)):m("dmList")}}),a("div",{className:"profile",onClick:u=>{u.stopPropagation(),t({cb:()=>{I(g),m("dm")}}),i.fetchAndSetProfile(g.username)},children:[e("div",{className:"avatar",children:e("img",{src:i.getAvatar(g.avatar)})}),a("div",{className:"username",children:[g.name??g.username,g.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]})]})]}),e("div",{className:"dm-body-container",onScroll:o,children:e("div",{className:"dm-body",children:P.map((u,R)=>{var $;let V,h=R===0,W=u.sender===v.username?"self":"other",y=(($=P[R+1])==null?void 0:$.sender)===v.username?"self":"other";return P[R+1]?V=Math.abs(u.timestamp-P[R+1].timestamp)/36e5:y=void 0,a("div",{className:`message ${W}`,id:h?"last":"",children:[W=="other"?a("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${W!==y?"show":"hide"}`,onClick:q=>{q.stopPropagation(),t({cb:()=>{I(g),m("dm")}}),i.fetchAndSetProfile(g.username)},children:e("img",{src:i.getAvatar(g.avatar)})}),a("div",{className:"message-content",children:[u.content&&e("div",{className:"content",children:Ie(u.content)}),u.attachments&&e("div",{className:"attatchments",children:u.attachments.map((q,k)=>oe(q)?e("video",{src:q,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:H=>{z.FullscreenImage.set(q)}},k):e(Ve,{src:q,onClick:()=>{z.FullscreenImage.set(q)}},k))})]})]}):a(j,{children:[u.content&&e("div",{className:"content",children:Ie(u.content)}),u.attachments&&e("div",{className:"attatchments",children:u.attachments.map((q,k)=>oe(q)?e("video",{src:q,controls:!1,loop:!0,muted:!0,autoPlay:!0,onClick:H=>{z.FullscreenImage.set(q)}},k):e("img",{src:q,onClick:()=>{z.FullscreenImage.set(q)}},k))})]}),P[R+1]&&V>6?e("div",{className:"date",children:Fe(u.timestamp)}):W!==y&&e("div",{className:"date",children:Fe(u.timestamp)})]},R)})})}),e("div",{className:"attachments",children:p.attachments.map((u,R)=>a("div",{className:"attachment",children:[oe(u)?e("video",{src:u,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(Ve,{src:u}),e(ve,{onClick:()=>{O({...p,attachments:p.attachments.filter((V,h)=>h!==R)})}})]},R))}),a("div",{className:"dm-footer",children:[e(le,{type:"text",ref:T,onChange:u=>{O({...p,content:u.target.value})},onKeyDown:u=>{u.key==="Enter"&&D()},placeholder:n("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),p.content.length>0?e("span",{onClick:()=>D(),className:"send",children:n("APPS.INSTAGRAM.SEND")}):e(ct,{onClick:()=>{var u,R,V;p.attachments.length<3&&z.Gallery.set({includeVideos:!0,allowExternal:(V=(R=(u=he)==null?void 0:u.value)==null?void 0:R.AllowExternal)==null?void 0:V.InstaPic,onSelect:h=>O({...p,attachments:[...p.attachments,h.src]})})}})]})]})}function _t(){const{View:i,Func:d,Dm:S,Account:c,GoBack:A}=s.useContext(K),[v,l]=i,[m]=c,[g,I]=S,[r,t]=A,[P,C]=s.useState(!1),[T,f]=s.useState(""),[p,O]=s.useState(""),[G,L]=s.useState([]);s.useState([]);const[M,x]=s.useState([]),[E,b]=s.useState(0),[D,o]=s.useState(!1),[u,R]=s.useState(!1);s.useEffect(()=>{ue("Instagram")&&N("Instagram",{action:"getRecentMessages",page:0},X.messages).then(h=>{h&&x(h)})},[]);const V=()=>{if(D||u)return;let h=document.querySelector("#last");if(!h)return;!me(h)&&(R(!0),N("Instagram",{action:"getRecentMessages",page:E+1},null).then(y=>{y&&y.length>0?(x([...M,...y]),R(!1)):o(!0)}),b(y=>y+1))};return s.useEffect(()=>{const h=setTimeout(()=>f(p),500);return()=>clearTimeout(h)},[p]),s.useEffect(()=>{T.length>0?P?N("Instagram",{action:"search",query:T},X.messages.filter(h=>h.username!==m.username)).then(h=>{h&&L(h)}):L(M.filter(h=>{var W;return h.username.includes(T)||((W=h==null?void 0:h.name)==null?void 0:W.includes(T))&&h.username!==m.username})):L([])},[T]),s.useEffect(()=>{f(""),L([])},[P]),e("div",{className:"dm-list",children:P?a("div",{className:"slide up",children:[a("div",{className:"dm-list-header new",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{C(!1),L([])}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_MESSAGE")}),e("span",{})]}),a("div",{className:"dm-list-body ",children:[a("div",{className:"input",children:[e("span",{children:n("APPS.INSTAGRAM.TO")}),e(le,{type:"text",onChange:h=>O(h.target.value),placeholder:n("SEARCH")})]}),G.length>0&&e("div",{className:"items",children:G.map((h,W)=>a("div",{className:"item",onClick:()=>{C(!1),I(h),l("dm")},children:[e("div",{className:"avatar",onClick:y=>{y.stopPropagation(),t({cb:()=>{l("dmList"),t(null)}}),d.fetchAndSetProfile(h.username)},children:e("img",{src:d.getAvatar(h.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[h.username,h.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"last-message",children:h.name})]})]},W))})]})]}):a(j,{children:[a("div",{className:"dm-list-header",children:[a("div",{className:"top",children:[e("i",{className:"far fa-chevron-left",onClick:()=>l("feed")}),e("i",{className:"far fa-edit",onClick:()=>C(!0)})]}),e(Ge,{placeholder:n("SEARCH"),onChange:h=>O(h.target.value)})]}),e("div",{className:"dm-list-body",onScroll:V,children:e("div",{className:"items",children:T.length>0&&!P?G.map((h,W)=>{var y;return((y=h.content)==null?void 0:y.length)===0&&(h.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",onClick:()=>{C(!1),I(h),l("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{l("dmList"),t(null)}}),d.fetchAndSetProfile(h.username)},children:e("img",{src:d.getAvatar(h.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[h.name,h.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),a("div",{className:"last-message",children:[h.content.length>40?h.content.substring(0,40)+"...":h.content," • ",ge(h.timestamp)]})]})]},W)}):M.map((h,W)=>{let y=W===M.length-1;return h.content.length===0&&(h.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",id:y?"last":"",onClick:()=>{C(!1),I(h),l("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{l("dmList"),t(null)}}),d.fetchAndSetProfile(h.username)},children:e("img",{src:d.getAvatar(h.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[h.name,h.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),h.content.length>40?h.content.substring(0,40)+"...":h.content," • ",ge(h.timestamp)]})]},W)})})})]})})}function Vt(){var R,V,h,W;const{Account:i,View:d,Func:S,Stories:c,Story:A,Dm:v}=s.useContext(K),[l]=i,[m,g]=d,[I,r]=c,[t,P]=A,[C,T]=v,[f,p]=s.useState(0),[O,G]=s.useState(""),[L,M]=s.useState(!1),[x,E]=s.useState({x:0,y:0});s.useEffect(()=>{if(t){E(t.origin);for(let y=0;y<t.media.length;y++)if(!t.media[y].seen)return p(y)}},[]);const b=y=>{if(L)return M(!1);const $=y.target.getBoundingClientRect(),q=y.clientX-$.left*pe();let k=t.media[f];if(k.seen||N("Instagram",{action:"viewedStory",id:k.id}),q<$.width*pe()/2)if(f>0)p(f-1);else{let H=I.findIndex(re=>re.username===t.username),Y=I[H-1];Y&&S.fetchAndSetStory(Y)}else if(f<t.media.length-1)p(f+1);else{let H=I.findIndex(re=>re.username===t.username),Y=I[H+1];Y?(o(t.username),S.fetchAndSetStory(Y),p(0)):u()}},D=()=>{!O||O===""||N("Instagram",{action:"sendMessage",username:t.username,message:{content:O}}).then(y=>{y&&(T({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),g("dm"),u())})},o=y=>{t.media.length===f+1&&r($=>$.map(q=>(q.username===y&&(q.seen=1),q)))},u=y=>{y!==!1&&o(t.username),P(null)};return a(Ce.div,{className:"instagram-story",initial:{scale:0,transformOrigin:t!=null&&t.origin?`${((R=t==null?void 0:t.origin)==null?void 0:R.x)??0}px ${((V=t==null?void 0:t.origin)==null?void 0:V.y)??0}px`:"50% 50%"},animate:{scale:1,transformOrigin:t!=null&&t.origin?`${((h=t==null?void 0:t.origin)==null?void 0:h.x)??0}px ${((W=t==null?void 0:t.origin)==null?void 0:W.y)??0}px`:"50% 50%"},exit:{scale:0,transformOrigin:x?`${(x==null?void 0:x.x)??0}px ${(x==null?void 0:x.y)??0}px`:"50% 50%"},transition:{duration:.25,ease:"easeInOut"},children:[oe(t==null?void 0:t.media[f].image)?e("video",{className:"background-image",onClick:b,autoPlay:!0,loop:!0,src:t==null?void 0:t.media[f].image}):e("div",{className:"background-image",onClick:b,style:{backgroundImage:`url(${t==null?void 0:t.media[f].image})`}}),e(Ee,{children:L&&e(Ft,{activeImage:f,close:()=>M(!1)})}),a("div",{className:"story-wrapper",children:[a("div",{className:"story-header",children:[e("div",{className:"story-steps",children:t==null?void 0:t.media.map((y,$)=>e("div",{className:f===$?"active":"",onClick:()=>p($)},$))}),a("div",{className:"profile-details",children:[a("div",{className:"profile",onClick:()=>{t!=null&&t.media[f].seen||N("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[f].id},!0).then(()=>u()),u(),S.fetchAndSetProfile(t.username)},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${S.getAvatar(t==null?void 0:t.avatar)})`}}),a("div",{className:"name",children:[t==null?void 0:t.username,!1]}),e("div",{className:"time",children:ge(t==null?void 0:t.media[f].timestamp)})]}),e("div",{className:"stats",children:e(ve,{onClick:()=>{if(t!=null&&t.media[f].seen)return u();N("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[f].id},!0).then(()=>u())}})})]})]}),(t==null?void 0:t.username)===l.username?a("div",{className:"story-footer","data-stats":!0,children:[a("div",{className:"seen-by",onClick:()=>M(!0),children:[(t==null?void 0:t.media[f].viewers)&&e("div",{className:"images",children:t==null?void 0:t.media[f].viewers.map((y,$)=>e("img",{src:S.getAvatar(y.avatar)},$))}),n("APPS.INSTAGRAM.SEEN_BY").format({count:Pt(t==null?void 0:t.media[f].views)??0})]}),e(ve,{onClick:()=>{z.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_STORY.TITLE"),description:n("APPS.INSTAGRAM.DELETE_STORY.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_STORY.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_STORY.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"removeFromStory",id:t==null?void 0:t.media[f].id},!0).then(y=>{if(!y)return _("error","Failed to remove image from story");_("info","Removed image from story"),P(null),t.media.length===1&&r($=>$.filter(q=>q.username!==t.username))})}}]})}})]}):a("div",{className:"story-footer",children:[e("div",{className:"input",children:e(le,{type:"text",placeholder:n("APPS.INSTAGRAM.SEND_A_MESSAGE"),onChange:y=>G(y.target.value),onKeyDown:y=>{y.key==="Enter"&&D()}})}),e(We,{onClick:()=>D()})]})]})]})}const Ft=i=>{var T;const{Func:d,Story:S}=s.useContext(K),[c,A]=S,[v,l]=s.useState([]),[m,g]=s.useState(0),[I,r]=s.useState(!1),[t,P]=s.useState(!1);s.useEffect(()=>{var f,p;(i==null?void 0:i.activeImage)!==void 0&&N("Instagram",{action:"getViewers",id:c==null?void 0:c.media[i.activeImage].id,page:0},(p=(f=X.stories.find(O=>O.username===c.username))==null?void 0:f.media.find(O=>O.id===c.media[i.activeImage].id))==null?void 0:p.viewers).then(O=>{if(!O)return _("warning","Failed to fetch viewers data");l(O),O.length<15&&r(!0)})},[]);const C=f=>{if(I||t)return;let p=document.querySelector("#last");if(!p)return;!me(p)&&(P(!0),N("Instagram",{action:"getViewers",id:c==null?void 0:c.media[i.activeImage].id,page:m+1},null).then(G=>{G&&G.length>0?(l(L=>[...L,...G]),P(!1),G.length<15&&r(!0)):r(!0)}),g(G=>G+1))};return a(Ce.div,{className:"story-modal",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[a("div",{className:"views",children:[e(lt,{})," ",e("div",{className:"views",children:((T=c==null?void 0:c.media[i==null?void 0:i.activeImage])==null?void 0:T.views)??0})]}),e(ve,{className:"close",onClick:i==null?void 0:i.close})]}),a("div",{className:"story-modal-content",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.STORY_VIEWERS")}),e("div",{className:"viewers",onScroll:C,children:v.map((f,p)=>{let O=p===v.length-1?"last":"";return e("div",{className:"item",id:O,children:a("div",{className:"user",onClick:()=>{d.fetchAndSetProfile(f.username),A(null)},children:[e("div",{className:"profile-picture",children:e("img",{src:d.getAvatar(f.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[f.username,f.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:f.name})]})]})},p)})})]})]})};function Dt(){const{Func:i,View:d,Account:S}=s.useContext(K),[c,A]=d,[v]=S;return e("div",{className:"instagram-footer",children:a(j,{children:[[{value:"feed",activeIcon:e(ot,{}),icon:e(mt,{})},{value:"search",activeIcon:e(dt,{}),icon:e(ut,{})},{value:"newPost",activeIcon:e(ft,{}),icon:e(ht,{})},{value:"notifications",activeIcon:e(Oe,{}),icon:e(He,{})}].map((m,g)=>e("div",{onClick:()=>A(m.value),children:c===m.value?m.activeIcon:m.icon},g)),e("img",{src:i.getAvatar(v.avatar),className:"profile",alt:"profile",onClick:()=>i.fetchAndSetProfile(v.username)})]})})}function Ut(){const{UserPanel:i}=s.useContext(K),[d,S]=i,[c,A]=s.useState([]),[v,l]=s.useState(0),[m,g]=s.useState(!1),[I,r]=s.useState(!1);let t={[n("APPS.INSTAGRAM.FOLLOWING")]:"getFollowing",[n("APPS.INSTAGRAM.FOLLOWERS")]:"getFollowers",[n("APPS.INSTAGRAM.LIKED_BY")]:"getLikes"};const P=(T,f)=>{var p,O;if(T!==n("APPS.INSTAGRAM.LIKED_BY")){let G=T===n("APPS.INSTAGRAM.FOLLOWING")?(p=X.accounts[f])==null?void 0:p.followingList:((O=X.accounts[f])==null?void 0:O.followerList)??[];return G==null?void 0:G.map(L=>X.accounts[L])}};s.useEffect(()=>{ue("Instagram")&&N("Instagram",{action:t[d.data.title],data:{postId:d.data.postId,username:d.data.username,page:0}},P(d.data.title,d.data.username)).then(T=>{if(!T)return _("info","No data returned from instagram event");A(T)})},[]);const C=()=>{if(m||I)return;!me(document.querySelector("#last"))&&(r(!0),N("Instagram",{action:t[d.data.title],data:{postId:d.data.postId,username:d.data.username,page:v+1}},null).then(f=>{f&&f.length>0?(A([...c,...f]),r(!1)):g(!0)}),l(f=>f+1))};return e(j,{children:d.data&&c&&a("div",{className:"userpanel-container",children:[a("div",{className:"userpanel-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{var T;return(T=d.data)==null?void 0:T.cb()}}),e("div",{className:"userpanel-title",children:d.data.title}),e("span",{})]}),e("div",{className:"userpanel-body",onScroll:C,children:e("div",{className:"items",children:c.map((T,f)=>{let p=f===c.length-1;return e(xt,{data:T,allData:d.data,last:p},f)})})})]})})}const xt=i=>{const{Func:d,Account:S,GoBack:c,UserPanel:A}=s.useContext(K),[v]=S,[l,m]=c,[g,I]=A;let r=i.data,t=i.last;const[P,C]=s.useState(r.isFollowing===1);return a("div",{className:"item",id:t?"last":"",onClick:()=>{m({cb:()=>{I({display:!0,data:i.allData})}}),d.fetchAndSetProfile(r.username)},children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",children:e("img",{src:d.getAvatar(r.avatar),alt:"profile"})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[r.username,r.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:r.name})]})]}),v.username!==r.username&&e("div",{className:"action",onClick:T=>{T.stopPropagation(),r.username!==v.username&&(P?z.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:r.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"toggleFollow",data:{username:r.username,following:!P}},!0).then(()=>{C(f=>!f)})}}]}):N("Instagram",{action:"toggleFollow",data:{username:r.username,following:!P}},!0).then(()=>{C(f=>!f)}))},children:P?e("div",{className:"button following",children:n("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",children:n("APPS.INSTAGRAM.FOLLOW")})})]})},K=s.createContext(null);function zt(){var q;const i=ae(fe.Settings),d=(q=ae(Me))==null?void 0:q.active,S=ae(fe.Styles.TextColor),[c,A]=s.useState("feed"),[v,l]=s.useState(null),[m,g]=s.useState(!1),[I,r]=s.useState([]),[t,P]=s.useState(null),[C,T]=s.useState(null),[f,p]=s.useState(null),[O,G]=s.useState(null),[L,M]=s.useState(null),[x,E]=s.useState(null),[b,D]=s.useState({display:!1,data:null}),[o,u]=s.useState(!0);s.useEffect(()=>{var k,H;d&&((k=d==null?void 0:d.data)==null?void 0:k.view)==="profile"&&V((H=d==null?void 0:d.data)==null?void 0:H.username)},[d]),s.useEffect(()=>{N("isAdmin",null,!1).then(k=>{if(ie.APPS.INSTAGRAM.account.value){l({...ie.APPS.INSTAGRAM.account.value,isAdmin:k}),g(!0),u(!1);return}else if(ie.APPS.INSTAGRAM.account.value===!1)return u(!1);N("Instagram",{action:"isLoggedIn"},X.account).then(H=>{H?(ie.APPS.INSTAGRAM.account.set(H),l({...H,isAdmin:k}),g(!0),u(!1)):(u(!1),ie.APPS.INSTAGRAM.account.set(null))})})},[]),s.useEffect(()=>{if(ue("Instagram"))return setTimeout(()=>{c==="live"||c==="story"?(fe.Styles.TextColor.set("#fafafaed"),c=="live"&&z.IndicatorVisible.set(!1)):(fe.Styles.TextColor.set(i.display.theme==="dark"?"#fafafaed":"#000000"),z.IndicatorVisible.set(!0)),c==="dm"?Se.ReceiveAppNotifications.set(!1):Se.ReceiveAppNotifications.set(!0)},250),()=>{Se.ReceiveAppNotifications.set(!0)}},[c]);const R=(k,H)=>{k&&N("Instagram",{action:"getPost",id:k},X.posts.find(Y=>Y.id===k)).then(Y=>{if(Y){if(H)return h(Y);M(Y),A("post")}})},V=k=>{var H;k&&N("Instagram",{action:"getProfile",username:k},(H=X.accounts)==null?void 0:H[k]).then(Y=>{if(!Y)return _("warning","Failed to fetch profile data");T(Y),A("profile")})},h=k=>{k.id&&N("Instagram",{action:"getComments",postId:k.id,page:0},X.comments.filter(H=>H.postId===k.id)).then(H=>{H&&(G({post:k,comments:H}),A("comments"))})},W=(k,H,Y)=>{var re;!k&&!(k!=null&&k.username)||((H==null?void 0:H.length)==0&&(H=void 0),N("Instagram",{action:"getStory",username:k.username},(re=X.stories.find(de=>de.username===k.username))==null?void 0:re.media).then(de=>{if(!de)return _("warning","Failed to fetch story data");P({username:k.username,avatar:k.avatar,verified:k.verified,media:de,queue:H,origin:Y})}))},y=k=>k||`./assets/img/avatar-placeholder-${i.display.theme}.svg`,$={feed:e(Et,{}),search:e(Lt,{}),notifications:e(Ct,{}),profile:e(Rt,{}),live:e(At,{}),logIn:e(De,{}),comments:e(Ot,{}),post:e(kt,{}),newPost:e(Gt,{}),userpanel:e(Ut,{}),dmList:e(_t,{}),dm:e(yt,{})};return s.useEffect(()=>{b.display&&A("userpanel")},[b]),te("instagram:logout",k=>{if(!k)return _("warning","No username provided to logout");if(!m)return _("info","User is not logged in, cannot log out");if(k!==(v==null?void 0:v.username))return _("warning","Username provided does not match current logged in username, not logging out");l(null),g(!1),A("logIn")}),e("div",{className:"instagram-container",children:e(K.Provider,{value:{View:[c,A],Account:[v,l],Profile:[C,T],Post:[L,M],Comments:[O,G],LoggedIn:[m,g],GoBack:[x,E],UserPanel:[b,D],Dm:[f,p],Stories:[I,r],Story:[t,P],Func:{fetchAndSetProfile:V,fetchAndSetStory:W,fetchAndSetComments:h,fetchAndSetPost:R,getAvatar:y}},children:o||i.airplaneMode?e("div",{className:"loading",children:e(gt,{size:40,lineWeight:5,speed:2,color:S})}):e("div",{className:"instagram-wrapper",children:m?a(j,{children:[e(Ee,{children:t&&e(Vt,{})}),$[c],c!=="live"&&c!=="logIn"&&c!=="newPost"&&c!=="comments"&&!t&&e(Dt,{})]}):e(De,{})})})})}export{K as InstagramContext,zt as default};
