import{r as g,j as A,F as Z,a as e,t as me,H as K,u as R,s as f,q as P,p as b,aS as G,$ as Pe,C as H,L as t,m as $,S as ae,aw as ve,N as q,aT as he,a2 as J,aU as le,aa as Ae,x as fe,a1 as Se,aV as Oe,aW as ge,aX as pe,aY as Ce,E as z,I as ce,b as te,aZ as Ee,a_ as Te,a$ as be,b0 as Ie,as as Q,n as se,R as ne,b1 as de,K as ie,b2 as Me,ac as Ne,b3 as ye,b4 as Le,ab as Re,b5 as He,b6 as ee,P as ue,A as _e}from"./index-594e1857.js";const W=({src:i,showAdvanced:c})=>{const[l,S]=g.useState(null);return A(Z,{children:[e("video",{src:i,crossOrigin:"anonymous",controls:!1,onMouseOver:C=>{c&&C.currentTarget.play()},onMouseOut:C=>{c&&C.currentTarget.pause()},muted:!0,loop:!0,onLoadedMetadata:C=>{S(C.currentTarget.duration)}}),l&&c&&e("div",{className:"video-duration",children:(C=>{const y=Math.floor(C/60),M=me(C-y*60,0);return`${y}:${M<10?"0"+M:M}`})(l)})]})},_=K(null),j=[{title:t("APPS.PHOTOS.VIDEOS"),id:"videos",icon:e(Se,{}),count:0},{title:t("APPS.PHOTOS.SELFIES"),id:"selfies",icon:e(Oe,{}),count:0},{title:t("APPS.PHOTOS.SCREENSHOTS"),id:"screenshots",icon:e(ge,{}),count:0},{title:t("APPS.PHOTOS.IMPORTS"),id:"imports",icon:e(pe,{}),count:0},{title:t("APPS.PHOTOS.DUPLICATES"),id:"duplicates",icon:e(Ce,{}),count:0}];function Ue(){const i=R(_),[c,l]=g.useState(!1),S=R(f.APPS.CAMERA.albums),E=R(f.APPS.CAMERA.mediaTypes);g.useEffect(()=>{var v,s;if(((v=f.APPS.CAMERA.albums.value)==null?void 0:v.length)>0&&((s=f.APPS.CAMERA.mediaTypes.value)==null?void 0:s.length)>0)return P("info","Album and mediatype cache exists, returning");b("Camera",{action:"getAlbums"},{albums:G.Albums,mediaTypes:G.MediaTypes}).then(N=>{if(!N)return P("error","No data received from server");let L=((E==null?void 0:E.length)>0?E:j).map(D=>{const x=N.mediaTypes[D.id+"Photos"]??0,B=N.mediaTypes[D.id+"Videos"]??0;return{...D,count:x+B,videoCount:B,photoCount:x}});f.APPS.CAMERA.albums.set(N.albums),f.APPS.CAMERA.mediaTypes.set(L)})},[i]);const C=()=>{let v="";H.PopUp.set({title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.NEW_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PLACEHOLDER"),maxCharacters:20,onChange:s=>{v=s}},buttons:[{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PROCEED"),cb:()=>{b("Camera",{action:"createAlbum",title:v},!0).then(s=>{if(!s)return P("warning","Could not create album, id not returned");if(v.length<1)return P("warning","Input is empty, cannot create album");if(v.length>20)return P("warning","Input is too long, cannot create album");let N={title:v,id:s,cover:null,count:0,photoCount:0,videoCount:0};f.APPS.CAMERA.albums.set([...S,N])})}}]})},y=v=>{if(!v)return P("warning","No album id provided, cannot remove album");H.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:v.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:v.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{b("Camera",{action:"deleteAlbum",id:v.id},!0).then(s=>{if(!s)return P("error","Could not remove album, server returned false");f.APPS.CAMERA.albums.set(S.filter(N=>N.id!==v.id))})}}]})},M=Pe(v=>{let s=v.target;for(;!s.classList.contains("album");)s=s.parentElement;let N=parseInt(s.getAttribute("data-id"));if(!N)return P("warning","Could not obtain album id from element");H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let U="";H.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:L=>{U=L}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(U.length<1)return P("warning","Input is empty, cannot rename album");P("warning","Renaming album",N,U),b("Camera",{action:"renameAlbum",id:N,title:U},!0).then(L=>{if(!L)return P("error","Could not rename album, server returned false");f.APPS.CAMERA.albums.set(S.map(D=>D.id===N?{...D,title:U}:D))})}}]})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>y(S.find(U=>U.id===N))}]})});return e($.div,{...ae("right",i?"inAlbum":"albums"),style:{height:"100%",paddingBottom:"9rem"},children:i?e(q,{children:e(De,{})}):A(Z,{children:[A("div",{className:"albums-header",children:[A("div",{className:"top",children:[e("div",{className:"edit",onClick:()=>l(!c),children:c?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.EDIT")}),e(ve,{onClick:C})]}),e("div",{className:"title",children:t("APPS.PHOTOS.ALBUMS")})]}),A("div",{className:"albums-content",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MY_ALBUMS")}),e("div",{className:"albums-grid","data-edit":c,children:e(q,{children:S.map((v,s)=>A($.div,{animate:{scale:1},exit:{scale:.2},transition:{duration:.25,ease:"easeInOut"},className:"album","data-id":v.id,"data-removable":v.removable,...M,onClick:()=>{c||_.set(v)},children:[c&&v.removable!==!1&&e("div",{className:"remove",onClick:N=>{N.stopPropagation(),y(v)},children:e(he,{})}),A("div",{className:"cover",children:[J(v.cover)?e(W,{src:v.cover,showAdvanced:!1}):e("img",{src:v.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"}),v.id==="favourites"&&e(le,{})]}),A("div",{className:"text",children:[e("div",{className:"title",children:v.title}),e("div",{className:"count",children:Ae(v.count)})]})]},s))})})]}),e("div",{className:"divider"}),A("div",{className:"media-types",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MEDIA_TYPES")}),e("div",{className:"media-types-items",children:E.map((v,s)=>A("div",{className:"item",onClick:()=>{if(c)return P("info","Edit mode is enabled, cannot open media type");_.set({...v,id:null,cover:null,type:v.id})},children:[A("div",{className:"type",children:[v.icon,v.title]}),A("div",{className:"action",children:[e("div",{className:"count",children:v.count}),e(fe,{})]})]},s))})]})]})})}const De=()=>{var B,p;const i=R(_),c=R(w),[l,S]=g.useState([]),[E,C]=g.useState([]),[y,M]=g.useState(!1),[v,s]=g.useState(!1),[N,U]=g.useState(!1),[L,D]=g.useState(0);g.useEffect(()=>{if(!z("Photos"))return;let O=i.id==="favourites"?G.Photos.filter(h=>h.favourite):i.id==="recents"?G.Photos:i.type==="videos"?G.Photos.filter(h=>h.isVideo):i.type?G.Photos.filter(h=>h.type===i.type):G.Photos.filter(h=>h.album===i.id);b("Camera",{action:"getImages",filter:{album:i.id,type:i.type}},O).then(h=>{if(!h)return P("warning","No data was returned from getImages event");C(h.reverse()),M(h.length===0)})},[]);const x=O=>{if(v||N)return;let h=document.querySelector("#last");if(!h)return;if(!ie(h)){const r=document.querySelector(".library-content"),o=r.scrollHeight;U(!0),b("Camera",{action:"getImages",page:L+1,filter:{album:i.id,type:i.type}},null).then(d=>{d&&d.length>0?(r.style.transform=`translateY(${o}px)`,C(T=>[...d.reverse(),...T]),U(!1),requestAnimationFrame(()=>{r.style.transition="transform 0ms",r.style.transform="translateY(0)"}),d.length<32&&s(!0)):s(!0)}),D(d=>d+1)}};return A($.div,{initial:{opacity:0,x:35},animate:{opacity:1,x:0},exit:{opacity:0,x:35},transition:{duration:.25,ease:"easeInOut"},className:"library",children:[e("div",{className:"library-header album",children:A("div",{className:"top",children:[e("div",{className:"back",children:e(ce,{onClick:()=>{_.set(null),w.set(!1)}})}),A("div",{className:"info",children:[e("div",{className:"title",children:i.title}),A("div",{className:"details",children:[t("APPS.PHOTOS.PHOTO_COUNT").format({amount:i.photoCount??0}),e("br",{}),t("APPS.PHOTOS.VIDEO_COUNT").format({amount:i.videoCount??0})]})]}),A("div",{className:"actions",style:{color:E.length<15?"var(--phone-color-blue)":"var(--phone-text-primary)"},children:[e("div",{className:"button",onClick:()=>w.set(!c),children:c?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")}),(((p=(B=te.value)==null?void 0:B.AllowExternal)==null?void 0:p.Gallery)||i.id!=="recents"&&i.id!=="favourites")&&e("div",{className:"button round",onClick:()=>{var u,r;let O=i.id!=="recents"&&i.id!=="favourites",h=((r=(u=te.value)==null?void 0:u.AllowExternal)==null?void 0:r.Gallery)&&i.id!=="favourites";if(!O&&!h)return P("warning","Cannot edit or import images in this album");H.ContextMenu.set({buttons:[h&&{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),cb:()=>{let o="";H.PopUp.set({title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PLACEHOLDER"),onChange:d=>{o=d}},buttons:[{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PROCEED"),cb:()=>{if(o.includes("data:image"))return P("warning","Data URL not supported");if(!Ee(o)){setTimeout(()=>{H.PopUp.set({title:t("COMPONENTS.GALLERY.EXTERNAL_URL"),description:t("COMPONENTS.GALLERY.EXTERNAL_URL_BLACKLISTED"),buttons:[{title:"OK"}]}),P("warning","External URL is blacklisted")},500);return}Te(o,d=>{if(!d)return P("error","Image does not exist");be(o,null,"import",!0).then(T=>{if(!T)return P("error","Could not save to gallery, server returned false");let a=J(o);C([{id:T,src:o,timestamp:Date.now(),type:"import",isVideo:a},...E]),i.id!=="recents"&&i.id!=="favourites"?b("Camera",{action:"addToAlbum",album:i.id,ids:[T]}).then(n=>{if(!n)return P("error","Could not add to album, server returned false");let m=i.photoCount+1,I=a?i.videoCount+1:i.videoCount;_.set({...i,photoCount:m,videoCount:I,cover:o})}):i.id==="favourites"&&b("Camera",{action:"toggleFavourites",ids:[T],favourite:!0}).then(n=>{if(!n)return P("error","Could not add to favourites, server returned false");let m=i.photoCount+1,I=a?i.videoCount+1:i.videoCount;_.set({...i,photoCount:m,videoCount:I,cover:o})}),b("Camera",{action:"getAlbums"}).then(n=>{if(!n)return P("error","No data received from server");let m=j.map(I=>{const k=n.mediaTypes[I.id+"Photos"]??0,F=n.mediaTypes[I.id+"Videos"]??0;return{...I,count:k+F,photoCount:k,videoCount:F}});f.APPS.CAMERA.albums.set(n.albums),f.APPS.CAMERA.mediaTypes.set(m)})})})}}]})}},O&&{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let o="";H.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:d=>{o=d}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(o.length<1)return P("warning","Input is empty, cannot rename album");P("info","Renaming album",i.id,o),b("Camera",{action:"renameAlbum",id:i.id,title:o},!0).then(d=>{if(!d)return P("error","Could not rename album, server returned false");_.set({...i,title:o}),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(T=>T.id===i.id?{...T,title:o}:T))})}}]})}},O&&{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{H.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:i.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:i.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{b("Camera",{action:"deleteAlbum",id:i.id},!0).then(o=>{if(!o)return P("error","Could not remove album, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.filter(d=>d.id!==i.id)),_.set(null)})}}]})}}]})},children:e(Ie,{})})]})]})}),A("div",{className:"library-content",style:{maxHeight:"40rem"},onScroll:x,children:[y&&A("div",{className:"no-photos",children:[e("div",{className:"title",children:t("APPS.PHOTOS.NO_PHOTOS")}),e("div",{className:"description",children:t("APPS.PHOTOS.NO_PHOTOS_INSTRUCTIONS")})]}),e("div",{className:"library-grid",children:E.map((O,h)=>A("div",{id:h===0?"last":"",className:"grid-item",onClick:()=>{if(c){const r=l.find(o=>o.id===O.id);S(r?l.filter(o=>o.id!==O.id):[...l,O])}else V.set({activeImage:O,images:E})},children:[O.isVideo?e(W,{src:O.src,showAdvanced:!c}):e("div",{className:"img",style:{backgroundImage:`url(${O.src})`}}),e("div",{className:"checkbox",children:c&&(l.find(r=>r.id===O.id)?e(Q,{checked:!0}):e(Q,{checked:!1}))})]},h))})]}),c&&A("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":l.length===0,children:e(se,{})}),e("div",{className:"title",children:l.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:l.length})}),A("div",{className:"icons","data-disabled":l.length===0,children:[e(ne,{onClick:()=>{if(l.length===0)return;let O=i.id!=="recents"&&i.id!=="favourites";H.ContextMenu.set({title:O&&t("APPS.PHOTOS.DELETE_CONTEXT_TITLE").format({type:l.length>1?t("APPS.PHOTOS.THESE_PHOTOS"):t("APPS.PHOTOS.THIS_PHOTO")}),buttons:[O&&{title:t("APPS.PHOTOS.REMOVE_FROM_ALBUM"),cb:()=>{b("Camera",{action:"removeFromAlbum",album:i.id,ids:l.map(h=>h.id)},!0).then(h=>{if(!h)return P("error","Could not remove from album, server returned false");let u=i.photoCount-l.filter(o=>!o.isVideo).length,r=i.videoCount-l.filter(o=>o.isVideo).length;f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(o=>{if(o.id===i.id)return{...o,count:o.count-l.length,photoCount:u,videoCount:r}})),_.set({...i,photoCount:u,videoCount:r}),C(E.filter(o=>!l.find(d=>o.id===d.id))),S([]),w.set(!1)})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{b("Camera",{action:"deleteFromGallery",ids:l.map(h=>h.id)},!0).then(h=>{if(!h)return P("error","Could not delete from gallery, server returned false");let u=0;l.forEach(d=>{u+=d.size}),window.postMessage({action:"updateStorage",add:!1,size:u});let r=i.photoCount-l.filter(d=>!d.isVideo).length,o=i.videoCount-l.filter(d=>d.isVideo).length;b("Camera",{action:"getAlbums"}).then(d=>{if(!d)return P("error","No data received from server");let T=j.map(a=>{const n=d.mediaTypes[a.id+"Photos"]??0,m=d.mediaTypes[a.id+"Videos"]??0;return{...a,count:n+m,photoCount:n,videoCount:m}});f.APPS.CAMERA.albums.set(d.albums),f.APPS.CAMERA.mediaTypes.set(T)}),_.set({...i,photoCount:r,videoCount:o}),C(E.filter(d=>!l.find(T=>d.id===T.id))),S([]),w.set(!1)})}}]})}}),e(de,{onClick:()=>{if(l.length===0)return;let O=l.find(h=>!h.favourite);H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{Y.set({images:l,onSelect:h=>{b("Camera",{action:"addToAlbum",album:h.id,ids:l.map(u=>u.id)},!0).then(u=>{if(!u)return P("error","Could not add to album, server returned false");S([]),w.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(r=>r.id===h.id?{...r,count:r.count+l.length,photoCount:r.photoCount+l.filter(o=>!o.isVideo).length,videoCount:r.videoCount+l.filter(o=>o.isVideo).length,cover:l[l.length-1].src}:r))})}})}},{title:O?t("APPS.PHOTOS.ADD_TO_FAVOURITES"):t("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"),cb:()=>{b("Camera",{action:"toggleFavourites",ids:l.map(h=>h.id),favourite:!!O},!0).then(h=>{if(!h)return P("error","Could not add to favourites, server returned false");S([]),w.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(u=>u.id==="favourites"?{...u,count:u.count+l.length,photoCount:u.photoCount+l.filter(r=>!r.isVideo).length,videoCount:u.videoCount+l.filter(r=>r.isVideo).length,cover:l[l.length-1].src}:u))})}}]})}})]})]})]})};t("APPS.PHOTOS.YEARS"),t("APPS.PHOTOS.MONTHS"),t("APPS.PHOTOS.DAYS"),t("APPS.PHOTOS.ALL_PHOTOS");function Ve(){const i=R(w),[c,l]=g.useState([]),[S,E]=g.useState([]),[C,y]=g.useState(!1);g.useState("all");const[M,v]=g.useState(null),[s,N]=g.useState(!1),[U,L]=g.useState(!1),[D,x]=g.useState(0),B=()=>{var F,re;let u=[],r=document.querySelectorAll(".grid-item");if(r.length===0||(r.forEach(X=>{!ie(X)&&u.push(X)}),u.length===0))return v(null);let o=u[0],d=parseInt(o==null?void 0:o.getAttribute("data-id"));if(!d)return;let T=(F=S.find(X=>X.id===d))==null?void 0:F.timestamp,a=u[u.length-1],n=parseInt(a.getAttribute("data-id")),m;if(n&&(m=(re=S.find(X=>X.id===n))==null?void 0:re.timestamp),!T)return;let I=p(T),k=p(m);if(I===k||!m)return v(I);v(`${I} - ${k}`)},p=u=>{let r=new Date(u/1e3),o=r.toLocaleString("default",{month:"short"}),d=r.getDate(),T=r.getFullYear();return`${d} ${o} ${T}`};g.useEffect(()=>{z("Photos")&&b("Camera",{action:"getImages"},G.Photos.sort((u,r)=>r.timestamp-u.timestamp).reverse()).then(u=>{if(!u)return P("warning","No data was returned from getImages event");E(u.reverse()),y(u.length===0)})},[]);const O=u=>{if(B(),s||U)return;let r=document.querySelector("#last");if(!r)return;if(!ie(r)){const d=document.querySelector(".library-content"),T=d.scrollHeight;L(!0),b("Camera",{action:"getImages",page:D+1},null).then(a=>{a&&a.length>0?(d.style.transform=`translateY(${T}px)`,E(n=>[...a.reverse(),...n]),L(!1),requestAnimationFrame(()=>{d.style.transition="transform 0ms",d.style.transform="translateY(0)"}),a.length<32&&N(!0)):N(!0)}),x(a=>a+1)}},h=u=>u.reduce((r,o)=>{const d=Ne(o.timestamp);return r[d]||(r[d]=[]),r[d].push(o),r},{});return A($.div,{...ae("left","library"),style:{height:"100%"},children:[e("div",{className:"library-header",children:A("div",{className:"top",children:[e("div",{}),e("div",{className:"actions",children:e("div",{className:"button",onClick:()=>w.set(!i),children:i?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")})})]})}),e("div",{className:"library-content",style:{marginTop:"4rem",maxHeight:48.5-4+"rem"},"data-offset":S.length<15,onScroll:O,children:(()=>{let u=h(S);return Object.keys(u).map(r=>A("div",{className:"date-group",children:[e("div",{className:"date",children:r}),e("div",{className:"library-grid","data-zoomlevel":Fe[1].toString(),children:u[r].map((o,d)=>A("div",{id:d===0?"last":"",className:"grid-item","data-id":o.id,onClick:()=>{if(i){const a=c.find(n=>n.id===o.id);l(a?c.filter(n=>n.id!==o.id):[...c,o])}else V.set({activeImage:o,images:S})},children:[o.isVideo?e(W,{src:o.src,showAdvanced:!i}):e("div",{className:"img",style:{backgroundImage:`url(${o.src})`}}),e("div",{className:"checkbox",children:i&&(c.find(a=>a.id===o.id)?e(Q,{checked:!0}):e(Q,{checked:!1}))})]},o.id))})]},r))})()}),i&&A("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":c.length===0,children:e(se,{})}),e("div",{className:"title",children:c.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:c.length})}),A("div",{className:"icons","data-disabled":c.length===0,children:[e(ne,{onClick:()=>{c.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{b("Camera",{action:"deleteFromGallery",ids:c.map(u=>u.id)},!0).then(()=>{E(S.filter(r=>!c.find(o=>r.src===o.src))),l([]);let u=0;c.forEach(r=>{u+=r.size}),window.postMessage({action:"updateStorage",add:!1,size:u}),b("Camera",{action:"getAlbums"}).then(r=>{if(!r)return P("error","No data received from server");let o=j.map(d=>{const T=r.mediaTypes[d.id+"Photos"]??0,a=r.mediaTypes[d.id+"Videos"]??0;return{...d,count:T+a,photoCount:T,videoCount:a}});f.APPS.CAMERA.albums.set(r.albums),f.APPS.CAMERA.mediaTypes.set(o)})})}}]})}}),e(Me,{onClick:()=>{c.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{Y.set({images:c,onSelect:u=>{b("Camera",{action:"addToAlbum",album:u.id,ids:c.map(r=>r.id)},!0).then(r=>{if(!r)return P("error","Could not add to album, server returned false");l([]),w.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(o=>o.id===u.id?{...o,count:o.count+c.length,photoCount:o.photoCount+c.filter(d=>!d.isVideo).length,videoCount:o.videoCount+c.filter(d=>d.isVideo).length,cover:c[c.length-1].src}:o))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{b("Camera",{action:"toggleFavourites",ids:c.map(u=>u.id),favourite:!0},!0).then(u=>{if(!u)return P("error","Could not add to favourites, server returned false");l([]),w.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(r=>r.id==="favourites"?{...r,count:r.count+c.length,photoCount:r.photoCount+c.filter(o=>!o.isVideo).length,videoCount:r.videoCount+c.filter(o=>o.isVideo).length,cover:c[c.length-1].src}:r))})}}]})}})]})]})]})}function we(){var S,E,C;const i=R(Y),c=R(f.APPS.CAMERA.albums);let l=(S=i==null?void 0:i.images)==null?void 0:S[(i==null?void 0:i.images.length)-1];return A($.div,{initial:{opacity:0,scale:.9,y:250},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:250},className:"addtoalbum-container",children:[A("div",{className:"addtoalbum-header",children:[e("div",{}),e("div",{className:"title",children:t("APPS.PHOTOS.ADD_TO_ALBUM")}),e("div",{className:"cancel",onClick:()=>Y.reset(),children:t("APPS.PHOTOS.CANCEL")})]}),A("div",{className:"addtoalbum-content",children:[A("div",{className:"preview",children:[J(l==null?void 0:l.src)?e(W,{src:l==null?void 0:l.src,showAdvanced:!1}):e("img",{src:l==null?void 0:l.src}),e("div",{className:"title",children:t("APPS.PHOTOS.SELECTED_COUNT").format({count:(E=i==null?void 0:i.images)==null?void 0:E.length})})]}),e("div",{className:"albums",children:(C=c==null?void 0:c.filter(y=>y.id!=="favourites"&&y.id!=="recents"))==null?void 0:C.map((y,M)=>A("div",{className:"album",onClick:()=>{i.onSelect(y),Y.reset()},children:[e("div",{className:"cover",children:J(y.cover)?e(W,{src:y.cover,showAdvanced:!1}):e("img",{src:y.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"})}),e("div",{className:"title",children:y.title}),e("div",{className:"count",children:y.count})]},M))})]})]})}function ke(){const i=R(oe),[c,l]=g.useState([{icon:e(ye,{}),title:t("APPS.PHOTOS.GALLERY"),value:"library"},{icon:e(Le,{}),title:t("APPS.PHOTOS.ALBUMS"),value:"albums"}]);return e("div",{className:"photos-footer",children:c.map((S,E)=>A("div",{className:"item","data-active":i===S.value,onClick:()=>{oe.set(S.value),S.value==="albums"&&i==="albums"&&(_!=null&&_.value)&&_.reset()},children:[S.icon,S.title]},E))})}const Be=()=>{var u,r,o,d,T;const i=R(te),c=R(ue.Settings),[l,S]=g.useState(!0),E=g.useRef(!1),[C,y]=g.useState(0),M=g.useRef(null),v=g.useRef(null),s=R(V),[N,U]=g.useState(new Date(((r=(u=V==null?void 0:V.value)==null?void 0:u.activeImage)==null?void 0:r.timestamp)??0)),[L,D]=g.useState(((o=s==null?void 0:s.activeImage)==null?void 0:o.favourite)??!1),[x,B]=g.useState([]);let p=(s==null?void 0:s.images)??[];g.useEffect(()=>{if(!(s!=null&&s.activeImage))return P("warning","No active image when changing volume");if(s.activeImage.isVideo){const a=document.getElementById(s.activeImage.id);if(!a)return;a.volume=c.sound.volume}},[c.sound.volume]),g.useEffect(()=>{var n;if(!s)return;let a=p.findIndex(m=>m.id===s.activeImage.id);if(y(a),D(s.activeImage.favourite),s.activeImage.isVideo){const m=document.getElementById(s.activeImage.id);if(!m)return P("warning","Video Element not found (Carousel effect)");m.play().catch(()=>P("warning","Could not play video, user interaction required")),m.volume=c.sound.volume}if(p.length>0){let m=[];a===0?m=p.slice(0,12):a===p.length-1?m=p.slice(p.length-12,p.length):a<6?m=p.slice(0,12):a>p.length-6?m=p.slice(p.length-12,p.length):m=p.slice(a-6,a+6),U(new Date((n=p==null?void 0:p[a])==null?void 0:n.timestamp)),B(m)}},[s==null?void 0:s.activeImage]);const O={pos:{startLeft:0,startX:0},onMouseDown:a=>{z("Photos")&&(O.pos={startLeft:M.current.scrollLeft,startX:a.clientX},M.current.style.userSelect="none",document.addEventListener("mouseup",O.onMouseUp),document.addEventListener("mousemove",O.onMove))},onMove:a=>{if(!M.current)return;const n=(a.clientX-O.pos.startX)/ee();M.current.scrollLeft=O.pos.startLeft-n;const m=M.current.getBoundingClientRect();(m.left*ee()-5>a.clientX||a.clientX>m.right*ee()-5)&&O.onMouseUp(),E.current=!0},onMouseUp:()=>{if(!M.current)return;M.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",O.onMouseUp),document.removeEventListener("mousemove",O.onMove);const a=M.current.clientWidth;let n=C;const m=M.current.scrollLeft-O.pos.startLeft;if(m>a/2&&n<p.length?n++:m<-a/2&&n>0&&n--,s.activeImage.id!==p[n].id&&s.activeImage.isVideo){const k=document.getElementById(s.activeImage.id);k&&(k.pause(),k.currentTime=0)}V.set({activeImage:p[n],images:p});let I=document.getElementById(p[n].id);if(!I)return P("error","Could not find element to scroll into view");I.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{E.current=!1},100)}},h=a=>{s.activeImage.isVideo&&document.getElementById(s.activeImage.id).pause(),V.set({activeImage:a,images:p});let n=document.getElementById(a.id);if(!n)return P("error","Could not find element to scroll into view");n.scrollIntoView({behavior:"smooth",block:"center"})};return A($.div,{initial:{opacity:0,scale:.25},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.25},transition:{duration:.2,ease:"easeInOut"},className:"activephoto-container",children:[e(q,{children:l&&A($.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"back",onClick:()=>{H.Share.reset(),V.reset()},children:e(ce,{})}),e("div",{className:"date",children:((d=s==null?void 0:s.activeImage)==null?void 0:d.timestamp)&&A(Z,{children:[e("span",{children:N.toLocaleString([],{day:"2-digit",month:"long"})}),e("span",{children:N.toLocaleTimeString(i.DateLocale,{hour:"numeric",minute:"numeric",hour12:c.time.twelveHourClock})})]})}),e("div",{children:((T=s==null?void 0:s.activeImage)==null?void 0:T.id)&&e(de,{onClick:()=>{H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{Y.set({images:[s.activeImage],onSelect:a=>{b("Camera",{action:"addToAlbum",album:a.id,ids:[s.activeImage.id]},!0).then(n=>{if(!n)return P("error","Could not add to album, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(m=>m.id===a.id?{...m,count:m.count+1,photoCount:s.activeImage.isVideo?m.photoCount:m.photoCount+1,videoCount:s.activeImage.isVideo?m.videoCount+1:m.videoCount,cover:s.activeImage.src}:m))})}})}},{title:L?t("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"):t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{b("Camera",{action:"toggleFavourites",ids:[s.activeImage.id],favourite:!L},!0).then(a=>{if(!a)return P("error","Could not add to favourites, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(n=>n.id==="favourites"?{...n,count:n.count+1,photoCount:s.activeImage.isVideo?n.photoCount:n.photoCount+1,videoCount:s.activeImage.isVideo?n.videoCount+1:n.videoCount,cover:s.activeImage.src}:n))})}}]})}})})]})}),e("div",{className:"image-overflow",ref:M,onMouseDown:O.onMouseDown,style:{backgroundColor:l?"var(--phone-color-primary)":"rgba(0, 0, 0)"},onClick:()=>{E.current||S(!l)},children:p==null?void 0:p.map((a,n)=>{const m=a.id===s.activeImage.id;return a.isVideo?e("video",{id:a.id,src:a.src,className:m?"active":null,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:I=>{z("Photos")&&m&&(I.target.scrollIntoView({block:"center"}),I.target.play().catch(()=>P("warning","Could not play video, user interaction required")))}},n):e(Re,{id:a.id,src:a.src,className:m?"active":null,ignoreStreamerMode:!0,onLoad:I=>{z("Photos")&&m&&I.target.scrollIntoView({block:"center"})}},n)})}),e(q,{children:l&&A($.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"photo-carousel",ref:v,children:x.map((a,n)=>{let m=a.id===(s==null?void 0:s.activeImage.id);return a.isVideo?e("video",{src:a.src,"data-active":m,"data-carousel":n,controls:!1,muted:!0,onClick:I=>h(a)},n):e("img",{src:a.src,"data-id":a.id,"data-active":m,"data-carousel":n,onClick:I=>h(a)},n)})}),A("div",{className:"photo-bottom",children:[e(se,{onClick:()=>{H.Share.set({type:"image",data:{src:s.activeImage.src,isVideo:s.activeImage.isVideo}})}}),(s==null?void 0:s.activeImage.id)&&A(Z,{children:[e("div",{onClick:()=>{b("Camera",{action:"toggleFavourites",ids:[s.activeImage.id],favourite:!L},!0).then(a=>{if(!a)return P("warning","Failed to toggle favourite, server returned success false");D(!L),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(n=>n.id==="favourites"?{...n,count:L?n.count-1:n.count+1,photoCount:s.activeImage.isVideo?n.photoCount:L?n.photoCount-1:n.photoCount+1,videoCount:s.activeImage.isVideo?L?n.videoCount-1:n.videoCount+1:n.videoCount,cover:s.activeImage.src}:n))})},children:L?e(le,{}):e(He,{})}),e(ne,{onClick:()=>{H.PopUp.set({title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.DESCRIPTION"),buttons:[{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.PROCEED"),color:"red",cb:()=>{b("Camera",{action:"deleteFromGallery",ids:[s.activeImage.id]},!0).then(a=>{if(!a)return P("error","Could not delete from gallery, server returned false");V.reset(),b("Camera",{action:"getAlbums"}).then(n=>{if(!n)return P("error","No data received from server");let m=j.map(I=>{const k=n.mediaTypes[I.id+"Photos"]??0,F=n.mediaTypes[I.id+"Videos"]??0;return{...I,count:k+F,photoCount:k,videoCount:F}});f.APPS.CAMERA.albums.set(n.albums),f.APPS.CAMERA.mediaTypes.set(m)})})}}]})}})]})]})]})})]})};const oe=K("albums"),w=K(!1),V=K(null),Y=K(null),xe={library:e(Ve,{}),albums:e(Ue,{})},Fe=[2,3,4,5];function Ye(){var M;const i=R(oe),c=R(V),l=R(_),S=R(w),E=R(Y),C=(M=R(_e))==null?void 0:M.active,y=R(ue.PhoneNumber);return g.useEffect(()=>{V.reset(),w.reset(),Y.reset()},[y]),g.useEffect(()=>{C!=null&&C.data&&V.set({activeImage:{src:C.data.photo},images:[{src:C.data.photo}]})},[C]),A("div",{className:"photos-container",children:[e("div",{className:"photos-content","data-scroll":i==="albums"&&!l,style:{pointerEvents:c?"none":"all"},children:xe[i]}),!S&&e(ke,{}),e(q,{children:c&&e(Be,{})}),e(q,{children:E&&e(we,{})})]})}export{V as ActiveImage,Y as AlbumPickerComponent,w as SelectMode,oe as View,Ye as default,Fe as zoomLevels};
