import{u as D,r as d,j as o,m as Q,a as e,F as ae,L as i,q as w,C as k,Y as Ve,Z as we,b as z,d as de,f as H,p as L,P as X,E as Fe,_ as oe,$ as Te,S as Ie,N as ce,I as xe,g as re,a0 as Ye,i as Pe,a1 as He,a2 as Oe,a3 as Ae,a4 as Ge,a5 as je,H as Se,a6 as Me,s as Y,t as Ne,K as We,a7 as pe,a8 as qe,A as te,a9 as he,aa as Ce,ab as ye,ac as be,O as ze,Q as Xe,ad as Ee,o as Be,ae as Qe,e as J,af as Ke,y as Ze,z as Je,ag as et,ah as tt,w as at,ai as st,aj as nt,x as it}from"./index-594e1857.js";import{A as rt,g as lt}from"./audioRecorder-f19be386.js";import{M as ot,C as ct,T as dt,a as mt,g as ut}from"./Maps-28c9cb04.js";const De=t=>{if(t)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(t)},ke=t=>{if(t)return t==="<!CALL-NO-ANSWER!>"},St=t=>{if(t)return/<!AUDIO-MESSAGE-IMAGE="(.*)"-AUDIO="(.*)"-DURATION="(.*)"!>/.test(t)},ht=t=>{if(t.length===0)return!0;if(t)return!/^<!.*!>$/.test(t)},Et=({onEnd:t,close:l})=>{const v=D(z),[f,M]=d.useState(!1),[P,u]=d.useState(0),[a,C]=d.useState(null),m=d.useRef(null);if(!v.EnableVoiceMessages)return null;d.useEffect(()=>{if(!f)return;let r=setInterval(()=>{u(h=>h+1)},1e3);return()=>clearInterval(r)},[f]),d.useEffect(()=>(m.current=new rt,()=>{m.current&&m.current.stop()}),[]);const y=r=>{let h=Math.floor(r/60),N=r%60;return`${h}:${N<10?"0":""}${N}`},s=async r=>{const h=await lt(new Blob(r),25,7,324,55,3);C(h)};return o(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:0},transition:{duration:.2,ease:"easeInOut"},className:"audioMessage-container",children:[e("div",{className:"close",onClick:l}),o("div",{className:"audioMessage-wrapper",children:[o("div",{className:"duration",children:[f&&e("div",{className:"dot"}),y(P)]}),e("div",{className:"content",children:f?e(ae,{children:a!=null&&a.base64?e("img",{src:a==null?void 0:a.base64}):i("APPS.MESSAGES.LOADING")}):i("APPS.MESSAGES.START_RECORDING")}),e("div",{className:"button","data-recording":f,onClick:()=>{var h;if(!((h=navigator.mediaDevices)!=null&&h.getUserMedia)||!(m!=null&&m.current))return w("error","No media devices found!");let r=m.current;f?r.stop().then(N=>{if(!N){u(0),M(c=>!c),k.PopUp.set({title:i("APPS.MESSAGES.EMPTY_RECORDING.TITLE"),description:i("APPS.MESSAGES.EMPTY_RECORDING.DESCRIPTION"),buttons:[{title:i("APPS.MESSAGES.EMPTY_RECORDING.OK")}]});return}t(N),M(c=>!c)}):(r.start(100,s),M(N=>!N))},children:f?e(Ve,{}):e(we,{})})]})]})},ft=({paymentAmount:t,setPaymentAmount:l,close:v})=>{const{User:f}=d.useContext(se),M=D(z),[P]=f,[u,a]=d.useState(0),[C,m]=d.useState(4);let y={0:3,11:2.75,14:2.2};return d.useEffect(()=>{u===0&&m(y[0]);let s=0;for(let r=0;r<Object.keys(y).length;r++)u>=parseInt(Object.keys(y)[r])&&(s=y[Object.keys(y)[r]]);m(s)},[u]),d.useEffect(()=>{l(u)},[u]),o(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:0},transition:{duration:.2,ease:"easeInOut"},className:"payment-container",children:[e("div",{className:"close",onClick:v}),o("div",{className:"payment-wrapper",children:[e("div",{className:"button",onClick:()=>t>0&&a(s=>s-1),children:"-"}),e("div",{className:"amount",children:e(de,{type:"number",value:t,style:{fontSize:`${C}rem`},onChange:s=>{if(s.target.value.match(/^[0-9]+$/)&&parseFloat(s.target.value)>0&&parseFloat(s.target.value)<(M.MaxTransferAmount??Number.MAX_SAFE_INTEGER))a(parseFloat(s.target.value));else return s.preventDefault()}})}),e("div",{className:"button",onClick:()=>a(s=>s+1),children:"+"})]}),o("div",{className:"payment-buttons",children:[e("div",{className:"button",onClick:()=>gt(t,P.number),children:i("APPS.MESSAGES.PAY.REQUEST")}),e("div",{className:"button",onClick:()=>Ue(t,{id:P.id,name:P.name,number:P.number}),children:i("APPS.MESSAGES.PAY.SEND")})]})]})},Ue=(t,l)=>{var v;if(z.value.EnableMessagePay&&!(!t&&t<=0)){if(t>(((v=z.value)==null?void 0:v.MaxTransferAmount)??Number.MAX_SAFE_INTEGER))return w("error","Amount is too high");k.PopUp.set({title:i("APPS.MESSAGES.PAY.SEND_TITLE").format({amount:z.value.CurrencyFormat.replace("%s",t.toString())}),description:i("APPS.MESSAGES.PAY.SEND_DESCRIPTION").format({amount:z.value.CurrencyFormat.replace("%s",t.toString()),name:l.name??H(l.number)}),buttons:[{title:i("APPS.MESSAGES.PAY.SEND_BUTTON_CANCEL")},{title:i("APPS.MESSAGES.PAY.SEND_BUTTON_SEND"),cb:()=>{L("Wallet",{action:"sendPayment",number:l.number,amount:t},{success:!0}).then(f=>{var M,P;if(f.success){let u={id:l.id,sender:(P=(M=X)==null?void 0:M.PhoneNumber)==null?void 0:P.value,content:`<!SENT-PAYMENT-${t}!>`,attachments:[],timestamp:Date.now()};O.set([...O.value,u])}else{w("error","Failed to send payment "+JSON.stringify(f)),setTimeout(()=>{k.PopUp.set({title:i(`APPS.WALLET.${f.reason}.TITLE`),description:i(`APPS.WALLET.${f.reason}.DESCRIPTION`),buttons:[{title:i("APPS.WALLET.OK")}]})},500);return}})}}]})}},gt=(t,l)=>{var f,M;if(!z.value.EnableMessagePay||!t&&t<=0)return;let v={sender:(M=(f=X)==null?void 0:f.PhoneNumber)==null?void 0:M.value,content:`<!REQUESTED-PAYMENT-${t}!>`,attachments:[],timestamp:Date.now()};L("Messages",{action:"sendMessage",number:l,content:v.content,attachments:[]},{messageId:Math.floor(Math.random()*1e3).toString()}).then(P=>{if(!P)return O.set([...O.value,{...v,delivered:!1}]);O.set([...O.value,{...v,id:P.messageId}])})},Re={Messagelist:[{id:"1",number:"4802940940",name:"Loaf Scripts",unread:!0,lastMessage:"Sure Thing!",messages:[{sender:"4802940940",content:"Sure Thing!",timestamp:Date.now()-1e3*60*60*2},{sender:"1234567890",content:"Ready to release more products?",timestamp:Date.now()-1e3*60*60*2-1e3*60*5},{sender:"4802940940",content:"Hey!",timestamp:Date.now()-1e3*60*60*2-1e3*60*10}],timestamp:Date.now()-1e3*60*60*2},{id:"2",name:"Office Chat",unread:!0,lastMessage:"is the meeting at 8pm?",timestamp:Date.now()-1e3*60*60*4,isGroup:!0,members:[{number:"4802940940",name:"Loaf Scripts",isOwner:!1},{number:"1566444151",name:"Peter",isOwner:!1},{number:"2051440412",name:"Peter",isOwner:!1},{number:"2051440412",isOwner:!1}],messages:[{sender:"4802940940",content:"is the meeting at 8pm?",timestamp:Date.now()-1e3*60*60*4},{sender:"1566444151",content:"please confirm the time",timestamp:Date.now()-1e3*60*60*4-1e3*60*5},{sender:"2051440412",content:"Hey everyone, please make sure to be on time for the meeting",timestamp:Date.now()-1e3*60*60*4-1e3*60*10}]},{id:"3",number:"4802940963",unread:!1,lastMessage:"yeah i dont know whats going on, it was super weird. i think i might have to go to the doctor",timestamp:Date.now()-1e3*60*60*2*24,messages:[{sender:"4802940940",content:"yeah i dont know whats going on, it was super weird. i think i might have to go to the doctor",timestamp:Date.now()-1e3*60*60*2*24},{sender:"1234567890",content:"i hope you feel better soon",timestamp:Date.now()-1e3*60*60*2*24-1e3*60*5},{sender:"4802940940",content:"still sick :(",timestamp:Date.now()-1e3*60*60*2*24-1e3*60*10}]},{id:"4",number:"4802940942",unread:!0,lastMessage:"see you!",timestamp:Date.now()-1e3*60*60*2*24*2,messages:[{sender:"4802940942",content:"<!SENT-LOCATION-X=400.2Y=-1550.3!>",timestamp:Date.now()-1e3*60*60*2*24},{sender:"4802940942",content:`see you!

heres the location`,timestamp:Date.now()-1e3*60*60*2*24*2},{sender:"1234567890",content:"ofcourse, i will be there",timestamp:Date.now()-1e3*60*60*2*24*2-1e3*60*3},{sender:"4802940942",content:"hey buddy, still on for tomorrow?",timestamp:Date.now()-1e3*60*60*2*24*2-1e3*60*3}]}]};function vt({location:t}){return d.useEffect(()=>{setTimeout(()=>{const l=document.querySelector(".leaflet-control-attribution.leaflet-control a");l&&(l.removeAttribute("href"),l.onclick=()=>{window.invokeNative("openUrl","https://leafletjs.com/")})},500)},[]),e("div",{className:"mapscomponent-wrapper",children:o(ot,{className:"map",crs:ct,center:[t[0]-100,t[1]],zoom:3,scrollWheelZoom:!1,zoomControl:!1,doubleClickZoom:!1,dragging:!1,bounceAtZoomLimits:!0,boxZoom:!1,maxBoundsViscosity:.95,maxBounds:[[8300,-5600],[-4200,6400]],preferCanvas:!0,children:[e(dt,{url:"https://loaf-scripts.com/fivem/lb-phone/map/satellite/{z}/{x}/{y}.png",minZoom:2,maxZoom:8,noWrap:!0}),e(mt,{position:t,icon:ut()})]})})}const O=Se([]);function Pt(){const{User:t,View:l,UnreadMessages:v}=d.useContext(se),f=D(X.Settings),M=D(z),P=D(X.PhoneNumber),u=D(te),[a,C]=t,[m,y]=l,[s,r]=v,h=D(O),N=D(k.Emoji),c=D(k.Gif),[$,F]=d.useState(!1),[q,U]=d.useState(null),[_,j]=d.useState(!1),[R,B]=d.useState(!1),[K,E]=d.useState(0),[T,V]=d.useState(0),[g,A]=d.useState(!1),[G,p]=d.useState(!1),[b,ne]=d.useState(null),me=d.useRef(null),fe=d.useRef(0),le=d.useRef(!1),[x,ie]=d.useState({content:"",attachments:[]});if(!a)return null;d.useEffect(()=>{var n;Fe("Messages")&&L("Messages",{action:"getMessages",page:0,id:a==null?void 0:a.id},((n=Re.Messagelist.find(S=>S.id===a.id))==null?void 0:n.messages)??[]).then(S=>{S&&S.length>0?O.set([...S.reverse()]):A(!0)})},[u==null?void 0:u.active]);const ge=()=>{if(x.content.length<=0&&x.attachments.length<=0&&!b)return w("info","Message is empty, returning");let n={sender:P,timestamp:Date.now(),id:a.id,content:x.content,attachments:x.attachments};if(!ht(x.content))return w("error","Message contains invalid characters, returning",x.content);if(b){if(le.current)return;le.current=!0,Me("Image",b.waves.message).then(S=>{Me("Audio",b.blob).then(I=>{n.content=`<!AUDIO-MESSAGE-IMAGE="${S}"-AUDIO="${I}"-DURATION="${b.duration}"!>`,L("Messages",{action:"sendMessage",number:a.number,content:n.content,id:a.id},{messageId:Math.random().toString(36).substring(7)}).then(W=>{W&&!f.airplaneMode?O.set([...O.value,{...n,id:W.messageId}]):O.set([...O.value,{...n,delivered:!1}]),le.current=!1,ne(null)})}).catch(I=>{console.error("Failed to upload voice message audio",I),le.current=!1})}).catch(S=>{console.error("Failed to upload voice message image",S),le.current=!1});return}if(f.airplaneMode)return O.set([...O.value,{...n,delivered:!1}]);L("Messages",{action:"sendMessage",number:a.number,content:x.content,attachments:x.attachments,id:a.id},{messageId:Math.random().toString(36).substring(7)}).then(S=>{S?(O.set([...O.value,{...n,id:S.messageId}]),ne(null)):O.set([...O.value,{...n,delivered:!1}]),ie({content:"",attachments:[]}),me.current&&(me.current.value=""),w("info","Updating recent message cache state"),Y.APPS.MESSAGES.messages.set(Y.APPS.MESSAGES.messages.value.map(I=>I.id===a.id?{...I,timestamp:new Date().getTime(),lastMessage:n.content,unread:!1,deleted:!1}:I))})},ve=()=>{k.PopUp.set({title:i("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:i("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:i("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:i("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{L("Maps",{action:"getCurrentLocation"},{x:0,y:0}).then(n=>{if(!n)return;let S={id:a.id,sender:P,content:`<!SENT-LOCATION-X=${Ne(n.x,2)}Y=${Ne(n.y,2)}!>`,attachments:[],timestamp:Date.now()};L("Messages",{action:"sendMessage",number:a.number,content:S.content,attachments:S.attachments,id:S.id},{messageId:Math.random().toString(36).substring(7)}).then(I=>{if(!I)return O.set([...O.value,{...S,delivered:!1}]);O.set([...O.value,{...S,id:I.messageId}])})})}}]})},Le=()=>{if(g||G)return;let n=document.querySelector("#last");if(!n)return;!We(n)&&(p(!0),L("Messages",{action:"getMessages",page:T+1,id:a.id}).then(I=>{if(I&&I.length>0){let W=document.querySelector(".message-container");fe.current=W.scrollHeight,O.set([...I.reverse(),...O.value]),p(!1)}else A(!0)}),V(I=>I+1))};d.useEffect(()=>{let n=document.querySelector(".message-container");const S=n.scrollHeight;n.scrollTop+=S-fe.current,n.scroll},[h]),oe("messages:newMessage",n=>{if(a.id===n.channelId){if(f.airplaneMode)return w("warning","Cannot receive message, airplane mode enabled");O.set([...O.value,{...n,timestamp:Date.now()}])}}),oe("messages:renameGroup",n=>{a.id===n.channelId&&(f.airplaneMode||C(S=>({...S,name:n.name})))}),oe("messages:messageDeleted",n=>{if(w("info","messages:messageDeleted triggered",n),!n)return w("error","Did not get any data from messages:messageDeleted, returning");if(f.airplaneMode)return w("warning","Cannot update message state, airplane mode enabled");O.set(O.value.filter(S=>S.id!==n.messageId))}),oe("messages:removeMember",n=>{a.id===n.channelId&&(f.airplaneMode||n.number===P&&(y("userlist"),C(null)))});const _e=Te(n=>{if(!M.DeleteMessages)return w("error","Config.DeleteMessages is set to false");let S=n.target;for(;!S.classList.contains("message");)S=S.parentElement;let I=S.getAttribute("data-id");if(!I)return w("error","Failed to get message id when longpressing");isNaN(I)||(I=parseInt(I));let W=h.find(ue=>ue.id===I);if(!W)return w("error","Failed to find message with id",I);W.sender===P&&(De(W.content)||$e(W.content)||ke(W.content)||k.ContextMenu.set({buttons:[{title:i("APPS.MESSAGES.DELETE"),color:"red",cb:()=>{L("Messages",{action:"deleteMessage",channel:a.id,id:I}).then(ue=>{if(!ue)return w("error","Failed to delete message")})}}]}))}),$e=n=>!n||!M.EnableMessagePay?!1:/<!SENT-PAYMENT-(\d*)!>/.test(n)?!0:!!/<!REQUESTED-PAYMENT-(\d*)!>/.test(n);return e(ae,{children:o(Q.div,{...Ie("right","message",.2),className:"animation-container",children:[o(ce,{children:[$&&e(pt,{setShow:F,setShowUserInfo:U,sendLocation:ve,setData:C,data:a}),q&&e(Nt,{setShow:U,user:a!=null&&a.isGroup?q:a})]}),o("div",{className:"message-header",children:[o("div",{className:"back",onClick:()=>{y("userlist"),C(null),a.unread&&(L("Messages",{action:"markRead",id:a.id}),r(n=>n-1))},children:[e(xe,{}),s>0&&e("span",{className:"back-title",children:s})]}),o("div",{className:"user",onClick:()=>{a!=null&&a.isGroup?F(!0):U(!0)},children:[a!=null&&a.isGroup?e("div",{className:"group-avatar",style:{backgroundImage:a!=null&&a.avatar?`url(${a.avatar})`:null},children:!(a!=null&&a.avatar)&&o(ae,{children:[a.members.sort((n,S)=>n.avatar?1:-1).map((n,S)=>e("div",{className:"avatar","data-hasavatar":(n==null?void 0:n.avatar)!==void 0,style:{backgroundImage:n!=null&&n.avatar?`url(${n.avatar})`:null,zIndex:a.members.length-S},children:n.name?!(n!=null&&n.avatar)&&re(n.name):e("img",{src:`./assets/img/avatar-placeholder-${f.display.theme}.svg`,alt:""})},S)).slice(0,5),a.members.length===0&&e("img",{src:`./assets/img/avatar-placeholder-${f.display.theme}.svg`,alt:""})]})}):e("div",{className:"avatar","data-hasavatar":(a==null?void 0:a.avatar)!==void 0,style:{backgroundImage:a!=null&&a.avatar?`url(${a.avatar})`:null},children:a.name?!(a!=null&&a.avatar)&&re(a.name):e("img",{src:`./assets/img/avatar-placeholder-${f.display.theme}.svg`,alt:""})}),e("div",{className:"name",children:a!=null&&a.isGroup?a.name??`${a.members.length===0?1:a.members.length} ${i("APPS.MESSAGES.PEOPLE")}`:a.name??H(a.number)})]}),o("div",{className:"buttons","data-hidden":a==null?void 0:a.isGroup,children:[e(Ye,{onClick:()=>{a!=null&&a.isGroup||Pe({number:a.number})}}),e(He,{onClick:()=>{a!=null&&a.isGroup||Pe({number:a.number,videoCall:!0})}})]})]}),e("div",{className:"message-container",onScroll:Le,style:R||_?{height:"48%"}:{},children:e("div",{className:"message-body",children:h.map((n,S)=>e(At,{index:S,messages:h,message:n,longPressEvent:_e},S))})}),e("div",{className:"attachments",children:x.attachments.map((n,S)=>o("div",{className:"attachment",children:[Oe(n)?e("video",{src:n,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e("img",{src:n}),e(Ae,{onClick:()=>{ie({...x,attachments:x.attachments.filter((I,W)=>W!==S)})}})]},S))}),o("div",{className:"message-bottom","data-expanded":!!(R||_),children:[e("div",{className:"upper",children:o("div",{className:"input","data-border":!b,children:[b?o("div",{className:"audio-message",children:[e(Ae,{onClick:()=>ne(null)}),e("div",{className:"audio-waves",children:e("img",{src:b.waves.placeholder})})]}):e(de,{placeholder:i("APPS.MESSAGES.PLACEHOLDER"),ref:me,value:x.content,onChange:n=>{ie({content:n.target.value,attachments:x.attachments})},onKeyDown:n=>{n.key=="Enter"&&ge()}}),(x.content.length>0||x.attachments.length>0||b)&&e("div",{className:"send",onClick:ge,children:e(Ge,{})})]})}),!R&&!_&&e("div",{className:"actions-wrapper",children:o("div",{className:"actions",children:[e("div",{className:"action",onClick:()=>{if(N)return k.Emoji.reset();k.Emoji.set({onSelect:n=>ie(S=>({content:`${S.content}${n.emoji}`,attachments:S.attachments}))})},children:"ðŸ˜€"}),e("div",{className:"action",onClick:()=>{var n,S,I;x.attachments.length<3&&k.Gallery.set({includeVideos:!0,allowExternal:(I=(S=(n=z)==null?void 0:n.value)==null?void 0:S.AllowExternal)==null?void 0:I.Messages,onSelect:W=>ie({...x,attachments:[...x.attachments,W.src]})})},children:e("img",{src:"./assets/img/icons/messages/gallery.png"})}),M.EnableGIFs!==!1&&e("div",{className:"action small",onClick:()=>{if(c)return k.Gif.reset();k.Gif.set({onSelect:n=>ie(S=>({content:S.content,attachments:[...S.attachments,n]}))})},children:"GIF"}),(M==null?void 0:M.EnableMessagePay)&&!(a!=null&&a.isGroup)&&e("div",{className:"action ",onClick:()=>{j(!1),B(n=>!n)},children:"$"}),e("div",{className:"action",onClick:()=>ve(),children:e(je,{})}),(M==null?void 0:M.EnableVoiceMessages)&&e("div",{className:"action",onClick:()=>{B(!1),j(n=>!n)},children:e(we,{})})]})}),e(ce,{children:R&&e(ft,{paymentAmount:K,setPaymentAmount:E,close:()=>B(!1)})}),e(ce,{children:_&&e(Et,{onEnd:n=>{if(!n)return w("error","Failed to get audio message data");ne({blob:n.blob,waves:n.waveform,duration:n.duration}),j(!1)},close:()=>j(!1)})})]})]})})}const At=({messages:t,message:l,index:v,longPressEvent:f})=>{var F,q;const{User:M}=d.useContext(se),P=D(X.PhoneNumber),[u]=M,a=D(z);let C,m,y,s,r,h,N=v===0?"last":"",c=l.sender===P?"self":"other",$=((F=t[v+1])==null?void 0:F.sender)===P?"self":"other";if(t[v+1]?y=Math.abs(l.timestamp-t[v+1].timestamp)/36e5:$=void 0,u!=null&&u.isGroup)C=(q=u.members.find(U=>U.number===l.sender))==null?void 0:q.name,m=!t[v-1]||t[v-1].sender!==l.sender;else if(C=u.name,l.content)if(ke(l.content))if(c==="other")l.content=i("APPS.MESSAGES.MISSED_CALL").format({number:l.sender});else return null;else/<!SENT-PAYMENT-(\d*)!>/.test(l.content)?s={amount:l.content.match(/\d/g).join(""),request:!1}:/<!REQUESTED-PAYMENT-(\d*)!>/.test(l.content)&&(s={amount:l.content.match(/\d/g).join(""),request:!0});if(De(l.content)){let U=l.content.match(/X=(-?\d*\.?\d*)Y/)[1],_=l.content.match(/Y=(-?\d*\.?\d*)!>/)[1];r={x:U,y:_}}return St(l.content)&&(h={wave:l.content.match(/AUDIO-MESSAGE-IMAGE="([^"]+)"/)[1],src:l.content.match(/AUDIO="([^"]+)"/)[1],duration:l.content.match(/DURATION="([^"]+)"/)[1]}),o("div",{className:`message ${c}`,id:N,"data-id":l.id,...f,children:[m&&c=="other"&&e("div",{className:"user",children:C??H(l.sender)}),l.delivered===!1?o("div",{className:"content-wrapper",children:[s&&e("div",{className:"payment",children:a.CurrencyFormat.replace("%s",s.amount)}),!s&&e("div",{className:"content",children:pe(l.content)}),e(qe,{})]}):s||r||h?o(ae,{children:[r&&o("div",{className:"location",onClick:()=>{k.ContextMenu.set({buttons:[{title:i("APPS.MESSAGES.OPEN_IN_MAPS"),cb:()=>{te.patch({active:{name:"Maps",data:{location:[r.y,r.x],name:i("APPS.MESSAGES.USERS_LOCATION").format({name:C??H(l.sender)}),icon:u.avatar}}})}},{title:i("APPS.MAPS.SET_WAYPOINT"),cb:()=>{L("Maps",{action:"setWaypoint",data:{x:r.x,y:r.y}})}}]})},children:[e(vt,{location:[parseFloat(r.y),parseFloat(r.x)]}),c==="other"&&o("div",{className:"sender",children:[C??H(l.sender)," ",i("APPS.MESSAGES.SENT_LOCATION")]})]}),s&&e("div",{className:"payment",children:s.request?o("div",{className:he("request",c),children:[o("div",{className:"title",children:[a.CurrencyFormat.replace("%s",Ce(s.amount).toString())," ",i("APPS.MESSAGES.PAY.REQUESTED")]}),c==="other"&&e("div",{className:"button",onClick:()=>Ue(s.amount,{id:u.id,number:u.number,name:u.name}),children:i("APPS.MESSAGES.PAY.PAY")})]}):e("div",{className:"sent",children:a.CurrencyFormat.replace("%s",Ce(s.amount).toString())})}),h&&e(Mt,{data:h,sender:c})]}):l.content&&e("div",{className:"content",children:pe(l.content)}),l.attachments&&l.attachments.length>0&&e("div",{className:"attatchments",children:l.attachments.map((U,_)=>Oe(U)?e("video",{src:U,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:j=>k.FullscreenImage.set(U)},_):e(ye,{src:U,onClick:()=>k.FullscreenImage.set(U)},_))}),l.delivered===!1?e("div",{className:"status",children:i("APPS.MESSAGES.NOT_DELIVERED")}):t[v+1]&&y>6?e("div",{className:"date",children:be(l.timestamp)}):c!==$&&e("div",{className:"date",children:be(l.timestamp)})]},v)},Mt=({data:t,sender:l})=>{var C;const[v,f]=d.useState(!1),[M,P]=d.useState(0),u=d.useRef(null);d.useEffect(()=>{u.current&&(u.current.onended=()=>f(!1))},[u]);const a=m=>{m=Math.floor(m);const y=Math.floor(m/60),s=m-y*60;return`${y<10?"0"+y:y}:${s<10?"0"+s:s}`};return o("div",{className:`voice-message ${l}`,children:[e("a",{onClick:()=>{u.current&&(v?(u.current.pause(),u.current.currentTime=0):u.current.play().catch(()=>w("error","Failed to play audio message")),f(m=>!m))},children:v?e(ze,{}):e(Xe,{})}),o("div",{className:"wave",children:[e("div",{className:"overlay",style:{width:`${(t.duration-M)/t.duration*100}%`}}),e("img",{src:t.wave,alt:"wave"})]}),e("div",{className:"duration",children:a(v&&Math.floor(((C=u.current)==null?void 0:C.currentTime)+.5)!==0?u.current.currentTime:t.duration)}),e("audio",{ref:u,onTimeUpdate:m=>P(m.currentTarget.currentTime),children:e("source",{src:t.src,type:"audio/mpeg"})})]})},Nt=({user:t,setShow:l})=>{const v=D(X.Settings);return o(Q.div,{...Ee,className:"info-panel",children:[e("div",{className:"info-panel-header",children:e("div",{className:"done",onClick:()=>l(!1),children:i("APPS.MESSAGES.DONE")})}),o("div",{className:"info-panel-body",children:[o("div",{className:"info-panel-top",children:[e("div",{className:"avatar","data-hasavatar":(t==null?void 0:t.avatar)!==void 0,style:{backgroundImage:t!=null&&t.avatar?`url(${t.avatar})`:null},children:t.name?!(t!=null&&t.avatar)&&re(t.name):e("img",{src:`./assets/img/avatar-placeholder-${v.display.theme}.svg`,alt:""})}),e("div",{className:"name",children:t.name??H(t.number)})]}),e("div",{className:"items",children:!t.company&&o(ae,{children:[t.name&&e("div",{className:"info-section",children:e("div",{className:"item blue",onClick:()=>Be(t.number),children:H(t.number)})}),e("div",{className:"info-section",children:t.name?e("div",{className:"item blue",onClick:()=>{k.Share.set({type:"contact",data:{firstname:t.firstname,lastname:t.lastname,number:t.number,avatar:t.avatar}})},children:i("APPS.PHONE.CONTACTS.SHARE_CONTACT")}):e("div",{className:"item blue",onClick:()=>{te.patch({active:{name:"Phone",data:{view:"newContact",number:t.number}}})},children:i("APPS.PHONE.CONTACTS.ADD_CONTACT")})})]})})]})]})},pt=t=>{const{View:l}=d.useContext(se),v=D(X.Settings),[f,M]=l,[P,u]=d.useState(t.data.name),[a,C]=d.useState(t.data.avatar);let m=t.data,y=!m.members.find(s=>s.isOwner);return e(ae,{children:o(Q.div,{...Ee,className:"info-panel",children:[o("div",{className:"info-panel-header",children:[e("div",{}),e("div",{className:"close",children:e("div",{className:"button",onClick:()=>t.setShow(!1)})}),e("div",{className:"done",onClick:()=>{P&&P!==""&&P!==m.name?L("Messages",{action:"renameGroup",id:m.id,name:P}).then(s=>{t.setShow(!1)}):t.setShow(!1)},children:i("APPS.MESSAGES.DONE")})]}),o("div",{className:"info-panel-body",children:[o("div",{className:"info-panel-top",children:[a?e(ye,{className:"group-image",src:a,ignoreStreamerMode:!0}):o("div",{className:"group-avatar",children:[m.members.sort((s,r)=>s.avatar?1:-1).slice(0,10).map((s,r)=>e("div",{className:"avatar","data-hasavatar":(s==null?void 0:s.avatar)!==void 0,style:{backgroundImage:s!=null&&s.avatar?`url(${s.avatar})`:null,zIndex:m.members.length-r},children:!(s!=null&&s.avatar)&&re(s.name)},r)),m.members.length===0&&e("img",{src:`./assets/img/avatar-placeholder-${v.display.theme}.svg`,alt:""})]}),e("div",{className:"add-photo",onClick:()=>{var s,r,h;a?k.PopUp.set({title:i("APPS.MESSAGES.REMOVE_AVATAR_POPUP.TITLE"),description:i("APPS.MESSAGES.REMOVE_AVATAR_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.MESSAGES.REMOVE_AVATAR_POPUP.CANCEL")},{title:i("APPS.MESSAGES.REMOVE_AVATAR_POPUP.REMOVE"),color:"red",cb:()=>{L("Messages",{action:"removeGroupAvatar",id:m.id},!0).then(N=>{if(!N)return w("warning","Could not remove group avatar");t.setData(c=>{let $=c;return $.avatar=null,$}),C(null)})}}]}):k.Gallery.set({allowExternal:(h=(r=(s=z)==null?void 0:s.value)==null?void 0:r.AllowExternal)==null?void 0:h.Messages,onSelect:N=>L("Messages",{action:"setGroupAvatar",id:m.id,avatar:N.src},!0).then(c=>{if(!c)return w("warning","Could not set group avatar");t.setData($=>{let F=$;return F.avatar=N.src,F}),C(N.src)})})},children:a?"Remove Photo":" Add Photo"})]}),o("div",{className:"items",children:[e("div",{className:"info-section",children:o("div",{className:"item blue",children:[e(Qe,{className:"add"}),e(de,{defaultValue:m.name??i("APPS.MESSAGES.GROUP_NAME"),onChange:s=>u(s.target.value)})]})}),o("div",{className:"subtitle",children:[m.members.length===0?1:m.members.length," ",i("APPS.MESSAGES.MEMBERS")]}),o("div",{className:"info-section",children:[o("div",{className:"item",onClick:()=>k.ContactSelector.set({filter:m.members.map(s=>s.number),onSelect:s=>{if(m.members.find(r=>r.number===s.number))return w("info","User is already in group");L("Messages",{action:"addMember",id:m.id,number:s.number},!0).then(r=>{if(!r)return w("warning","Could not add member to group");t.setData(h=>{let N=h;return N.members.push({...s,name:J(s.firstname,s.lastname),isOwner:!1}),N})})}}),children:[e(Ke,{className:"add"}),e("div",{className:"name",children:i("APPS.MESSAGES.ADD_MEMBER")})]}),m.members.sort((s,r)=>s.name&&!r.name?-1:!s.name&&r.name?1:s.name<r.name?-1:s.name>r.name?1:0).map((s,r)=>o("div",{className:"item",children:[y&&e(Ze,{className:"remove",onClick:()=>{k.PopUp.set({title:i("APPS.MESSAGES.REMOVE_POPUP.TITLE"),description:i("APPS.MESSAGES.REMOVE_POPUP.TEXT").format({name:s.name??H(s.number)}),buttons:[{title:i("APPS.MESSAGES.CANCEL")},{title:i("APPS.MESSAGES.REMOVE_POPUP.REMOVE"),color:"red",cb:()=>{L("Messages",{action:"removeMember",number:s.number,id:m.id}).then(h=>{h&&(t.setData(N=>{let c=N;return c.members=c.members.filter($=>$.number!==s.number),c}),t.setShow(!1))})}}]})}}),e("div",{className:"avatar","data-hasavatar":(s==null?void 0:s.avatar)!==void 0,style:{backgroundImage:s!=null&&s.avatar?`url(${s.avatar})`:null},children:!(s!=null&&s.avatar)&&re(s.name)}),o("div",{className:"details",children:[e("div",{className:"name",children:s.name??H(s.number)}),s.name&&e("div",{className:"phone-number",children:H(s.number)})]}),e(Je,{className:"info",onClick:()=>t.setShowUserInfo({...s})})]},r))]}),e("div",{className:"info-section",children:e("div",{className:"item blue",onClick:()=>t.sendLocation(),children:i("APPS.MESSAGES.SHARE_LOCATION")})}),e("div",{className:"info-section",onClick:()=>{k.PopUp.set({title:i("APPS.MESSAGES.LEAVE_POPUP.TITLE"),description:i("APPS.MESSAGES.LEAVE_POPUP.TEXT"),buttons:[{title:i("APPS.MESSAGES.CANCEL")},{title:i("APPS.MESSAGES.LEAVE_POPUP.LEAVE"),color:"red",cb:()=>{L("Messages",{action:"leaveGroup",id:m.id}).then(s=>{if(!s)return w("info","Failed to leave group, server didnt callback request");M("userlist"),t.setShow(!1)})}}]})},children:o("div",{className:"item red",children:[e(et,{}),i("APPS.MESSAGES.LEAVE_GROUP")]})})]})]})]})})};function Ct(){const{User:t,View:l,Newmessage:v,ImportedUser:f}=d.useContext(se),[M,P]=t,[u,a]=l,[C,m]=f,y=D(X.Settings),s=D(X.PhoneNumber),[r,h]=v,N=D(Y.APPS.PHONE.contacts),[c,$]=d.useState([]),F=d.useRef(null),[q,U]=d.useState(""),[_,j]=d.useState([]),[R,B]=d.useState({content:"",attachments:[]});d.useEffect(()=>{C&&($([C]),m(null))},[C]);const K=()=>{(R.content.length>0||R.attachments.length>0)&&(c.length>1?L("Messages",{action:"createGroup",members:c,content:R.content,attachments:R.attachments}).then(E=>{if(!E)return w("error","Failed to create group");P({id:E.channelId,lastMessage:R.content,timestamp:Date.now(),isGroup:!0,members:c.map(T=>{let V=J(T.firstname,T.lastname);return{...T,name:V}})}),a("messages"),h(!1)}):(L("Messages",{action:"sendMessage",number:c[0].number,content:R.content,attachments:R.attachments}).then(E=>{var g,A,G,p;if(!E)return w("error","Failed to send message");let T;c[0].name?T=c[0].name:(g=c[0])!=null&&g.firstname&&(T=J((A=c[0])==null?void 0:A.firstname,(G=c[0])==null?void 0:G.lastname));let V={number:c[0].number,name:T,avatar:(p=c[0])==null?void 0:p.avatar};P({...V,id:E.channelId,lastMessage:R.content,timestamp:Date.now()}),w("info","Updating recent message cache state"),Y.APPS.MESSAGES.messages.set(Y.APPS.MESSAGES.messages.value.map(b=>b.id===E.channelId?{...b,timestamp:new Date().getTime(),lastMessage:R.content,unread:!1,deleted:!1}:b))}),a("messages"),h(!1)))};return d.useEffect(()=>{if(q.length>0){if(!N)return w("error","Contacts not loaded");j(N.filter(E=>{let T=J(E.firstname,E.lastname);return T&&T.toLowerCase().includes(q.toLowerCase())&&!E.company}))}else j([])},[q]),o(Q.div,{...Ee,className:"new-message-container",children:[o("div",{className:"new-message-header",children:[e("span",{}),e("div",{className:"title",children:i("APPS.MESSAGES.NEW_MESSAGE")}),e("div",{className:"button",onClick:()=>{var T,V,g;c.length>0&&(R.content.length>0||R.attachments.length>0)?K():(h(!1),(g=(V=(T=te)==null?void 0:T.value)==null?void 0:V.active)!=null&&g.data&&te.patch({active:{...te.value.active,data:null}}))},children:c.length>0&&(R.content.length>0||R.attachments.length>0)?i("APPS.MESSAGES.SEND"):i("APPS.MESSAGES.CANCEL")})]}),o("div",{className:"new-message-body",children:[o("div",{className:"new-message-search",children:[o("div",{className:"to",children:[i("APPS.MESSAGES.TO"),":"]}),e("div",{className:"contacts",children:c.map((E,T)=>{let V=J(E.firstname,E.lastname),g=V!=="Unknown";return e("div",{className:he("contact",g?"green":"blue"),onClick:()=>{k.PopUp.set({title:i("APPS.MESSAGES.REMOVE_POPUP.TITLE"),description:i("APPS.MESSAGES.REMOVE_POPUP.TEXT").format({NAME:V??H(E.number)}),buttons:[{title:i("APPS.MESSAGES.CANCEL")},{title:i("APPS.MESSAGES.REMOVE_POPUP.REMOVE"),color:"red",cb:()=>{let A=c.filter(G=>G.number!==E.number);$(A)}}]})},children:g?V:H(E.number)},T)})}),e(de,{type:"text",ref:F,onChange:E=>{if(U(E.target.value),E.target.value.length==s.length&&/^\d+$/g.test(E.target.value)){if(E.target.value===s||c.find(V=>V.number==E.target.value))return;$([...c,{number:E.target.value}]),F.current.value="",U("")}},onKeyDown:E=>{var T;E.key=="Backspace"&&q.length==0?((T=c[c.length-1])==null?void 0:T.name)===void 0?(F.current.value=c[c.length-1].number,$(c.slice(0,c.length-1))):$(c.slice(0,-1)):E.key=="Tab"&&(E.preventDefault(),_.length==1&&($([...c,_[0]]),F.current.value="",U("")))}})]}),e("div",{className:"search-results",children:_&&_.filter(E=>!c.find(T=>T.number==E.number)).map((E,T)=>{let V=J(E.firstname,E.lastname);return o("div",{className:"contact",onClick:()=>{c.find(A=>A.number==E.number)||($([...c,E]),F.current.value="",U(""))},children:[e("img",{src:E.avatar??`./assets/img/avatar-placeholder-${y.display.theme}.svg`}),o("div",{className:"user",children:[e("div",{className:"name",children:V}),e("div",{className:"number",children:H(E.number)})]})]},T)})})]}),c.length>0&&_.length===0&&e("div",{className:"message-bottom absolute",children:e("div",{className:"upper",children:o("div",{className:"input",children:[e(de,{placeholder:i("APPS.MESSAGES.PLACEHOLDER"),value:R.content,onChange:E=>{B({content:E.target.value??"",attachments:R.attachments})},onKeyDown:E=>{E.key=="Enter"&&K()}}),(R.content.length>0||R.attachments.length>0)&&e("div",{className:"send",onClick:()=>K(),children:e(Ge,{})})]})})})]})}const Z=Se([]),ee=Se([]);function bt(){var V;const{User:t,View:l,Newmessage:v,UnreadMessages:f,ImportedUser:M}=d.useContext(se),P=D(X.PhoneNumber),u=D(X.Settings),a=(V=D(te))==null?void 0:V.active,[C,m]=t,[y,s]=l,[r,h]=M,[N,c]=v,[$,F]=f,q=D(Y.APPS.PHONE.contacts),U=D(Y.APPS.MESSAGES.messages),_=D(Z),[j,R]=d.useState(""),[B,K]=d.useState(!1),E=D(ee);d.useEffect(()=>{U?(w("info","Using cache for recent messages"),Z.set(U),F(_.filter(g=>g.unread).length)):L("Messages",{action:"getRecentMessages"},Re.Messagelist).then(g=>{let A=g.map(G=>{if(G.isGroup)return G.members=G.members.filter(p=>p.number!==P).map(p=>{let b=q.find(ne=>ne.number===p.number);return{name:b&&b.firstname?J(b==null?void 0:b.firstname,b==null?void 0:b.lastname):void 0,avatar:b==null?void 0:b.avatar,blocked:b==null?void 0:b.blocked,favourite:b==null?void 0:b.favourite,number:p.number,isOwner:p.isOwner}}),G;{let p=q.find(b=>b.number===G.number);return G.name=p!=null&&p.lastname?`${p.firstname} ${p.lastname}`:p==null?void 0:p.firstname,G.avatar=p==null?void 0:p.avatar,G}});F(A.filter(G=>G.unread).length),Z.set(A),w("info","setting cache"),Y.APPS.MESSAGES.messages.set(A)})},[U]);let T=d.useRef(!1);return d.useEffect(()=>{var g;if(!T.current&&a!=null&&a.data&&(T.current=!0,a!=null&&a.data&&((g=a.data)==null?void 0:g.view)=="messages")){let A=_.find(G=>G.number===a.data.number);A?(m(A),s("messages")):(c(!0),h({number:a.data.number,name:a.data.name,avatar:a.data.avatar}))}},[a==null?void 0:a.data,_]),oe("messages:newMessage",g=>{let A=JSON.parse(JSON.stringify(_)),G=A.findIndex(p=>p.id===g.channelId);u.airplaneMode||(G!==-1&&A.unshift(A.splice(G,1)[0]),A[0].lastMessage=g.content,A[0].timestamp=new Date,Z.set(A))}),o(ae,{children:[e(ce,{children:N&&e(Ct,{})}),o(Q.div,{...Ie("left","messagelist",.2),className:"animation-container",children:[o("div",{className:"messages-header",children:[o("div",{className:"buttons",children:[e("div",{className:"edit",onClick:()=>K(!B),children:B?i("APPS.MESSAGES.DONE"):i("APPS.MESSAGES.EDIT")}),e(tt,{"data-disabled":B,onClick:()=>c(!0)})]}),e("div",{className:"title",children:i("APPS.MESSAGES.TITLE")})]}),e(at,{placeholder:i("SEARCH"),onChange:g=>R(g.target.value)}),e("div",{className:"users-list",children:_.filter(g=>{var A;return g.deleted?!1:(g.isGroup?g.members.find(G=>{var p;return((p=G.name)==null?void 0:p.toLowerCase().includes(j.toLowerCase()))||G.number.includes(j)}):((A=g.name)==null?void 0:A.toLowerCase().includes(j.toLowerCase()))||g.number.includes(j))||g.lastMessage.toLowerCase().includes(j.toLowerCase())}).sort((g,A)=>A.timestamp-g.timestamp).map((g,A)=>e(wt,{user:g,editMode:B,onClick:()=>{if(m(g),s("messages"),g.unread){L("Messages",{action:"markRead",id:g.id},!0),F(p=>p-1);let G=Y.APPS.MESSAGES.messages.value;Y.APPS.MESSAGES.messages.set(G.map(p=>(p.id===g.id&&(p.unread=!1),p)))}}},A))}),e(ce,{children:B&&o(Q.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},transition:{duration:.2,ease:"easeInOut"},className:"messages-footer",children:[e("div",{className:"button","data-disabled":!0,children:i("APPS.MESSAGES.READ")}),e("div",{className:"button",onClick:()=>{if(E.length===0)return w("info","No messages selected, can't delete");k.PopUp.set({title:i("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),description:i("APPS.MESSAGES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:i("APPS.MESSAGES.CANCEL")},{title:i("APPS.MESSAGES.DELETE"),cb:()=>{L("Messages",{action:"deleteConversations",channels:E},!0).then(g=>{if(!g)return w("error","Failed to delete conversations");K(!1),Z.set(_.filter(A=>!E.includes(A.id))),Y.APPS.MESSAGES.messages.set([...Y.APPS.MESSAGES.messages.value.map(A=>(E.includes(A.id)&&(A.deleted=!0),A))]),ee.set([])})}}]})},children:i("APPS.MESSAGES.DELETE")})]})})]})]})}const wt=({user:t,editMode:l,onClick:v})=>{var y,s;const f=D(z),M=D(X.Settings),P=D(Z),[u,a]=d.useState(!1);let C;const m=Te(r=>{k.ContextMenu.set({buttons:[{title:i("APPS.MESSAGES.MARK_AS_READ"),cb:()=>{L("Messages",{action:"markRead",id:t.id},!0).then(h=>{if(!h)return w("error","Failed to mark message as read");Z.set(P.map(c=>(c.id===t.id&&(c.unread=!1),c)));let N=Y.APPS.MESSAGES.messages.value;Y.APPS.MESSAGES.messages.set(N.map(c=>(c.id===t.id&&(c.unread=!1),c)))})}},{title:i("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),color:"red",cb:()=>{k.PopUp.set({title:i("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),description:i("APPS.MESSAGES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:i("APPS.MESSAGES.CANCEL")},{title:i("APPS.MESSAGES.DELETE"),cb:()=>{L("Messages",{action:"deleteConversations",channels:[t.id]},!0).then(h=>{if(!h)return w("error","Failed to delete conversations");Z.set(P.filter(N=>N.id!==t.id)),Y.APPS.MESSAGES.messages.set([...Y.APPS.MESSAGES.messages.value.map(N=>(N.id===t.id&&(N.deleted=!0),N))]),ee.set([])})}}]})}}]})});if(t.isGroup?t.name?C=t.name:t.members.length===0?C=i("APPS.MESSAGES.GROUP"):C=t.members.sort((r,h)=>r.name&&!h.name?-1:!r.name&&h.name?1:r.name<h.name?-1:r.name>h.name?1:0).map((r,h)=>{if(h<2)return r.name?r.name:H(r.number);if(h===2)return`+${t.members.length-2} ${i("APPS.MESSAGES.OTHER").toLowerCase()}`}).join(", "):C=t.name,t.lastMessage){if(t.lastMessage==="Attachment"&&(t.lastMessage=i("APPS.MESSAGES.SENT_A_PHOTO")),/<!SENT-PAYMENT-(\d*)!>/.test(t.lastMessage)){let r=t.lastMessage.match(/\d/g).join("");t.lastMessage=`${i("APPS.MESSAGES.SENT")} ${f.CurrencyFormat.replace("%s",r)}`}else if(/<!REQUESTED-PAYMENT-(\d*)!>/.test(t.lastMessage)){let r=t.lastMessage.match(/\d/g).join("");t.lastMessage=`${i("APPS.MESSAGES.REQUESTED")} $${r}`}else if(/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(t.lastMessage))t.lastMessage=`${i("APPS.MESSAGES.SENT_LOCATION_SHORT")}`;else if(t.lastMessage.startsWith('<!AUDIO-MESSAGE-IMAGE="'))t.lastMessage=i("APPS.MESSAGES.SENT_AUDIO_MESSAGE");else if(t.lastMessage==="<!CALL-NO-ANSWER!>")t.lastMessage=i("APPS.MESSAGES.TRIED_TO_CALL").format({number:H(t.number)});else if(t.lastMessage==="")return}return d.useEffect(()=>{u?ee.set([...ee.value,t.id]):ee.set(ee.value.filter(r=>r!==t.id))},[u]),o(Q.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"user",...m,onClick:()=>{l?a(!u):v()},children:[o("div",{className:"items",children:[l&&e(Q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"check","data-checked":u,onClick:r=>{r.stopPropagation(),a(!u)},children:u&&e(st,{})},"check"),e("div",{className:he("dot",t.unread&&"unread")})]}),t.isGroup?o("div",{className:"avatar group",children:[t.members.map((r,h)=>{if(h<=3)return r.avatar?e("div",{"data-hasavatar":"true",style:{backgroundImage:`url(${r.avatar})`}},h):r.name?e("div",{children:r.name.charAt(0)},h):e("div",{className:"unknown"},h)}),t.members.length===0&&e("img",{className:"avatar",src:`assets/img/avatar-placeholder-${M.display.theme}.svg`})]}):e("div",{className:"avatar",style:{backgroundImage:t!=null&&t.avatar?`url(${t.avatar})`:null},children:t.name?!(t!=null&&t.avatar)&&re(t.name):e("img",{src:`assets/img/avatar-placeholder-${M.display.theme}.svg`,alt:""})}),o("div",{className:"user-body",children:[o("div",{className:"user-header",children:[e("div",{className:"name",children:C??H(t.number)}),o("div",{className:"right",children:[e("div",{className:"time",children:nt(t.timestamp)}),e(it,{})]})]}),e("div",{className:"content",children:((y=t.lastMessage)==null?void 0:y.length)>40?((s=t.lastMessage)==null?void 0:s.substring(0,40))+"...":t.lastMessage})]})]})};const se=d.createContext(null);function Gt(){const[t,l]=d.useState(null),[v,f]=d.useState("userlist"),[M,P]=d.useState(null),[u,a]=d.useState(0),[C,m]=d.useState(!1);return e("div",{className:"messages-container","data-view":v,children:e(se.Provider,{value:{User:[t,l],View:[v,f],Newmessage:[C,m],ImportedUser:[M,P],UnreadMessages:[u,a]},children:v==="userlist"?e(bt,{}):t&&e(Pt,{})})})}export{se as MessagesContext,Gt as default};
