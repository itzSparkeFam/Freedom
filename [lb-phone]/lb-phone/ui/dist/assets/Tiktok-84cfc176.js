import{a as e,ai as De,r as s,E as se,p as _,q as c,j as a,w as Fe,L as i,K as Te,a9 as me,C as q,cy as Ve,_ as ue,m as ae,cz as Re,N as pe,I as ge,aw as Xe,cd as Me,ac as Oe,ad as Ce,a3 as Ke,cs as xe,cA as Ge,ba as Ae,Q as ke,a7 as _e,F as ee,d as de,a4 as Qe,$ as et,cq as Be,u as he,A as Se,aU as We,cB as tt,cC as He,b0 as nt,P as ce,T as $e,S as Ze,b as ve,s as ie,cD as it,cE as st,cF as at,cl as ot,az as Ue,am as lt,an as rt,bd as qe,aA as ct,aB as ut,a6 as dt,bW as mt,cg as ft,c0 as ht,ch as vt,cv as be,cG as Tt,bZ as gt,cH as Pt,cI as pt,cu as St,bj as Ct}from"./index-594e1857.js";import{T as ze}from"./Textarea-251c47d2.js";import{S as It}from"./Switch-ffaa3cda.js";import{S as Nt}from"./Slider-fb8d9803.js";function fe(){return e("div",{className:"checkmark",children:e(De,{})})}const z={Account:{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},Accounts:[{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,video_count:2,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},{name:"Breze",username:"breze",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"breze",instagram:"breze",isFollowing:!0,following:["lb"],followers:["lb"]},{name:"Loaf Scripts",username:"loaf",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"loaf",instagram:"loaf",isFollowing:!0,following:["lb"],followers:["lb"]}],Videos:[{id:"1",caption:"Trippy vibes",src:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",views:532,likes:16,comments:1,saves:1,commentsData:[{id:"1",username:"lb",name:"LB",verified:!0,avatar:"https://docs.lbscripts.com/images/icons/icon.png",comment:"First comment!",creator_liked:1,likes:1,liked:1,timestamp:Date.now()-1e3*60*60*2}],timestamp:Date.now()-1e3*60*60*8,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0},{id:"2",caption:"Car spotting in Los Santos",src:"https://r2.fivemanage.com/video/0NNIBeGAfx5J.mp4",views:1445,likes:123,comments:0,saves:3,commentsData:[],timestamp:Date.now()-1e3*60*60*24,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0}],Messages:[{id:"1",username:"breze",name:"Breze",verified:!0,last_message:"hey",unread_messages:1,following_count:12,follower_count:123,messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,last_message:"yoo, that vid was fire",unread_messages:0,following_count:4,follower_count:3,messages:[{id:"3",sender:"loaf",content:"yoo, that vid was fire",timestamp:Date.now()-1e3*60*60*8},{id:"1",sender:"lb",video:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",videoId:"1",timestamp:Date.now()-1e3*60*60*13}],timestamp:Date.now()-1e3*60*60*8}],Notifications:[{type:"like",username:"loaf",name:"Loaf Scripts",videoId:"1",videoSrc:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,followsYou:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function Ye(){return e("svg",{viewBox:"0 0 16 14",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.0203 0.108741C13.5601 -0.122158 15.75 1.87768 15.75 4.42804V4.49056C15.75 5.65597 15.2871 6.77366 14.463 7.59773L8.81009 13.2506C8.36271 13.698 7.63736 13.698 7.18998 13.2506L1.53704 7.59773C0.712962 6.77366 0.25 5.65597 0.25 4.49055V4.42806C0.25 1.87769 2.4399 -0.122157 4.97979 0.108742C6.17121 0.217053 7.26352 0.812457 8.00003 1.75171C8.73653 0.812457 9.82884 0.217052 11.0203 0.108741ZM14.25 4.42804C14.25 2.75973 12.8175 1.45154 11.1561 1.60258C10.3564 1.67528 9.625 2.08341 9.14323 2.72577L8.67378 3.3517C8.33691 3.80087 7.66317 3.80087 7.32629 3.35171L6.85681 2.72576C6.37504 2.08341 5.64364 1.67528 4.84399 1.60258C3.18252 1.45154 1.75 2.75974 1.75 4.42806V4.49055C1.75 5.25815 2.05493 5.9943 2.5977 6.53707L8.00003 11.9394L13.4023 6.53707C13.9451 5.9943 14.25 5.25815 14.25 4.49056V4.42804Z",fill:"currentColor"})})}function wt(){const{User:t}=s.useContext(W),[d]=t,[f,g]=s.useState(""),[K,C]=s.useState(""),[u,h]=s.useState([]),[l,r]=s.useState([]),[n,o]=s.useState(0),[v,L]=s.useState(!1),[b,U]=s.useState(0),[T,P]=s.useState(!1),[S,M]=s.useState(!1);s.useEffect(()=>{se("TikTok")&&_("TikTok",{action:"getVideos",data:{full:!0,type:"recent"},page:0},z.Videos).then(N=>{if(!N)return c("warning","Failed to get videos");r(N)})},[]),s.useEffect(()=>{f.length>0&&_("TikTok",{action:"searchAccounts",query:f},z.Accounts.filter(N=>N.username.includes(f))).then(N=>{if(!N)return c("info","No response, most likely no accounts to search for?");h(N)}),U(0),M(!1)},[f]),s.useEffect(()=>{const N=setTimeout(()=>g(K),500);return()=>clearTimeout(N)},[K]);const y=()=>{let N=f.length===0;if(N&&v)return c("info","Fetched everything, no need to fetch more (VIDEOS)");if(!N&&S)return c("info","Fetched everything, no need to fetch more (SEARCH)");if(T)return c("info","Already fetching");let w=document.querySelector("#last");if(!w)return c("warning","No last element");!Te(w)&&(P(!0),_("TikTok",{action:N?"getVideos":"searchAccounts",query:f,data:{full:!0,type:"recent"},page:(N?n:b)+1},null).then(A=>{A&&A.length>0?(N?r(p=>[...p,...A]):h(p=>[...p,...A]),P(!1)):(P(!1),N?L(!0):M(!0))}),N?o(A=>A+1):U(A=>A+1))};return a("div",{className:"discover-container",children:[e("div",{className:"discover-header",children:e(Fe,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:N=>C(N.target.value)})}),f.length>0?e("div",{className:"search-results",onScroll:y,children:u==null?void 0:u.filter(N=>N.username!==d.username).map((N,w)=>e(Ot,{data:N,last:u.length-1===w},w))}):e("div",{className:"discover-content",onScroll:y,children:l.map((N,w)=>e(At,{data:N,last:l.length-1===w},w))})]})}const Ot=({data:t,last:d})=>{const{User:f,Func:g,GoBack:K}=s.useContext(W),[C,u]=K,[h,l]=s.useState(t.isFollowing),r=n=>{_("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},!0).then(o=>{if(!o||!(o!=null&&o.success))return c("warning","Failed to toggle follow");if(o.error)return c("error",o.error);l(n)})};return a("div",{className:"item",id:d?"last":"",onClick:()=>{u({view:"discover"}),g.fetchAndSetProfile(t.username)},children:[a("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:J(t.avatar)})}),a("div",{className:"user",children:[a("div",{className:"name",children:[t.username,t.verified&&e(fe,{})]}),e("div",{className:"username",children:t.name}),a("div",{className:"stats",children:[X(t.followers)," ",i("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",X(t.videos)??"0"," ",i("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]}),e("div",{className:"action",children:e("div",{className:me("button",h?"following":"follow"),onClick:n=>{n.stopPropagation(),h?q.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:h?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})},At=({data:t,last:d})=>{const{Func:f,GoBack:g}=s.useContext(W),[K,C]=g;return a("div",{className:"item",id:d?"last":"",onClick:()=>{f.fetchAndSetVideo(t.id,{type:"recent"}),C({view:"discover"})},children:[a("div",{className:"video-item",children:[e("video",{src:t.src,loop:!0,onMouseEnter:u=>u.currentTarget.play().catch(()=>{}),onMouseLeave:u=>u.currentTarget.pause(),muted:!0}),e("div",{className:"timestamp",children:Ne(t.timestamp)})]}),a("div",{className:"video-items",children:[e("div",{className:"caption",children:t.caption}),a("div",{className:"video-info",children:[a("div",{className:"user",onClick:u=>{u.stopPropagation(),C({view:"discover"}),f.fetchAndSetProfile(t.username)},children:[e("img",{src:J(t.avatar)}),e("div",{className:"name",children:t.username})]}),a("div",{className:"stats",children:[a("div",{children:[e(Ve,{className:"plays"}),X(t.views)]}),a("div",{children:[e(Ye,{}),X(t.likes)]})]})]})]})]})};function kt(){const{User:t,View:d,Dm:f}=s.useContext(W),[g,K]=d,[C,u]=f,[h,l]=s.useState(!1),[r,n]=s.useState([]);return s.useEffect(()=>{se("TikTok")&&_("TikTok",{action:"getRecentMessages"},{success:!0,channels:z.Messages}).then(o=>{if(!(o!=null&&o.success))return c("warning",o.error);n(o.channels)})},[]),ue("tiktok:receivedMessage",o=>{n(v=>{let L=v.findIndex(U=>U.channelId===o.channelId);if(L===-1)return v;let b=[...v];return b[L].lastMessage=o.content,b[L].lastMessageTimestamp=Date.now(),b})}),a(ae.div,{...Re,className:"messages-container",children:[e(pe,{children:h&&e(Kt,{close:()=>l(!1)})}),a("div",{className:"dmmessages-header",children:[e(ge,{onClick:()=>K("inbox")}),e("div",{className:"title",children:i("APPS.TIKTOK.DIRECT_MESSAGES")}),e(Xe,{onClick:()=>l(!0)})]}),a("div",{className:"messages-body",children:[r.length===0&&a("div",{className:"no-messages",children:[e(Me,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_MESSAGES_TITLE")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_MESSAGES_SUBTITLE")})]}),r.map((o,v)=>a("div",{className:"message","data-unread":o.unread_messages>0,onClick:()=>{u({id:o.id,name:o.name,username:o.username,avatar:o.avatar,verified:o.verified,follower_count:o.follower_count,following_count:o.following_count,video_count:o.video_count}),o.unread_messages>0&&_("TikTok",{action:"clearUnreadMessages",id:o.id}),K("dm")},children:[a("div",{className:"user",children:[e("img",{src:J(o.avatar)}),a("div",{className:"message-content",children:[e("div",{className:"username",children:o.name}),e("div",{className:"content",children:o.last_message})]})]}),e("div",{className:"timestamp",children:Oe(o.timestamp)})]},v))]})]})}const Kt=({close:t})=>{const{User:d}=s.useContext(W),[f]=d,[g,K]=s.useState(""),[C,u]=s.useState(""),[h,l]=s.useState([]);s.useEffect(()=>{const n=setTimeout(()=>K(C),500);return()=>clearTimeout(n)},[C]),s.useEffect(()=>{g.length>0&&_("TikTok",{action:"searchAccounts",query:g},{success:!0,accounts:z.Accounts}).then(n=>{if(!n)return c("info","No response, most likely no accounts to search for?");l(n)})},[g]);const r=n=>{};return a(ae.div,{...Ce,className:"search-container",children:[a("div",{className:"search-header",children:[e(Ke,{onClick:t}),e(Fe,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:n=>u(n.target.value)}),e("span",{})]}),e("div",{className:"search-results",onScroll:r,children:h==null?void 0:h.filter(n=>n.username!==f.username).map((n,o)=>e(Et,{data:n,last:h.length-1===o},o))})]})},Et=({data:t,last:d})=>{const{View:f,Dm:g}=s.useContext(W),[K,C]=f,[u,h]=g;return e("div",{className:"item",id:d?"last":"",onClick:()=>{h({name:t.name,username:t.username,avatar:t.avatar,verified:t.verified,follower_count:t.follower_count,following_count:t.following_count,video_count:t.video_count}),C("dm")},children:a("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:J(t.avatar)})}),a("div",{className:"user",children:[a("div",{className:"name",children:[t.username,t.verified&&e(fe,{})]}),e("div",{className:"username",children:t.name}),a("div",{className:"stats",children:[X(t.follower_count)," ",i("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",X(t.video_count)??"0"," ",i("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]})})};function je({className:t}){return a("svg",{className:t,width:"43",height:"43",viewBox:"0 0 43 43",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a("g",{filter:"url(#filter0_d_4_1160)",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8242 33.4976C21.7164 33.4992 21.6083 33.5 21.5 33.5C11.835 33.5 4 27.0081 4 19C4 10.9919 11.835 4.5 21.5 4.5C31.165 4.5 39 10.9919 39 19C39 21.0253 38.4989 22.9536 37.5938 24.7044C36.3794 27.1797 34.5051 29.3888 32.472 31.2945C29.3743 34.1981 25.7901 36.39 23.2378 37.6253C22.5627 37.9521 21.8242 37.4404 21.8242 36.7278V33.4976ZM15.5 19.75C15.5 21.1307 14.3807 22.25 13 22.25C11.6193 22.25 10.5 21.1307 10.5 19.75C10.5 18.3693 11.6193 17.25 13 17.25C14.3807 17.25 15.5 18.3693 15.5 19.75ZM21.5 22.25C22.8807 22.25 24 21.1307 24 19.75C24 18.3693 22.8807 17.25 21.5 17.25C20.1193 17.25 19 18.3693 19 19.75C19 21.1307 20.1193 22.25 21.5 22.25ZM32.5 19.75C32.5 21.1307 31.3807 22.25 30 22.25C28.6193 22.25 27.5 21.1307 27.5 19.75C27.5 18.3693 28.6193 17.25 30 17.25C31.3807 17.25 32.5 18.3693 32.5 19.75Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 33.5C31.165 33.5 39 27.0081 39 19C39 10.9919 31.165 4.5 21.5 4.5C11.835 4.5 4 10.9919 4 19C4 27.0081 11.835 33.5 21.5 33.5ZM13 22.25C14.3807 22.25 15.5 21.1307 15.5 19.75C15.5 18.3693 14.3807 17.25 13 17.25C11.6193 17.25 10.5 18.3693 10.5 19.75C10.5 21.1307 11.6193 22.25 13 22.25ZM24 19.75C24 21.1307 22.8807 22.25 21.5 22.25C20.1193 22.25 19 21.1307 19 19.75C19 18.3693 20.1193 17.25 21.5 17.25C22.8807 17.25 24 18.3693 24 19.75ZM30 22.25C31.3807 22.25 32.5 21.1307 32.5 19.75C32.5 18.3693 31.3807 17.25 30 17.25C28.6193 17.25 27.5 18.3693 27.5 19.75C27.5 21.1307 28.6193 22.25 30 22.25Z",fill:"currentColor"})]}),e("defs",{children:a("filter",{id:"filter0_d_4_1160",x:"0",y:"0.83",width:"43",height:"41.2262",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1160"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1160",result:"shape"})]})})]})}function Ee({className:t}){return a("svg",{className:t,viewBox:"0 0 44 41",xmlns:"http://www.w3.org/2000/svg",children:[a("g",{filter:"url(#filter0_d_4_1165)",children:[e("path",{d:"M20.0611 35.818C21.0718 36.5395 22.4282 36.5395 23.4389 35.818C28.4905 32.2118 33.3281 28.063 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C10.1719 28.063 15.0095 32.2118 20.0611 35.818Z",fill:"currentColor"}),e("path",{d:"M20.0611 31.5C21.0718 32.2216 22.4282 32.2216 23.4389 31.5C29 28.5 31 27.5 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C13 27.5 15 28.5 20.0611 31.5Z",fill:"currentColor"})]}),e("defs",{children:a("filter",{id:"filter0_d_4_1165",x:"0",y:"0.33",width:"43.5",height:"40.3591",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1165"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1165",result:"shape"})]})})]})}function Lt(){const{View:t}=s.useContext(W),[d,f]=t,[g,K]=s.useState([]),[C,u]=s.useState(0),[h,l]=s.useState(0),[r,n]=s.useState(!1),[o,v]=s.useState(!1);s.useEffect(()=>{se("TikTok")&&(_("TikTok",{action:"getUnreadMessages"},{success:!0,unread:1}).then(b=>{if(!b.success)return c("warning","Failed to get unread messages: "+b.error);u(b==null?void 0:b.unread)}),_("TikTok",{action:"getNotifications",page:0},{success:!0,data:z.Notifications}).then(b=>{if(!b.success)return c("warning","Failed to get notifications: "+b.error);K(b.data)}))},[]);const L=()=>{if(o||r)return;let b=document.querySelector("#last");if(!b)return;!Te(b)&&(n(!0),_("TikTok",{action:"getNotifications",page:h+1},null).then(T=>{var P;if(!(T!=null&&T.success))return c("warning","Failed to get notifications: "+T.error);if(!(T!=null&&T.data))return c("warning","Failed to get notifications: (NO DATA)"+(T==null?void 0:T.error));T&&((P=T==null?void 0:T.data)==null?void 0:P.length)>0?(K([...g,...T.data]),n(!1)):v(!0)}),l(T=>T+1))};return a("div",{className:"inbox-container",children:[a("div",{className:"inbox-header",children:[e("span",{}),e("div",{className:"title",children:i("APPS.TIKTOK.ALL_ACTIVITY")}),a("div",{className:"messages",onClick:()=>f("messages"),children:[e(xe,{}),C>0&&e("div",{className:"notifications",children:C})]})]}),a("div",{className:"inbox-body",onScroll:L,children:[g.length===0&&a("div",{className:"no-notifications",children:[e(Ge,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_NOTIFICATIONS")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_NOTIFICATIONS_SUBTITLE")})]}),g.map((b,U)=>e(_t,{data:b,last:g.length-1===U},U))]})]})}const _t=({data:t,last:d})=>{const{Func:f,GoBack:g}=s.useContext(W),[K,C]=g,[u,h]=s.useState(t.isFollowing),l=o=>{_("TikTok",{action:"toggleFollow",data:{username:t.username,follow:o}},{success:!0}).then(v=>{if(!v||!(v!=null&&v.success))return c("warning","Failed to toggle follow");if(v.error)return c("error",v.error);h(o)})};let r;switch(t.type){case"follow":r=i("APPS.TIKTOK.STARTED_FOLLOWING");break;case"like":r=i("APPS.TIKTOK.LIKED_VIDEO");break;case"like_comment":r=i("APPS.TIKTOK.LIKED_COMMENT");break;case"save":r=i("APPS.TIKTOK.SAVED_VIDEO");break;case"comment":r=i("APPS.TIKTOK.COMMENTED").format({comment:t.commentText});break;case"reply":r=i("APPS.TIKTOK.REPLIED").format({comment:t.commentText});break}const n=()=>{C({view:"inbox"}),f.fetchAndSetProfile(t.username)};return a("div",{className:me("notification",t.type),id:d?"last":"",children:[a("div",{className:"user",children:[a("div",{className:"avatar",onClick:n,children:[e("img",{src:J(t.avatar)}),(t.type==="like"||t.type==="comment"||t.type==="reply")&&e("div",{className:"type","data-color":t.type==="like"?"red":"blue",children:t.type==="like"?e(Ee,{}):e(je,{})})]}),a("div",{className:"info",children:[a("div",{className:"username",onClick:n,children:[t.name,t.verified&&e(fe,{})]}),a("div",{className:"notification-content",children:[r,e("div",{className:"timestamp",children:Ne(t.timestamp)})]}),(t.type==="reply"||t.type==="like_comment")&&a("div",{className:"original-text",children:[e("div",{className:"border"}),t.type==="like_comment"?t.commentText:t.originalText]})]})]}),t.type==="follow"?e("div",{className:me("button",u?"following":"follow"),onClick:o=>{o.stopPropagation(),u?q.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>l(!1)}]}):l(!0)},children:u?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")}):e("div",{className:"video-preview",onClick:()=>{t.videoId&&(C({view:"inbox"}),f.fetchAndSetVideo(t.videoId,{single:!0}))},children:e("video",{src:t.videoSrc,controls:!1,autoPlay:!1,muted:!0})})]})};function Ut(){const{User:t,GoBack:d,View:f,Func:g,Dm:K,Profile:C}=s.useContext(W),[u,h]=t,[l,r]=f,[n]=K,[o,v]=d,[L,b]=C,[U,T]=s.useState([]),[P,S]=s.useState(n==null?void 0:n.id),M=s.useRef(null),[y,N]=s.useState(""),[w,m]=s.useState(0),[A,p]=s.useState(!1),[I,F]=s.useState(!1);s.useEffect(()=>(Ae.ReceiveAppNotifications.set(!1),()=>{Ae.ReceiveAppNotifications.set(!0)}),[]),s.useEffect(()=>{var E;P&&_("TikTok",{action:"getMessages",page:0,id:P},{success:!0,messages:(E=z.Messages.find(D=>D.id===P))==null?void 0:E.messages}).then(D=>{if(!(D!=null&&D.success))return c("warning","An error occured while fetching messages. "+(D==null?void 0:D.error));if(!(D!=null&&D.messages))return c("warning","An error occured while fetching messages. (No messages)");T(D.messages.reverse())})},[P]),ue("tiktok:receivedMessage",E=>{n.username===E.sender&&T([...U,{...E,timestamp:new Date().getTime()}])});const V=()=>{var E;if(y.trim().length===0)return c("warning","You can't send an empty message");_("TikTok",{action:"sendMessage",data:{id:P,username:n.username,content:y}},{success:!0,id:"3",channelId:(E=z.Messages.find(D=>D.id===P))==null?void 0:E.id}).then(D=>{if(!(D!=null&&D.success))return c("warning","An error occured while sending message. "+(D==null?void 0:D.error));c("info",`Message sent to ${n.username}, id: ${D.id}, channelId: ${D==null?void 0:D.channelId}`),D!=null&&D.channelId&&!P&&S(D.channelId),M.current.value="",T([...U,{id:D.id,sender:u.username,recipient:n.username,content:y,timestamp:new Date().getTime()}]),N("");let Z=document.querySelector(".dm-body");Z.scrollTop=Z.scrollHeight})},B=()=>{if(A||I)return;let E=document.querySelector("#last");if(!E)return;!Te(E)&&(F(!0),_("Instagram",{action:"getMessages",page:w+1,username:n.username},null).then(Z=>{Z&&Z.length>0?(T([...Z.reverse(),...U]),F(!1)):p(!0)}),m(Z=>Z+1))},$=E=>{if(E)return/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/.test(E)},te=E=>{g.fetchAndSetVideo(E,{single:!0}),v({view:"dm"})};return a(ae.div,{...Re,className:"dm-container",children:[a("div",{className:"dm-header",children:[e(ge,{onClick:()=>{o!=null&&o.view?(o.data&&o.data.identifier==="profile"&&b(o.data.data),r(o.view),v(null)):r("messages")},className:"chevron"}),a("div",{className:"profile",onClick:E=>{E.stopPropagation(),v({view:"dm",data:{identifier:"dm",data:n}}),g.fetchAndSetProfile(n.username)},children:[e("div",{className:"avatar",children:e("img",{src:J(n.avatar)})}),a("div",{className:"username",children:[n.name??n.username,n.verified&&e(fe,{})]})]})]}),e("div",{className:"dm-body-container",onScroll:B,children:a("div",{className:"dm-body",children:[a("div",{className:"messages-hero","data-nomessages":U.length===0,children:[e("img",{className:"avatar",src:J(n.avatar)}),e("div",{className:"name",children:n.name}),a("div",{className:"secondary",children:[a("div",{className:"username",children:["@",n.username]}),a("div",{className:"stats",children:[a("div",{className:"following",children:[X(n.following_count)," ",i("APPS.TIKTOK.FOLLOWING").toLowerCase()]}),a("div",{className:"followers",children:[X(n.follower_count)," ",i("APPS.TIKTOK.FOLLOWERS").toLowerCase()]})]})]})]}),U.map((E,D)=>{var Q;let Z,R=D===0,x=E.sender===u.username?"self":"other",j=((Q=U[D+1])==null?void 0:Q.sender)===u.username?"self":"other";return U[D+1]?Z=Math.abs(E.timestamp-U[D+1].timestamp)/36e5:j=void 0,E.content&&$(E.content)&&(E.video=E.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[1],E.videoId=E.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[2]),a("div",{className:`message ${x}`,id:R?"last":"",children:[x=="other"?a("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${x!==j?"show":"hide"}`,onClick:re=>{re.stopPropagation(),v({view:"dm",data:{identifier:"dm",data:n}}),g.fetchAndSetProfile(n.username)},children:e("img",{src:J(n.avatar)})}),e("div",{className:"message-content",children:E.video?a("div",{className:"shared-video",onClick:()=>te(E.videoId),children:[e("video",{src:E.video,autoPlay:!1,controls:!1}),e(ke,{})]}):e("div",{className:"content",children:_e(E.content)})})]}):e(ee,{children:E.video?a("div",{className:"shared-video",onClick:()=>te(E.videoId),children:[e("video",{src:E.video,autoPlay:!1,controls:!1}),e(ke,{})]}):e("div",{className:"content",children:_e(E.content)})}),U[D+1]&&Z>6?e("div",{className:"date",children:Oe(E.timestamp)}):x!==j&&e("div",{className:"date",children:Oe(E.timestamp)})]},D)})]})}),e("div",{className:"dm-footer",children:a("div",{className:"input",children:[e(de,{type:"text",placeholder:i("APPS.DARKCHAT.INPUT_PLACEHOLDER"),ref:M,onChange:E=>N(E.target.value),onKeyDown:E=>{E.key==="Enter"&&V()}}),e("div",{className:"buttons",children:y.trim().length>0&&e("div",{className:"send",onClick:V,children:e(Qe,{})})})]})})]})}function bt(){return a("svg",{viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M7.56201 11C8.39038 11 9.06201 10.1045 9.06201 9C9.06201 7.89551 8.39038 7 7.56201 7C6.73364 7 6.06201 7.89551 6.06201 9C6.06201 10.1045 6.73364 11 7.56201 11Z",fill:"currentColor"}),e("path",{d:"M16.062 9C16.062 10.1045 15.3904 11 14.562 11C13.7336 11 13.062 10.1045 13.062 9C13.062 7.89551 13.7336 7 14.562 7C15.3904 7 16.062 7.89551 16.062 9Z",fill:"currentColor"}),e("path",{d:"M11.062 15.7891C12.562 15.7891 14.062 14.7373 14.062 13.6328C14.062 12.5283 12.062 12.5 11.062 12.5C10.062 12.5 8.06201 12.5283 8.06201 13.6328C8.06201 14.7373 9.56201 15.7891 11.062 15.7891Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.062 11.5C22.062 17.5752 17.1372 22.5 11.062 22.5C4.98682 22.5 0.0620117 17.5752 0.0620117 11.5C0.0620117 5.4248 4.98682 0.5 11.062 0.5C17.1372 0.5 22.062 5.4248 22.062 11.5ZM20.062 11.5C20.062 16.4705 16.0325 20.5 11.062 20.5C6.09155 20.5 2.06201 16.4705 2.06201 11.5C2.06201 6.52954 6.09155 2.5 11.062 2.5C16.0325 2.5 20.062 6.52954 20.062 11.5Z",fill:"currentColor"})]})}function yt({id:t,commentCount:d,username:f,close:g}){const{User:K}=s.useContext(W),[C]=K,[u,h]=s.useState([]),[l,r]=s.useState(""),[n,o]=s.useState(null),[v,L]=s.useState(0),[b,U]=s.useState(!1),[T,P]=s.useState(!1),S=s.useRef(null),M=s.useRef(null);s.useEffect(()=>{var w;se("TikTok")&&_("TikTok",{action:"getComments",page:0,data:{id:t,creator:f}},{success:!0,comments:(w=z.Videos.find(m=>m.id===t))==null?void 0:w.commentsData}).then(m=>{if(!(m!=null&&m.success))return c("warning",m.error);m.comments.length<15&&U(!0),h(m.comments)})},[]);const y=()=>{if(l.trim().length===0)return c("warning","Comment is empty");let w=n!=null&&n.isReplyToReply?`@${n.name} ${l}`:l;_("TikTok",{action:"postComment",data:{id:t,comment:w,replyTo:n==null?void 0:n.id}},{success:!0,id:Math.floor(Math.random()*100)}).then(m=>{if(!(m!=null&&m.success))return c("warning",m.error);h(n?A=>A.map(p=>p.id==n.id?{...p,reply_count:p!=null&&p.reply_count?p.reply_count+1:1,replies:[{id:m.id,username:C.username,avatar:C.avatar,comment:w,timestamp:new Date().getTime(),likes:0,liked:!1,verified:C.verified},...(p==null?void 0:p.replies)||[]]}:p):A=>[{id:m.id,username:C.username,avatar:C.avatar,comment:w,timestamp:new Date().getTime(),likes:0,liked:!1,verified:C.verified},...A]),r(""),M.current.style.height="auto",o(null)})},N=()=>{if(b||T)return c("warning","Already fetched everything or is fetching");let w=document.querySelector("#last");if(!w)return c("warning","No last element");!Te(w)&&(P(!0),_("TikTok",{action:"getComments",page:v+1,data:{id:t,creator:f}},null).then(A=>{if(!(A!=null&&A.success))return c("warning",A.error);A&&(A==null?void 0:A.comments.length)>0?(A.comments.length<15&&U(!0),h(p=>[...p,...A.comments]),P(!1)):(c("info","Fetched everything"),P(!1),U(!0))}),L(A=>A+1))};return s.useEffect(()=>{const w=m=>{const A=S.current;A.scrollTo({top:A.scrollTop+m.deltaY,behavior:"smooth"})};return S.current&&S.current.addEventListener("wheel",w),()=>{S.current&&S.current.removeEventListener("wheel",w)}},[S]),e("div",{className:"comments-container",onClick:()=>g(),children:a(ae.div,{...Ce,className:"comments-wrapper",onClick:w=>w.stopPropagation(),children:[a("div",{className:"comments-header",children:[e("div",{}),e("div",{className:"title",children:i("APPS.TIKTOK.COMMENTS_TITLE").format({count:d})}),e("div",{className:"close",children:e(Ke,{onClick:g})})]}),e("div",{className:"comments-body",ref:S,onScroll:N,children:u.map((w,m)=>e(Je,{comment:w,videoId:t,username:f,remove:()=>h(A=>A.filter(p=>p.id!=w.id)),setReplyTo:o,last:m==u.length-1},w.id))}),a("div",{className:"comments-footer",children:[e("img",{src:J(C.avatar)}),a("div",{className:"input",children:[e(de,{maxLength:300,ref:M,value:l,onChange:w=>{r(w.target.value);let m=w.target.scrollHeight;w.target.style.height=m+"px"},onKeyDown:w=>{w.key=="Enter"&&y(),w.key==" "&&r(m=>m+" ")},placeholder:n?i("APPS.TIKTOK.REPLY_TO").format({name:n.name}):i("APPS.TIKTOK.ADD_COMMENT")}),e("span",{onClick:()=>{q.Emoji.set({onSelect:w=>r(m=>m+w.emoji)})},children:e(bt,{})}),l.trim().length>0&&e("span",{children:e(Me,{onClick:y})})]})]})]})})}const Je=({videoId:t,username:d,comment:f,remove:g,setReplyTo:K,last:C})=>{var m,A,p;const{User:u}=s.useContext(W),[h,l]=u,[r,n]=s.useState(f),[o,v]=s.useState(r.likes),[L,b]=s.useState(r.liked===1),[U,T]=s.useState(r.creator_liked===1);s.useState(0),s.useState(!1),s.useState(!1);const[P,S]=s.useState(!1);s.useEffect(()=>{f&&n(f)},[f]);const M=()=>{_("TikTok",{action:"getComments",page:0,data:{id:t,replyTo:r.id,creator:d}},null).then(I=>{if(!(I!=null&&I.success))return c("warning",I.error);n(F=>({...F,replies:[...(F==null?void 0:F.replies)??[],...I.comments.filter(V=>F!=null&&F.replies?!F.replies.some(B=>B.id===V.id):!0)]})),S(!0)})},y=()=>{_("TikTok",{action:"toggleLikeComment",id:r.id,toggle:!L},{success:!0}).then(I=>{if(!(I!=null&&I.success))return c("warning",I.error);h.username===d&&T(F=>!F),b(F=>!F),n(F=>({...F,liked:!L}))})};ue("tiktok:updateCommentLikes",I=>{I.id===r.id&&v(F=>I.method==="add"?F+1:F-1)});let N=r.username!==h.username||d!==r.username||h.isAdmin;const w=et(I=>{if(I.stopPropagation(),I.preventDefault(),!N)return c("warning","You cannot click to this comment!");let F=[(h.isAdmin||h.username===r.username)&&{title:i("APPS.TIKTOK.DELETE_COMMENT"),color:"red",cb:()=>{_("TikTok",{action:"deleteComment",id:r.id,videoId:t}).then(V=>{if(!(V!=null&&V.success))return c("warning",V.error);g()})}}];q.ContextMenu.set({buttons:F})});return a("div",{className:"item",id:C?"last":"","data-clickable":N,"data-id":r.id,children:[a("div",{className:"comment-info",...w,children:[e("div",{className:"avatar",children:e("img",{src:J(r.avatar)})}),a("div",{className:"comment-data",children:[a("div",{className:"username",children:[r.username,r.verified&&e(fe,{}),r.username===d&&e("div",{className:"creator-badge",children:i("APPS.TIKTOK.CREATOR")})]}),e("div",{className:"comment",children:r.comment}),a("div",{className:"actions",children:[e("div",{className:"timestamp",children:Ne(r.timestamp)}),e("div",{className:"reply",onClick:()=>{K(()=>({id:r.replyTo??r.id,name:r.username,isReplyToReply:r.replyTo!==void 0}))},children:i("APPS.TIKTOK.REPLY")})]}),U&&e("div",{className:"creator-liked",children:i("APPS.TIKTOK.LIKED_BY_CREATOR")})]})]}),(r.reply_count>0||r.replies)&&a("div",{className:"replies",children:[(m=r.replies)==null?void 0:m.map(I=>e(Je,{videoId:t,username:d,comment:{...I,replyTo:r.id},remove:()=>{n(F=>{var V;return{...F,reply_count:F.reply_count-1,replies:(V=F.replies)==null?void 0:V.filter(B=>B.id!==I.id)}})},setReplyTo:K})),!P&&((A=r.replies)==null?void 0:A.length)!==r.reply_count&&a("div",{className:"view-replies",onClick:M,children:[i("APPS.TIKTOK.VIEW_REPLIES")," ",a("b",{children:["(",r!=null&&r.replies?r.reply_count-(((p=r.replies)==null?void 0:p.length)??0):r.reply_count,")"]})," ",e(Be,{})]})]}),a("div",{className:"likes","data-active":L,onClick:y,children:[L?e(Ee,{}):e(Ye,{}),X(o)]})]})};function Dt({className:t}){return a("svg",{className:t,width:"43",height:"36",viewBox:"0 0 43 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a("g",{filter:"url(#filter0_d_4_1154)",children:[e("path",{d:"M37.9988 19.0845C38.4285 18.6965 38.4399 18.0257 38.0236 17.6233L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 9.55921 26.2993 11.979 25.3314C13.3564 24.7805 15.6523 24.5297 17.9033 24.4891C20.0514 24.4504 22.0549 24.6041 23.0432 24.822V30.3392C23.0432 31.2058 24.0703 31.6622 24.7134 31.0814L37.9988 19.0845Z",fill:"currentColor"}),e("path",{d:"M33.906 17.6574C34.8657 16.5418 33.906 14.9506 33.906 14.9506L32.25 12.0469L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 13.2932 23.8672 16.2932 22.3672C18.7932 20.8672 23.0432 19.8672 23.0432 19.8672V25.8672C23.0432 26.7337 24.0703 27.1901 24.7134 26.6094L33.906 17.6574Z",fill:"currentColor"})]}),e("defs",{children:a("filter",{id:"filter0_d_4_1154",x:"0.25",y:"0.83",width:"42.0786",height:"34.8412",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1154"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1154",result:"shape"})]})})]})}function Le({data:t,active:d,preview:f}){var Y,ne,oe;const{User:g,Func:K,ShareComponent:C,GoBack:u}=s.useContext(W),h=he(ce.Settings),[l]=g,[r,n]=C,[o,v]=s.useState(t==null?void 0:t.liked),[L,b]=s.useState(t==null?void 0:t.saved),[U,T]=s.useState(t==null?void 0:t.viewed),[P,S]=s.useState(t==null?void 0:t.likes),[M,y]=s.useState(t==null?void 0:t.saves),[N,w]=s.useState(t==null?void 0:t.comments),[m,A]=s.useState(!1),p=s.useRef(null),I=s.useRef(null),F=s.useRef(0),[V,B]=s.useState(!1),[$,te]=s.useState(!1),E=he($e),D=he(Se),Z=he(Ae.LockScreenVisible);s.useEffect(()=>{var O,G;return d&&((O=t.music)!=null&&O.path&&x(),(G=t.metadata)!=null&&G.tts&&R()),()=>{p!=null&&p.current&&p.current.pause(),I!=null&&I.current&&I.current.pause(),U||_("TikTok",{action:"setViewed",id:t.id},!0).then(()=>{T(!0)})}},[d]),s.useEffect(()=>{var O,G,k;E!=null&&E.visible||!se("TikTok")||Z?(te(!0),p!=null&&p.current&&p.current.pause(),I!=null&&I.current&&I.current.pause()):((k=(G=(O=Se)==null?void 0:O.value)==null?void 0:G.active)==null?void 0:k.name)==="TikTok"&&(te(!1),p!=null&&p.current&&p.current.play().catch(()=>c("warning","TTS failed to play")),I!=null&&I.current&&I.current.play().catch(()=>c("warning","Music failed to play")))},[E==null?void 0:E.visible,D==null?void 0:D.active,Z]);const R=()=>{var G;if(!t.metadata.ttsUrl)return;p!=null&&p.current&&(p.current.pause(),p.current=null);const O=new Audio;O.src=t.metadata.ttsUrl,O.volume=(((G=h==null?void 0:h.sound)==null?void 0:G.volume)??.5)/2,O.play().catch(()=>c("warning","TTS failed to play")),p.current=O},x=()=>{var G,k;const O=new Audio;I!=null&&I.current&&(I.current.pause(),I.current=null),O.src=(G=t.music.path)!=null&&G.includes("http")?t.music.path:`./assets/sound/songs/${t.music.path}`,O.volume=t.music.volume*(((k=h==null?void 0:h.sound)==null?void 0:k.volume)??1),O.play().catch(()=>c("warning","Music failed to play")),I.current=O};s.useEffect(()=>{var O,G,k;(O=h==null?void 0:h.sound)!=null&&O.volume&&(I!=null&&I.current&&(I.current.volume=t.music.volume*(((G=h==null?void 0:h.sound)==null?void 0:G.volume)??1)),p!=null&&p.current&&(p.current.volume=(((k=h==null?void 0:h.sound)==null?void 0:k.volume)??.5)/2))},[(Y=h==null?void 0:h.sound)==null?void 0:Y.volume]);const j=()=>{f||_("TikTok",{action:"toggleLike",id:t.id,toggle:!o},{success:!0}).then(O=>{if(!O.success)return c("warning",O.error);v(!o)})},Q=()=>{f||-_("TikTok",{action:"toggleSave",id:t.id,toggle:!L},{success:!0}).then(O=>{if(!O.success)return c("warning",O.error);b(!L)})};ue("tiktok:updateLikes",O=>{if(O&&O.id===t.id)return S(G=>G+(O.method==="add"?1:-1))}),ue("tiktok:updateSaves",O=>{if(O&&O.id===t.id)return y(G=>G+(O.method==="add"?1:-1))}),ue("tiktok:updateComments",O=>{if(O&&O.id===t.id)return w(G=>(O.count=O.count??1,G+(O.method==="add"?O.count:-O.count)))});const re=O=>{if(O.detail===1)return te(!$);if(O.detail===2){if(!t.id)return;o||(j(),B(!0),setTimeout(()=>{B(!1)},1e3))}};return s.useEffect(()=>{const O=document.querySelector(".video video");O&&($?(O.pause(),p!=null&&p.current&&p.current.pause(),I!=null&&I.current&&I.current.pause(),c("info","paused everything")):(O.play().catch(()=>c("warning","Video failed to play")),p!=null&&p.current&&p.current.play().catch(()=>c("warning","TTS failed to play")),I!=null&&I.current&&I.current.play().catch(()=>c("warning","Music failed to play")),c("info","playing everything")))},[$]),a(ee,{children:[e(pe,{children:m&&!f&&e(yt,{id:t.id,username:t.username,commentCount:N,close:()=>A(!1)})}),a("div",{className:"video","data-active":d,onClick:re,children:[V&&e("div",{className:"popup-heart","data-visible":V,children:e(We,{})}),$&&e("div",{className:"paused",children:e(ke,{})}),e("video",{src:t.src,autoPlay:!0,loop:!0,muted:!d,onTimeUpdate:O=>{var G,k;d&&(O.target.currentTime<F.current&&((G=t==null?void 0:t.music)!=null&&G.path&&x(),(k=t==null?void 0:t.metadata)!=null&&k.ttsUrl&&(p.current.currentTime=0,p.current.play().catch(()=>c("warning","TTS failed to play")))),F.current=O.target.currentTime)}}),a("div",{className:"video-info",children:[a("div",{className:"user",children:[a("div",{className:"username",onClick:()=>{if(!f)return K.fetchAndSetProfile(t.username)},children:[t.name??`@${t.username}`,t.verified&&e(fe,{})]}),a("span",{children:[" • ",Ne(t.timestamp)]})]}),e("div",{className:"caption",children:t.caption}),((ne=t==null?void 0:t.music)==null?void 0:ne.title)&&a("div",{className:"song",children:[e(tt,{})," ",t.music.artist," - ",t.music.title]})]}),a("div",{className:"video-actions",children:[e("img",{className:"profile",src:J(t.avatar),onClick:O=>{if(O.stopPropagation(),!f)return K.fetchAndSetProfile(t.username)}}),a("div",{className:"action","data-active":o,onClick:O=>{O.stopPropagation(),j()},children:[e(Ee,{className:"like"}),X(P)]}),a("div",{className:"action",onClick:O=>{O.stopPropagation(),A(!0)},children:[e(je,{className:"comment"}),X(N)]}),a("div",{className:"action",onClick:O=>{O.stopPropagation(),Q()},"data-active":L,children:[e(He,{className:"save"}),X(M)]}),e("div",{className:"action",onClick:O=>{O.stopPropagation(),n({id:t.id,src:t.src,username:t.username,pinned:t.pinned})},children:(l==null?void 0:l.username)===t.username?e(nt,{className:"manage"}):a(ee,{children:[e(Dt,{className:"share"}),i("APPS.TIKTOK.SHARE")]})}),e("div",{className:"song",children:e("img",{src:((oe=t==null?void 0:t.music)==null?void 0:oe.cover)??"./assets/img/icons/music/unknown.png"})})]})]})]})}function ye(){var Z;const{View:t,Profile:d,FeedData:f,Func:g,GoBack:K}=s.useContext(W),C=he(ce.Settings),[u,h]=t,[l,r]=f,[n,o]=K,[v,L]=s.useState(0),[b,U]=s.useState(!1),[T,P]=s.useState(!1),[S,M]=s.useState("recent"),[y,N]=s.useState([]),[w,m]=s.useState(0),A=he(Se),p=s.useRef(null);s.useEffect(()=>{var R;if(se("TikTok")){if(u!=="feed"){I.current=!0;return}return L(0),P(!1),U(!1),N([]),(R=l==null?void 0:l.args)!=null&&R.single?(N([l.video]),m(0),V.current=0):_("TikTok",{action:"getVideos",page:0,data:{full:!0,type:S,...l==null?void 0:l.args}},z.Videos).then(x=>{if(!x)return c("warning","No videos found");x.length<5&&P(!0),l&&(l!=null&&l.video)&&x.unshift(l.video),m(0),V.current=0,N(x)}),()=>{r(null)}}},[u]),s.useEffect(()=>{if(se("TikTok")&&u==="feed")return setTimeout(()=>{ce.Styles.TextColor.set("#ffffff")},100),()=>{ce.Styles.TextColor.set(C.display.theme==="dark"?"#ffffff":"#000000"),ce.SoundManager.reset()}},[u,A==null?void 0:A.active]);const I=s.useRef(!0);s.useEffect(()=>{if(se("TikTok")&&!l){if(I.current){I.current=!1;return}N([]),_("TikTok",{action:"getVideos",page:0,data:{full:!0,type:S}},z.Videos).then(R=>{if(!R)return c("warning","No videos found");R.length<5&&P(!0),N(R),V.current=0,m(0)})}},[S,l]);const F=s.useRef(!1),V=s.useRef(0);s.useEffect(()=>{V.current=0,m(0),L(0),P(!1),U(!1)},[S]),s.useEffect(()=>{if(se("TikTok")){if(y.length===0)return c("info","No videos found");if(y.length===1||y.length-2===w){if(c("info","fetching more videos: "+JSON.stringify(l)),l!=null&&l.single)return;if(b||T)return c("info","Already fetching or fetched everything");U(!0),_("TikTok",{action:"getVideos",page:v+1,data:{full:!0,type:S,...l==null?void 0:l.args}},null).then(R=>{R&&R.length>0?(R.length<5&&P(!0),N(x=>[...x,...R]),U(!1)):(c("info","Fetched everything"),U(!1),P(!0)),L(x=>x+1)})}}},[w]),s.useEffect(()=>{if(!y||y.length===0)return;const R=()=>{if(!F.current)return requestAnimationFrame(R);F.current=!1;const Y=p.current,oe=document.querySelector(".video").getBoundingClientRect().height,O=V.current*oe;c("info",`Target scroll position: ${O}, current scroll position: ${Y.scrollTop}, snapIndex: ${V.current}`),Y.scrollTo({top:O,behavior:"smooth"}),m(V.current),requestAnimationFrame(R)};requestAnimationFrame(R);const x=Y=>{var ne,oe;Y.preventDefault(),!((oe=(ne=$e)==null?void 0:ne.value)!=null&&oe.visible)&&B(Y)},j=["ArrowUp","ArrowDown","Space"],Q=Y=>{var ne;(j.includes(Y.key)||j.includes(Y.code))&&!document.querySelector(".tiktok-content")&&((ne=A==null?void 0:A.active)==null?void 0:ne.name)==="TikTok"&&Y.preventDefault(),(Y.key==="ArrowUp"||Y.key==="ArrowDown")&&$(Y.key==="ArrowUp"?-1:1)},re=p.current;return re.addEventListener("wheel",x,{passive:!1}),window.addEventListener("keydown",Q),()=>{c("info","Removing event listeners (space button)"),re.removeEventListener("wheel",x),window.removeEventListener("keydown",Q)}},[y]);const B=R=>{if(R.preventDefault(),E())return;const j=R.deltaY<0?-1:1;$(j)},$=R=>{const j=y.length-1,Q=V.current+R;Q>=0&&Q<=j?(V.current=Q,F.current=!0,c("info","Scrolling to video: "+V.current)):Q<0?c("info","Top of the feed, trying to scroll up?"):c("info","Reached the bottom of the feed")},te=R=>{R.button===1&&R.preventDefault()},E=()=>!!document.querySelector(".comments-container");let D=u==="feed";return e("div",{className:"tiktok-feed",style:{visibility:D?"visible":"hidden"},children:a(ae.div,{className:"feed-wrapper",...Ze("right",u),children:[!l&&e("div",{className:"feed-header",children:a("div",{className:"feed-header-content",children:[e("div",{className:me("item",S=="following"&&"active"),onClick:()=>M("following"),children:i("APPS.TIKTOK.FOLLOWING")}),e("div",{className:me("item",S=="recent"&&"active"),onClick:()=>M("recent"),children:i("APPS.TIKTOK.FOR_YOU")}),e("div",{className:"border","data-direction":S==="recent"?"right":"left"})]})}),S==="following"&&y.length===0&&e("div",{className:"no-following",children:i("APPS.TIKTOK.NO_FOLLOWING_TITLE")}),(((Z=l==null?void 0:l.args)==null?void 0:Z.username)||(n==null?void 0:n.view))&&e(ge,{className:"go-back",onClick:()=>{r(null),n!=null&&n.view&&!(n!=null&&n.ignoreFeed)?(h(n.view),o(null)):g.fetchAndSetProfile(l.args.username)}}),e("div",{className:"videos",ref:p,onMouseDown:te,children:y==null?void 0:y.map((R,x)=>e(Le,{data:R,active:w===y.indexOf(R)&&D},x))})]})})}function Ft(){const{User:t,LoggedIn:d,View:f}=s.useContext(W),[g,K]=t,[C,u]=d,[h,l]=f,[r,n]=s.useState("login"),[o,v]=s.useState(null),[L,b]=s.useState(!0),U=()=>{if(L)return c("warning","Button is disabled");if(!o)return c("warning","No form data");let T=o==null?void 0:o.username.toLowerCase().replace(/\s/g,"");if(r==="signup"){let P=T.match(ve.value.UsernameFilter);if(!P||(P==null?void 0:P[0])!==T||T.length<3||T.length>15){c("warning","Username did not match regex"),q.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});return}}_("TikTok",{action:r,data:o}).then(P=>{var S,M,y,N,w,m;if(!P)return c("warning","Could not login, no response");if(P.success){let A={...P.data,username:((S=P.data)==null?void 0:S.username)??T,name:((M=P.data)==null?void 0:M.username)??(o==null?void 0:o.name),follower_count:((y=P.data)==null?void 0:y.follower_count)||0,following_count:((N=P.data)==null?void 0:N.following_count)||0,like_count:((w=P.data)==null?void 0:w.like_count)||0};K(A),u(!0),l("feed"),ie.APPS.TIKTOK.account.set(A)}else{if(P.error)return q.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i(`APPS.INSTAGRAM.${(m=P.error)==null?void 0:m.toUpperCase()}`),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});c("info",`Could not login, ${P.error}`)}})};return s.useEffect(()=>{var T,P;o&&b(r==="login"?!o.username||!o.password:!o.name||!o.username&&((T=o.username)==null?void 0:T.length)<3||!o.password&&((P=o.password)==null?void 0:P.length)<3)},[o]),a("div",{className:"login-container",children:[a("div",{className:"login-header",children:[e("div",{className:"title",children:r==="login"?i("APPS.TIKTOK.LOGIN_TITLE"):i("APPS.TIKTOK.SIGNUP_TITLE")}),e("div",{className:"subtitle",children:r==="login"?i("APPS.TIKTOK.LOGIN_SUBTITLE"):i("APPS.TIKTOK.SIGNUP_SUBTITLE")})]}),a("div",{className:"login-body",children:[r==="signup"&&e(de,{placeholder:i("APPS.TIKTOK.NAME"),onChange:T=>{T.target.value.length>30||v({...o,name:T.target.value})}}),e(de,{placeholder:i("APPS.TIKTOK.USERNAME"),onChange:T=>{T.target.value.length>20||v({...o,username:T.target.value.toLowerCase()})}}),e(de,{type:"password",placeholder:i("APPS.TIKTOK.PASSWORD"),onChange:T=>{T.target.value.length>50||v({...o,password:T.target.value})}}),e("div",{className:"login-button","data-disabled":L,onClick:U,children:r==="login"?i("APPS.TIKTOK.LOGIN"):i("APPS.TIKTOK.SIGNUP")})]}),e("div",{className:"login-footer",children:r==="login"?a(ee,{children:[i("APPS.TIKTOK.NO_ACCOUNT")," ",e("span",{onClick:()=>n("signup"),children:i("APPS.TIKTOK.SIGNUP")})]}):a(ee,{children:[i("APPS.TIKTOK.ALREADY_ACCOUNT")," ",e("span",{onClick:()=>n("login"),children:i("APPS.TIKTOK.LOGIN")})]})})]})}function Vt(){const{User:t,Profile:d,View:f,LoggedIn:g,UserPanel:K,Func:C,GoBack:u,Dm:h}=s.useContext(W),[l,r]=t,[n,o]=d,[v,L]=g,[b,U]=K,[T,P]=u,[S,M]=h,[y,N]=f,[w,m]=s.useState([]),[A,p]=s.useState(!1),[I,F]=s.useState("recent"),[V,B]=s.useState(0),[$,te]=s.useState(!1),[E,D]=s.useState(!1),[Z,R]=s.useState((n==null?void 0:n.follower_count)||0),[x,j]=s.useState((n==null?void 0:n.following_count)||0),Q=[{value:"recent",icon:e(it,{})},{value:"liked",icon:n!=null&&n.show_likes?e(We,{}):e(st,{})},{value:"saved",hidden:(l==null?void 0:l.username)!==(n==null?void 0:n.username),icon:e(He,{})}],re=[{label:i("APPS.TIKTOK.FOLLOWING"),name:"following",value:n==null?void 0:n.following_count},{label:i("APPS.TIKTOK.FOLLOWERS"),name:"followers",value:n==null?void 0:n.follower_count},{label:i("APPS.TIKTOK.LIKES"),value:n==null?void 0:n.like_count}];s.useEffect(()=>{se("TikTok")&&n&&(B(0),R((n==null?void 0:n.follower_count)||0),j((n==null?void 0:n.following_count)||0),m([]),!(I==="liked"&&!(n!=null&&n.show_likes)&&l.username!==n.username)&&_("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:I},page:0},z.Videos.filter(k=>k.username===n.username)).then(k=>{if(!k)return c("warning","Failed to get videos");m(k)}))},[I,n==null?void 0:n.username]);const Y=()=>{if(E||$)return c("warning","Already fetched everything or is fetching");let k=document.querySelector("#last");if(!k)return c("warning","No last element");!Te(k)&&(te(!0),_("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:I},page:V+1},null).then(le=>{le&&le.length>0?(m(Ie=>[...Ie,...le]),te(!1)):(c("info","Fetched everything"),te(!1),D(!0))}),B(le=>le+1))},ne=k=>{_("TikTok",{action:"toggleFollow",data:{username:n.username,follow:k}},{success:!0}).then(H=>{if(!H||!(H!=null&&H.success))return c("warning","Failed to toggle follow");if(H.error)return c("error",H.error);c("info",`Toggling follow to ${k}`),o({...n,isFollowing:k})})};ue("tiktok:updateFollowers",k=>{if(!k||k.username!==n.username)return;let H=Z+(k.method==="add"?1:-1);o({...n,follower_count:H}),R(H)}),ue("tiktok:updateFollowing",k=>{if(!k||k.username!==n.username)return;let H=x+(k.method==="add"?1:-1);o({...n,following_count:H}),j(H)});const oe=()=>{l.username===n.username&&_("AccountSwitcher",{action:"getAccounts",app:"TikTok"}).then(k=>{var Ie;if(!k)return c("info","No accounts found");let H=l.isAdmin,le=(Ie=k==null?void 0:k.filter(Pe=>Pe!==l.username))==null?void 0:Ie.map(Pe=>({title:Pe,cb:()=>{Pe!==l.username&&_("AccountSwitcher",{action:"switch",app:"TikTok",account:Pe}).then(()=>{_("TikTok",{action:"isLoggedIn"}).then(we=>{we?(ie.APPS.TIKTOK.account.set(we),r({...we,isAdmin:H}),N("feed"),L(!0)):ie.APPS.TIKTOK.account.set(null)})})}}));q.ContextMenu.set({buttons:[...le,{title:i("APPS.TIKTOK.ADD_ACCOUNT_TITLE"),cb:()=>{L(!1)}}]})})},O=k=>{r(k),o(k),p(!1)},G=()=>{l.username!==n.username&&_("TikTok",{action:"getChannelId",username:n.username}).then(k=>{M({id:k.id,username:n.username,name:n.name,avatar:n.avatar,follower_count:n.follower_count,following_count:n.following_count,isFollowing:n.isFollowing}),P({view:"profile",data:{identifier:"profile",data:n}}),N("dm"),o(null)})};return n?a(ee,{children:[e(pe,{children:A&&e(Mt,{close:k=>O(k)})}),a(ae.div,{className:"profile-container",children:[a("div",{className:"profile-header",children:[n.username===l.username?e("span",{}):e("div",{children:e(ge,{className:"go-back",onClick:()=>{var k,H;if(T!=null&&T.view){if(T!=null&&T.data)switch((k=T==null?void 0:T.data)==null?void 0:k.identifier){case"dm":M((H=T==null?void 0:T.data)==null?void 0:H.data),N("dm");break;default:N("feed"),o(null)}else N(T==null?void 0:T.view);P(null)}else N("feed");o(null)}})}),a("div",{className:"name",onClick:oe,children:[n.name,l.username===n.username&&e(Be,{})]}),e("span",{})]}),a("div",{className:"profile-info",onScroll:Y,children:[e("div",{className:"avatar",children:e("img",{src:J(n.avatar)})}),a("div",{className:"username",children:["@",n.username,n.verified&&e(fe,{})]}),e("div",{className:"stats",children:re.map((k,H)=>{let le={followers:Z,following:x};return a("div",{className:"item","data-cursor":k.name!==void 0,onClick:()=>{k.name&&U({value:k.name,username:n.username,following:x,followers:Z})},children:[e("div",{className:"value",children:X(le[k.name]??n.like_count)}),e("div",{className:"label",children:k.label})]},H)})}),a("div",{className:"actions",children:[l.username===n.username?e("div",{className:"button big",onClick:()=>p(!0),children:i("APPS.TIKTOK.EDIT_PROFILE")}):e(ee,{children:n.isFollowing?a(ee,{children:[e("div",{className:me("button","big"),onClick:G,children:i("APPS.TIKTOK.MESSAGE")}),e("div",{className:"button",onClick:()=>{q.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>ne(!1)}]})},children:e(at,{})})]}):a(ee,{children:[e("div",{className:"button follow",onClick:()=>ne(!0),children:i("APPS.TIKTOK.FOLLOW")}),e("div",{className:"button",onClick:G,children:e(xe,{})})]})}),n.instagram&&e("div",{className:"button instapic",onClick:()=>{Se.patch({active:{name:"Instagram",data:{username:n.instagram,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/instagram/icon.svg"})}),n.twitter&&e("div",{className:"button birdy",onClick:()=>{Se.patch({active:{name:"Twitter",data:{username:n.twitter,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/twitter/logo.png"})})]}),e("div",{className:"bio",children:n.bio}),a("div",{className:"profile-videos",children:[e("div",{className:"navbar",children:Q.filter(k=>!k.hidden).map(k=>e("div",{className:me("item",I===k.value&&"active"),onClick:()=>F(k.value),children:k.icon}))}),a("div",{className:"feed",children:[I==="liked"&&!(n!=null&&n.show_likes)&&l.username!==n.username&&a("div",{className:"private",children:[e("div",{className:"title",children:i("APPS.TIKTOK.LIKED_HIDDEN_TITLE")}),e("div",{className:"subtitle",children:i("APPS.TIKTOK.LIKED_HIDDEN_SUBTITLE").format({name:n.username})})]}),w.map((k,H)=>e(Rt,{data:k,last:H===w.length-1,onClick:()=>{P({...T,ignoreFeed:!0}),C.fetchAndSetVideo(k.id,{username:n.username,id:k.id,type:I})}}))]})]})]})]})]}):null}const Rt=({data:t,last:d,onClick:f})=>a("div",{className:"item",onClick:f,id:d?"last":"",children:[e("video",{src:t.src,loop:!0,onMouseEnter:g=>g.currentTarget.play().catch(()=>c("warning","Failed to play video")),onMouseLeave:g=>g.currentTarget.pause(),muted:!0}),t.pinned===1&&e("div",{className:"pinned",children:"Pinned"}),a("div",{className:"views",children:[e(Ve,{}),X(t.views)]})]}),Mt=t=>{var v,L,b,U,T,P;const{User:d,LoggedIn:f,View:g}=s.useContext(W),[K,C]=d,[u,h]=f,[l,r]=s.useState(null),n=["instagram","twitter"];s.useEffect(()=>{r({name:K.name,bio:K.bio,avatar:K.avatar,instagram:K.instagram,twitter:K.twitter,show_likes:K.show_likes})},[]);const o=()=>{_("TikTok",{action:"updateProfile",data:l},{success:!0}).then(S=>{if(!S)return c("warning","No response from server");if(S.success)ie.APPS.TIKTOK.account.set({...K,...l}),t.close({...K,...l});else switch(c("error",S.error),S.error){case"invalid_twitter":q.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.TWITTER.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.TWITTER.TITLE".toLocaleLowerCase())}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]});break;case"invalid_instagram":q.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.INSTAGRAM.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.INSTAGRAM.TITLE").toLocaleLowerCase()}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]})}})};return a(ae.div,{...Ce,className:"edit-profile-container",children:[a("div",{className:"edit-profile-header",children:[e("div",{children:e(ge,{onClick:o})}),e("div",{className:"title",children:i("APPS.TIKTOK.EDIT_PROFILE")}),e("span",{})]}),a("div",{className:"edit-profile-content",children:[a("div",{className:"avatar",children:[a("div",{className:"image",onClick:()=>{var S,M,y;return q.Gallery.set({allowExternal:(y=(M=(S=ve)==null?void 0:S.value)==null?void 0:M.AllowExternal)==null?void 0:y.Trendy,onSelect:N=>r({...l,avatar:N.src})})},children:[e("img",{src:J(l==null?void 0:l.avatar)}),e(ot,{})]}),i("APPS.TIKTOK.CHANGE_PHOTO")]}),a("div",{className:"form",children:[a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.NAME")}),e(de,{type:"text",defaultValue:l==null?void 0:l.name,onChange:S=>{S.target.value.length<=30&&r({...l,name:S.target.value})}})]}),a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.USERNAME")}),e(de,{type:"text",disabled:!0,value:K.username})]}),a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.BIO")}),e(ze,{placeholder:i("APPS.TIKTOK.ADD_TO_YOUR_PROFILE"),defaultValue:l==null?void 0:l.bio,onChange:S=>{S.target.value.length<=150&&r({...l,bio:S.target.value})}})]}),e("div",{className:"break"}),n.map((S,M)=>a("div",{className:"item",children:[e("div",{className:"label",children:Ue(S)}),e("div",{className:"value",onClick:()=>{l!=null&&l[S]?q.PopUp.set({title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.TITLE").format({name:i(`APPS.${S.toUpperCase()}.TITLE`)}),description:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.DESCRIPTION").format({name:i(`APPS.${S.toUpperCase()}.TITLE`)}),buttons:[{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.CANCEL")},{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.PROCEED"),color:"red",cb:()=>{r({...l,[S]:null})}}]}):_("AccountSwitcher",{action:"getAccounts",app:Ue(S)}).then(y=>{y||c("info","No accounts found");let N=(y==null?void 0:y.map(w=>({title:w,cb:()=>{r({...l,[S]:w})}})))??[];q.ContextMenu.set({buttons:[...N]})})},children:l!=null&&l[S]?`@${l==null?void 0:l[S]}`:i("APPS.TIKTOK.ADD_ACCOUNT").format({name:i(`APPS.${S.toUpperCase()}.TITLE`)})})]},M)),e("div",{className:"break"}),a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.SHOW_LIKES")}),e(It,{checked:l==null?void 0:l.show_likes,onChange:()=>{r({...l,show_likes:!(l!=null&&l.show_likes)})}})]})]}),a("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{q.PopUp.set({title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{_("TikTok",{action:"logout"},!0).then(S=>{if(!S)return c("warning","Failed to logout");ie.APPS.TIKTOK.account.set(null),h(!1)})}}]})},children:i("APPS.TIKTOK.LOGOUT")}),((b=(L=(v=ve)==null?void 0:v.value)==null?void 0:L.ChangePassword)==null?void 0:b.Trendy)&&e("div",{className:"button red",onClick:()=>lt("TikTok",()=>{}),children:i("APPS.TIKTOK.CHANGE_PASSWORD")}),((P=(T=(U=ve)==null?void 0:U.value)==null?void 0:T.DeleteAccount)==null?void 0:P.Trendy)&&e("div",{className:"button red",onClick:()=>{rt("TikTok",()=>{h(null),C(null),ie.APPS.TIKTOK.account.set(null)})},children:i("APPS.TIKTOK.DELETE_ACCOUNT")})]})]})]})};function xt(){var T,P,S,M,y,N,w;const{View:t,User:d}=s.useContext(W),[f]=d,[g,K]=t,[C,u]=s.useState(0),[h,l]=s.useState(!1),[r,n]=s.useState("en_us_001"),[o,v]=s.useState({src:null,caption:null,music:{title:null,artist:null,path:null,cover:null,volume:.25},metadata:{tts:null,ttsUrl:null,ttsVoice:null}}),[L,b]=s.useState(!1);s.useEffect(()=>{b(o.src&&o.caption)},[o]),s.useEffect(()=>{var m,A,p;switch(C){case 0:q.Gallery.set({allowExternal:(p=(A=(m=ve)==null?void 0:m.value)==null?void 0:A.AllowExternal)==null?void 0:p.Trendy,includeVideos:!0,includeImages:!1,onSelect:I=>{v({...o,src:I.src}),u(F=>F+1)}});break}},[C]);const U=()=>{var m,A;_("TikTok",{action:"uploadVideo",data:{src:o.src,caption:o.caption,metadata:((m=o.metadata)==null?void 0:m.ttsUrl)&&o.metadata,music:((A=o.music)==null?void 0:A.path)&&{path:o.music.path,volume:o.music.volume}}},{success:!0}).then(p=>{if(!p||p.error)return c("warning","Failed to upload video, error: "+p.error);if(!p.success)return c("warning","Failed to upload video");K("feed")})};return a("div",{className:"upload-container",children:[h&&e("div",{className:"loading",children:e(qe,{size:40,lineWeight:5,speed:2,color:((P=(T=ce.Settings)==null?void 0:T.value)==null?void 0:P.display.theme)==="dark"?"#fff":"#000"})}),C!==0&&a(ee,{children:[a("div",{className:"upload-header",children:[e("div",{className:"cancel",onClick:()=>{if(C===2)return u(m=>m-1);if(C===1)return K("feed")},children:C===2?i("APPS.TIKTOK.GO_BACK"):i("APPS.TIKTOK.CANCEL")}),e("div",{className:"title",children:i("APPS.TIKTOK.UPLOAD_VIDEO")}),e("div",{className:"next","data-disabled":!L,onClick:()=>{if(L){if(C===2)return U();o!=null&&o.metadata.tts?(l(!0),Wt(o.metadata.tts,r).then(m=>{l(!1),v({...o,metadata:{...o.metadata,ttsUrl:m}}),u(A=>A+1)}).catch(m=>{l(!1),q.PopUp.set({title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.TITLE"),description:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.CANCEL")},{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.PROCEED"),cb:()=>{u(A=>A+1)}}]})})):u(m=>m+1)}},children:C===1?i("APPS.TIKTOK.PREVIEW"):i("APPS.TIKTOK.SHARE")})]}),a("div",{className:"upload-body",children:[C===1&&a(ee,{children:[e("div",{className:"video-placeholder",children:e("video",{src:o.src,controls:!1,autoPlay:!0,loop:!0,muted:!0})}),a("div",{className:"form",children:[a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.CAPTION")}),e(de,{defaultValue:o.caption,placeholder:i("APPS.TIKTOK.CAPTION_PLACEHOLDER"),type:"text",maxLength:100,onChange:m=>{if(m.target.value.length<=100)return v({...o,caption:m.target.value})}})]}),a("div",{className:"item",children:[a("div",{className:"label",children:[i("APPS.TIKTOK.TTS")," ",a("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),e(ze,{defaultValue:(S=o==null?void 0:o.metadata)==null?void 0:S.tts,placeholder:i("APPS.TIKTOK.TTS_PLACEHOLDER"),maxLength:300,onChange:m=>{if(m.target.value.length<=300)return v({...o,metadata:{...o.metadata,tts:m.target.value}})}}),((M=o==null?void 0:o.metadata)==null?void 0:M.tts)&&e("select",{onChange:m=>n(m.target.value),children:(N=(y=ve)==null?void 0:y.value.TikTokTTS)==null?void 0:N.map(m=>e("option",{value:m[1],selected:m[1]===r,children:m[0]}))})]}),a("div",{className:"item",children:[a("div",{className:"label",children:[i("APPS.TIKTOK.MUSIC")," ",a("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),a("div",{className:"button",onClick:()=>q.MusicSelector.set({onSelect:m=>v({...o,music:{...o.music,...m}})}),children:[o.music?o.music.title:i("APPS.TIKTOK.SELECT_MUSIC"),e(Ke,{onClick:m=>{m.stopPropagation(),v({...o,music:null})}})]}),((w=o.music)==null?void 0:w.title)&&a("div",{className:"slider",children:[e(ct,{}),e(Nt,{min:0,max:.5,step:.025,value:o.music.volume??.25,onChange:m=>v({...o,music:{...o.music,volume:m}})}),e(ut,{})]})]})]})]}),C===2&&e("div",{className:"preview",children:e(Le,{data:{...o,timestamp:new Date().getTime(),id:"preview",likes:0,comments:0,saves:0,username:f.username,avatar:J(f.avatar),verified:f.verified,music:o.music},active:!0,preview:!0})})]})]})]})}const Gt=async(t,d,f)=>{const g=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({text:d,voice:f})});if(!g.ok)throw new Error(`Fetch error: ${g.status} ${g.statusText}`);return g.json()},Bt=async(t,d)=>{const f=await Gt("https://tiktok-tts.weilnet.workers.dev/api/generation",t,d);if(f.success&&f.data)return f.data;throw f},Wt=async(t,d)=>{try{const f=await Bt(t,d),K=await(await fetch(`data:application/octet-stream;base64,${f}`)).arrayBuffer(),C=new Uint8Array(K),u=new Blob([C],{type:"audio/mp3"});return await dt("Audio",u)}catch(f){throw f}};function Ht(){const{View:t,User:d,Profile:f,FeedData:g}=s.useContext(W),[K,C]=d,[u,h]=t,[l,r]=f,[n,o]=g,v=[{value:"feed",label:i("APPS.TIKTOK.HOME"),activeIcon:e(mt,{}),icon:e(ft,{}),cb:()=>{h("feed"),o(null)}},{value:"discover",label:i("APPS.TIKTOK.DISCOVER"),activeIcon:e(ht,{}),icon:e(vt,{})},{value:"upload",label:i("APPS.TIKTOK.UPLOAD"),activeIcon:e(be,{}),icon:e(be,{})},{value:"inbox",label:i("APPS.TIKTOK.INBOX"),activeIcon:e(Tt,{}),icon:e(Ge,{})},{value:"profile",label:i("APPS.TIKTOK.PROFILE"),activeIcon:e(gt,{}),icon:e(Pt,{}),cb:()=>{r(K),h("profile")}}];return e("div",{className:"tiktok-footer","data-feed":u==="feed",children:v.map((L,b)=>{let U=u===L.value;return a("div",{className:"item","data-active":U,onClick:()=>L.cb?L.cb():h(L.value),children:[U?L.activeIcon:L.icon,L.label]},b)})})}function $t(){const{User:t,ShareComponent:d,View:f}=s.useContext(W),[g]=t,[K,C]=f,[u,h]=d,[l,r]=s.useState([]);s.useState(!1);const[n,o]=s.useState(u==null?void 0:u.pinned);return s.useEffect(()=>{_("TikTok",{action:"getRecentMessages"},{success:!0,channels:z.Messages}).then(v=>{if(!(v!=null&&v.success))return c("warning",v.error);r(v.channels.sort((L,b)=>b.timestamp-L.timestamp))})},[]),e("div",{className:"share-container",onClick:()=>h(null),children:a(ae.div,{...Ce,className:"share-wrapper",onClick:v=>v.stopPropagation(),children:[e("div",{className:"share-header",children:i("APPS.TIKTOK.SHARE_TITLE")}),a("div",{className:"share-body",children:[e("div",{className:"friends",children:l.map(v=>e(Zt,{data:{username:v.username,name:v.name,avatar:v.avatar,verified:v.verified}}))}),a("div",{className:"options",children:[a("div",{className:"item",children:[e(pt,{}),i("APPS.TIKTOK.REPORT")]}),g.username===(u==null?void 0:u.username)&&a(ee,{children:[a("div",{className:"item",onClick:()=>{q.PopUp.set({title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.PIN_VIDEO_POPUP.DESCRIPTION").format({action:n?i("APPS.TIKTOK.UNPIN"):i("APPS.TIKTOK.PIN")}),buttons:[{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.PROCEED"),color:n?"red":null,cb:()=>{_("TikTok",{action:"togglePinnedVideo",id:u==null?void 0:u.id,toggle:!n},{success:!0}).then(v=>{if(v!=null&&v.success||c("warning",v.error),v!=null&&v.error&&v.error==="max_pinned")return q.PopUp.set({title:i("APPS.TIKTOK.MAX_PINNED_TITLE"),description:i("APPS.TIKTOK.MAX_PINNED_DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.OK")}]});o(!n)})}}]})},children:[e(St,{}),n?i("APPS.TIKTOK.UNPIN_VIDEO"):i("APPS.TIKTOK.PIN_VIDEO")]}),a("div",{className:"item",onClick:()=>{q.PopUp.set({title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.PROCEED"),color:"red",cb:()=>{_("TikTok",{action:"deleteVideo",id:u==null?void 0:u.id},{success:!0}).then(v=>{v!=null&&v.success||c("warning",v.error),h(null),C("profile")})}}]})},children:[e(Ct,{}),i("APPS.TIKTOK.DELETE")]})]})]})]}),e("div",{className:"share-footer",onClick:()=>h(null),children:i("APPS.TIKTOK.CANCEL")})]})})}const Zt=t=>{const{ShareComponent:d}=s.useContext(W),[f]=d,[g,K]=s.useState(!1);return a("div",{className:"item","data-sent":g,onClick:()=>{if(g)return c("warning","You have already sent this video to this user!");_("TikTok",{action:"sendMessage",data:{username:t.data.username,content:`<!SHARED-VIDEO-URL="${f.src}"ID="${f.id}"!>`}},{success:!0}).then(u=>{if(!(u!=null&&u.success))return c("warning",u.error);c("info","Successfully sent video to user!"),K(!0)})},children:[e("img",{src:J(t.data.avatar)}),e("div",{className:"name",children:t.data.name}),g&&e(De,{className:"checkmark"})]})};function qt(){const{UserPanel:t}=s.useContext(W),[d,f]=t,[g,K]=s.useState([]),[C,u]=s.useState(d==null?void 0:d.value),[h,l]=s.useState(0),[r,n]=s.useState(!1),[o,v]=s.useState(!1),L={following:"getFollowing",followers:"getFollowers"},b={following:i("APPS.TIKTOK.FOLLOWING"),followers:i("APPS.TIKTOK.FOLLOWERS")},U=(P,S)=>{var y,N;return(P===i("APPS.TIKTOK.FOLLOWING")?(y=z.Accounts[S])==null?void 0:y.following:((N=z.Accounts[S])==null?void 0:N.followers)??[]).map(w=>z.Accounts[w])};s.useEffect(()=>{!d||!(d!=null&&d.value)||C&&_("TikTok",{action:L[C],username:d.username,page:0},U(L[C],d.username)).then(P=>{if(!P)return c("warning","No data returned from tiktok event");K(P)})},[C]);const T=()=>{if(r||o)return;!Te(document.querySelector("#last"))&&(v(!0),_("TikTok",{action:L[d.value],username:d.username,page:h+1},null).then(S=>{S&&S.length>0?(K([...g,...S]),v(!1)):n(!0)}),l(S=>S+1))};return a(ae.div,{...Ce,className:"userpanel-container",children:[a("div",{className:"userpanel-header",children:[e("div",{onClick:()=>f(null),children:e(ge,{})}),e("div",{className:"title",children:d==null?void 0:d.username}),e("div",{})]}),e("div",{className:"userpanel-selector",children:["following","followers"].map(P=>a("div",{className:"item","data-active":C===P,onClick:()=>u(P),children:[b[P]," ",X(d==null?void 0:d[P])??0]}))}),e("div",{className:"userpanel-content",onScroll:T,children:g.map((P,S)=>e(zt,{data:P,last:S===g.length-1}))})]})}const zt=({data:t,last:d})=>{const{Func:f,UserPanel:g}=s.useContext(W),[K,C]=g,[u,h]=s.useState(t.isFollowing),l=r=>{_("TikTok",{action:"toggleFollow",data:{username:t.username,follow:r}}).then(n=>{if(!n||!(n!=null&&n.success))return c("warning","Failed to toggle follow");if(n.error)return c("error",n.error);h(r)})};return a("div",{className:"item",id:d?"last":"",onClick:()=>{f.fetchAndSetProfile(t.username),C(null)},children:[a("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:J(t.avatar)})}),a("div",{className:"user",children:[a("div",{className:"name",children:[t.name," ",t.verified&&e(fe,{})]}),e("div",{className:"username",children:t.username})]})]}),e("div",{className:"action",children:e("div",{className:me("button",u?"following":"follow"),onClick:r=>{r.stopPropagation(),u?q.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>l(!1)}]}):l(!0)},children:u?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})};const W=s.createContext(null);function Qt(){const t=he(ce.Settings),[d,f]=s.useState(null),[g,K]=s.useState("feed"),[C,u]=s.useState(null),[h,l]=s.useState(null),[r,n]=s.useState(null),[o,v]=s.useState(null),[L,b]=s.useState(null),[U,T]=s.useState(null),[P,S]=s.useState(!1),[M,y]=s.useState(null),[N,w]=s.useState(!0),[m,A]=s.useState(!0);s.useEffect(()=>{_("isAdmin",null,!1).then(V=>{if(ie.APPS.TIKTOK.account.value){f({...ie.APPS.TIKTOK.account.value,isAdmin:V}),S(!0),w(!1);return}else if(ie.APPS.TIKTOK.account.value===!1)return w(!1);_("TikTok",{action:"isLoggedIn"},z.Account).then(B=>{B?(ie.APPS.TIKTOK.account.set(B),f({...B,isAdmin:V}),S(!0),w(!1)):(ie.APPS.TIKTOK.account.set(!1),w(!1))})})},[]),s.useEffect(()=>{g==="feed"&&C||g==="profile"&&(C==null?void 0:C.username)!==d.username?A(!1):A(!0)},[C]);const p={profile:e(Vt,{}),video:e(Le,{}),discover:e(wt,{}),inbox:e(Lt,{}),messages:e(kt,{}),dm:e(Ut,{}),upload:e(xt,{}),feed:e(ye,{})},I=V=>{if(!V)return c("warning","Couldn't fetch profile (no username provided)");c("info",`Fetching profile ${V}`),_("TikTok",{action:"getProfile",username:V},z.Accounts.find(B=>B.username===V)).then(B=>{if(!B)return c("warning","Couldn't fetch profile");u(B),K("profile")})},F=(V,B)=>{_("TikTok",{action:"getVideo",id:V},{video:z.Videos.find($=>$.id===V)}).then($=>{if(!$)return c("warning","Couldn't fetch video");if($.error)return c("warning",$.error);if(!($!=null&&$.video))return c("warning","Couldn't fetch video");b({video:$.video,args:B}),K("feed")})};return e(W.Provider,{value:{User:[d,f],View:[g,K],Profile:[C,u],LoggedIn:[P,S],FeedData:[L,b],UserPanel:[r,n],ShareComponent:[o,v],GoBack:[U,T],Video:[M,y],Dm:[h,l],Func:{fetchAndSetProfile:I,fetchAndSetVideo:F}},children:N||t!=null&&t.airplaneMode?e("div",{className:"loading",children:e(qe,{size:40,lineWeight:5,speed:2,color:(t==null?void 0:t.display.theme)==="dark"?"#ffffff":"#000000"})}):e("div",{className:"tiktok-container","data-infeed":g==="feed",children:P===!0?a(ee,{children:[a("div",{className:"tiktok-wrapper","data-profile":!m,children:[e(ye,{}),g!=="feed"&&e(ae.div,{...Ze(g=="discover"||g=="messages"?"right":"left",g),className:"tiktok-content",children:p==null?void 0:p[g]}),e(pe,{children:r&&e(qt,{})})]}),e(pe,{children:o&&e($t,{})}),m&&e(Ht,{})]}):e(Ft,{})})})}const J=t=>{var d;return t??`./assets/img/avatar-placeholder-${(d=ce.Settings.value)==null?void 0:d.display.theme}.svg`},Ne=t=>{if(!t)return;const d=new Date(t),g=new Date().getTime()-d.getTime(),K=Math.floor(g/(1e3*3600*24)),C=Math.floor(g/(1e3*3600)),u=Math.floor(g/(1e3*60)),h=Math.floor(g/1e3);return K>0?`${d.getMonth()+1}-${d.getDate()}`:C>0?`${C}h`:u>0?`${u}m`:h>0?`${h}s`:i("NOW")};function X(t){if(t<1e4)return t;if(t>=1e4&&t<1e6)return`${(t/1e3).toFixed(1)}K`;if(t>=1e6&&t<1e9)return`${(t/1e6).toFixed(1)}M`}export{W as TikTokContext,Qt as default,Ne as formatDate,X as formatNumber,J as getAvatar};
