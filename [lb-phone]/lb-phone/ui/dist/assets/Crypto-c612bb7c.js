import{r as m,j as v,a as c,N as w,m as f,u as _,E as x,bX as B,b as g,q as L,p as N,_ as k,aa as Y,t as y,L as t,c8 as F,c9 as $,w as D,ca as j,cb as M,C as T,f as H,P as q,A as z}from"./index-594e1857.js";function X({children:e,text:s}){const[h,S]=m.useState(!1);return v("div",{className:"tooltip-wrapper",onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:[e,c(w,{children:h&&c(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:c("div",{dangerouslySetInnerHTML:{__html:s}})})})]})}const b=m.createContext(null);function K(){var r;const e=_(g),s=_(q.Settings),h=_(z),[S,O]=m.useState(0),[E,R]=m.useState([]),[a,l]=m.useState(""),[A,d]=m.useState("0"),[n,u]=m.useState(s==null?void 0:s.streamerMode);m.useEffect(()=>{x("Crypto")&&(B()&&fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&sparkline=true&order=market_cap_desc&per_page=100&page=1&ids=${g.value.Crypto.Coins.join(",")}`).then(o=>o.json()).then(o=>{R(o.map(i=>{var P;return{id:i.id,name:i.name,symbol:i.symbol,image:i.image,current_price:i.current_price,prices:(P=i.sparkline_in_7d)==null?void 0:P.price,change_24h:i.price_change_percentage_24h}}))}).catch(o=>L("error",o)),N("Crypto",{action:"get"}).then(o=>{if(!o)return L("warning","No data received from Crypto NUI event");R(o)}))},[h==null?void 0:h.active]),k("crypto:updateCoins",o=>{if(!o)return L("warning","No data received from the update Crypto NUI event");R(o)}),m.useEffect(()=>O(E.reduce((o,i)=>o+(i.owned??0)*i.current_price,0)),[E]),m.useEffect(()=>{d(n?Y("âˆ—".repeat(y(S,2).toString().length)):Y(y(S,2)))},[S,n]);const p=o=>{let i={0:50,10:45,12:40,14:35},P=0;for(let C=0;C<Object.keys(i).length;C++)o.length>=parseInt(Object.keys(i)[C])&&(P=i[Object.keys(i)[C]]);return P};return v("div",{className:"crypto-container",children:[v("div",{className:"crypto-header",children:[c("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),t("APPS.CRYPTO.TITLE")]}),c(b.Provider,{value:{Coins:[E,R]},children:v("div",{className:"crypto-wrapper",children:[v("div",{className:"balance",children:[v("div",{className:"title",children:[t("APPS.CRYPTO.BALANCE"),c("div",{className:"icon",onClick:()=>u(!n),children:n?c(F,{}):c($,{})})]}),c("div",{className:"amount",style:{fontSize:p(A.toString())},onClick:()=>u(!n),children:(r=e==null?void 0:e.CurrencyFormat)==null?void 0:r.replace("%s",A.toString())})]}),c("div",{className:"search",children:c(D,{placeholder:"Search Cryptocurrency",onChange:o=>l(o.target.value)})}),c(G,{search:a}),c("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const G=({search:e})=>{const[s,h]=m.useState("balance"),[S,O]=m.useState(!0),E=["Name","Graph","Balance"],[R]=m.useContext(b).Coins;return c("div",{className:"holdings",children:v("div",{className:"items",children:[c("div",{className:"item filters",children:E.map((a,l)=>v("div",{className:"filter",onClick:()=>{if(h(a.toLowerCase()),s===a.toLowerCase())return O(!S);O(!0)},children:[a,a.toLowerCase()===s&&S?c(j,{}):c(M,{})]},l))}),R.sort((a,l)=>s==="name"?S?a.name.localeCompare(l.name):l.name.localeCompare(a.name):s==="graph"?S?a.change_24h-l.change_24h:l.change_24h-a.change_24h:s==="balance"?S?(l.owned??0)*l.current_price-(a.owned??0)*a.current_price:(a.owned??0)*a.current_price-(l.owned??0)*l.current_price:0).filter(a=>a.name.toLowerCase().includes(e.toLowerCase())||a.symbol.toLowerCase().includes(e.toLowerCase())).map((a,l)=>c(V,{data:a},l))]})})},V=({data:e})=>{const[s,h]=m.useState(!1),[S,O]=m.useState(""),[E,R]=m.useContext(b).Coins,a=(d,n)=>{var u,p;if(n>((p=(u=g.value)==null?void 0:u.CryptoLimit)==null?void 0:p.Buy))return L("warning","Amount is too high, cancelling request (MAX 1,000,000)");n>1?N("Crypto",{action:"buy",coin:d,amount:n}).then(r=>{if(r!=null&&r.success)return R(o=>o.map(i=>i.id===d?{...i,owned:(i.owned??0)+n/i.current_price,value:(i.value??0)+n,invested:(i.invested??0)+n}:i));r!=null&&r.msg&&setTimeout(()=>{T.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${r.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{T.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.BUY").toLowerCase(),currency:g.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},l=(d,n,u)=>{var p,r;if(n>((r=(p=g.value)==null?void 0:p.CryptoLimit)==null?void 0:r.Sell))return L("warning","Amount is too high, cancelling request (MAX 1,000,000)");u>0?N("Crypto",{action:"sell",coin:d,amount:u}).then(o=>{if(o!=null&&o.success)return R(i=>i.map(P=>P.id===d?{...P,owned:(P.owned??0)-n/P.current_price,value:(P.value??0)+n,invested:(P.invested??0)-n}:P));o!=null&&o.msg&&setTimeout(()=>{T.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${o.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{T.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.SELL").toLowerCase(),currency:g.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},A=(d,n,u,p)=>{u>0?N("Crypto",{action:"transfer",coin:d,amount:u,number:p}).then(r=>{r!=null&&r.success&&setTimeout(()=>{T.PopUp.set({title:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.TITLE"),description:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.DESCRIPTION").format({amount:n,coin:e.symbol,number:H(p)}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]}),R(o=>o.map(i=>i.id===d?{...i,owned:(i.owned??0)-n/i.current_price,value:(i.value??0)+n,invested:(i.invested??0)-n}:i))},250),r!=null&&r.msg&&setTimeout(()=>{T.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${r.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{T.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.TRANSFER").toLowerCase(),currency:g.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),v("div",{className:"item",onClick:()=>h(!s),children:[v("div",{className:"top",children:[v("div",{className:"info",children:[c("img",{src:e.image,className:"icon",alt:"Icon"}),v("div",{className:"coin",children:[c("div",{className:"name",children:e.symbol}),c("div",{className:"symbol",children:e.name})]})]}),c(W,{data:e}),v("div",{className:"amount",children:[c("div",{className:"value",children:Y(y(e.owned,4))}),v("div",{className:"asset",children:["$",Y(y(e.value,2))]})]})]}),c(w,{children:s&&v(f.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[c(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:d=>{var n,u,p,r,o,i,P;d.stopPropagation(),T.PopUp.set({title:t("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",max:((p=(u=(n=g.value)==null?void 0:n.CryptoLimit)==null?void 0:u.Buy)==null?void 0:p.toString())??"1000000",maxLength:((P=(i=(o=(r=g.value)==null?void 0:r.CryptoLimit)==null?void 0:o.Buy)==null?void 0:i.toString())==null?void 0:P.length)+2,onChange:C=>O(C)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{O(C=>(a(e.id,parseFloat(C)),C))}}]})},children:t("APPS.CRYPTO.BUY")}),c(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:d=>{var n,u,p,r,o,i,P;d.stopPropagation(),T.PopUp.set({title:t("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",max:((p=(u=(n=g.value)==null?void 0:n.CryptoLimit)==null?void 0:u.Sell)==null?void 0:p.toString())??"1000000",maxLength:((P=(i=(o=(r=g.value)==null?void 0:r.CryptoLimit)==null?void 0:o.Sell)==null?void 0:i.toString())==null?void 0:P.length)+2,onChange:C=>O(C)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{O(C=>{let U=parseFloat(C),I=U/e.current_price;return l(e.id,U,I),C})}}]})},children:t("APPS.CRYPTO.SELL")}),c(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button blue",onClick:d=>{d.stopPropagation(),T.PopUp.set({title:t("APPS.CRYPTO.TRANSFER_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.TRANSFER_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>O(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.TRANSFER_POPUP.NEXT"),cb:()=>{O(n=>{let u=parseFloat(n),p=u/e.current_price;return T.ContactSelector.set({onSelect:r=>{if(!r)return L("warning","No contact selected? Cancelling request");A(e.id,u,p,r.number)}}),n})}}]})},children:t("APPS.CRYPTO.TRANSFER")}),c(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:d=>{d.stopPropagation(),T.PopUp.set({title:t("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:e.symbol,amount:e.owned*e.current_price}),buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),color:"red",cb:()=>{let n=e.owned*e.current_price;l(e.id,n,e.owned)}}]})},children:t("APPS.CRYPTO.SELL_ALL")})]})})]})},W=e=>{if(!(e!=null&&e.data.prices))return null;let s=e.data.prices;const h=m.useRef(null),[S,O]=m.useState(null),[E,R]=m.useState(null);return s=s.slice(0,24),m.useEffect(()=>{if(!(h!=null&&h.current))return;const a=h.current;a.width=150,a.height=100;const l=a.getContext("2d");l.lineWidth=3;const A=Math.min(...s),n=Math.max(...s)-A,u=a.height-10;let p=0,r=a.height-5-(s[0]-A)/n*u;l.beginPath(),l.moveTo(p,r);const o=s[s.length-1]-s[0]>0?"green":"red";l.strokeStyle=o;for(let C=1;C<s.length;C++)p+=a.width/(s.length-1),r=a.height-5-(s[C]-A)/n*u,l.lineTo(p,r);l.stroke();const i=(s[s.length-1]-s[0])/s[0]*100;i>0?O(`<div style="color: var(--phone-color-green)">+${y(i,2)}%</div>`):i<0?O(`<div style="color: var(--phone-color-red)">${y(i,2)}%</div>`):O(`<div>${y(i,2)}%</div>`);let P=(e.data.value-e.data.invested)/e.data.invested*100;P>0?R(`<div style="color: var(--phone-color-green)">+${y(P,2)}%</div>`):P<0&&R(`<div style="color: var(--phone-color-red)">${y(P,2)}%</div>`)},[h,s]),c(X,{text:`$${y(e.data.current_price,2)} ${S??""} ${E??""}`,children:c("canvas",{ref:h})})};export{K as default};
