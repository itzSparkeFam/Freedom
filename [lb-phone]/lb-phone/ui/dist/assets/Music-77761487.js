import{r as m,u as E,E as _,p as M,j as a,m as D,a as e,I as x,C as w,L as h,x as O,A as V,b0 as R,b$ as I,aw as y,O as q,Q as L,c0 as F,b7 as Y,d as k,bF as j,bG as H,aA as B,P as T,aB as W,bf as X,q as G,b2 as z,c1 as Q,bM as J,c2 as K,y as Z,w as ee,N as te}from"./index-594e1857.js";function se(){const{Data:f,Playlist:A}=m.useContext(U),n=E(V),[t,P]=A,[u,s]=f,[o,l]=m.useState([]);m.useEffect(()=>{_("Music")&&M("Music",{action:"getPlaylists"}).then(r=>{r&&l(r.map(i=>({...i,Songs:i.Songs.map(c=>{var d;let v=u.Songs.find(g=>g.Path===c);return{...v,Cover:((d=u.Albums[v==null?void 0:v.Album])==null?void 0:d.Cover)??(v==null?void 0:v.Cover),Path:c}})})))})},[n==null?void 0:n.active]);const S=(r,i)=>{!r||!i||M("Music",{action:"addSong",id:r,song:i}).then(c=>{c&&P(null)})};return a(D.div,{className:"add-playlist-container",initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:1,y:"100%"},children:[e("div",{className:"music-header",children:e("div",{className:"left",children:e(x,{onClick:()=>P(null)})})}),e("div",{className:"music-body",children:e("div",{className:"library",children:o.map((r,i)=>a("div",{className:"playlist",onClick:()=>{r.Songs.includes(t.Path)?w.PopUp.set({title:h("APPS.MUSIC.SONG_EXISTS_POPUP.TITLE"),description:h("APPS.MUSIC.SONG_EXISTS_POPUP.DESCRIPTION"),buttons:[{title:h("APPS.MUSIC.SONG_EXISTS_POPUP.CANCEL")}]}):S(r.Id,t.Path)},children:[a("div",{className:"playlist-details",children:[r.Cover?e("img",{src:r.Cover}):r.Songs.length>0?e("div",{className:"playlist-cover","data-grid":r.Songs.filter(c=>c.Cover).length>=4,children:r.Songs.filter(c=>c.Cover).length>=4?r.Songs.filter((c,v)=>v<4).map((c,v)=>e("img",{src:c.Cover})):e("img",{src:r.Songs[0].Cover})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),a("div",{className:"text",children:[e("div",{className:"title",children:r.Title}),a("div",{className:"subtitle",children:[r.Songs.length," ",h("APPS.MUSIC.SONGS").toLowerCase()]})]})]}),e(O,{})]},i))})})]})}function ie(){const{View:f,SelectedData:A,Func:n}=m.useContext(U),t=E(I),[P,u]=f,[s]=A;return e("div",{className:"slide left",children:e("div",{className:"music-body",children:a("div",{className:"artist-profile",children:[a("div",{className:"avatar",style:{backgroundImage:`url(${s.Avatar})`},children:[e("div",{className:"top",children:e(x,{onClick:()=>u("search")})}),e("div",{className:"title",children:s.Name})]}),a("div",{className:"category",children:[a("div",{className:"title",children:[h("APPS.MUSIC.SONGS"),e(O,{})]}),e("section",{children:s.songs.map((o,l)=>{var r;let S=((r=t==null?void 0:t.song)==null?void 0:r.Path)===o.Path;return a("div",{className:"song","data-playing":S,onClick:()=>{n.play({song:o,queue:[...s.songs.filter((i,c)=>c>l)]})},children:[a("div",{className:"song-info",children:[e("img",{src:o.Cover??"./assets/img/icons/music/unknown.png",alt:""}),a("div",{className:"text",children:[e("div",{className:"title",children:o.Title}),o.Album&&e("div",{className:"subtitle",children:o.Album})]})]}),e(R,{onClick:i=>{i.stopPropagation(),n.setContext(o)}})]},l)})})]}),a("div",{className:"category",children:[a("div",{className:"title",children:[h("APPS.MUSIC.ALBUMS"),e(O,{})]}),e("section",{className:"albums",children:s.albums.map((o,l)=>a("div",{className:"album",onClick:()=>{n.fetchAndSet(o.Title,"Albums")},children:[e("img",{src:o.Cover,alt:""}),e("div",{className:"title",children:o.Title})]},l))})]})]})})})}function ne(){const{Func:f,Data:A}=m.useContext(U),n=E(V),[t,P]=m.useState(""),[u]=A,[s,o]=m.useState(null);return m.useEffect(()=>{_("Music")&&M("Music",{action:"getPlaylists"}).then(l=>{l&&o(l.map(S=>({...S,Songs:S.Songs.map(r=>{var c;let i=u.Songs.find(v=>v.Path===r);return{...i,Cover:((c=u.Albums[i==null?void 0:i.Album])==null?void 0:c.Cover)??(i==null?void 0:i.Cover),Path:r}})})))})},[n==null?void 0:n.active]),a("div",{className:"slide right",children:[e("div",{className:"music-header",children:a("div",{className:"space",children:[e("div",{className:"title",children:h("APPS.MUSIC.LIBRARY")}),e(y,{onClick:()=>{w.PopUp.set({title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.TITLE"),description:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.DESCRIPTION"),input:{placeholder:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.PLACEHOLDER"),type:"text",minCharacters:1,onChange:l=>P(l)},buttons:[{title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.CANCEL")},{title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.PROCEED"),cb:()=>{P(l=>(M("Music",{action:"createPlaylist",name:l}).then(S=>{S&&o(r=>[...r,{id:S,Title:l,Songs:[]}])}),l))}}]})}})]})}),e("div",{className:"music-body",children:e("div",{className:"library",children:s&&s.map((l,S)=>a("div",{className:"playlist",onClick:()=>f.fetchAndSet(l,"playlist",!0),children:[a("div",{className:"playlist-details",children:[l.Cover?e("img",{src:l.Cover}):l.Songs.length>0?e("div",{className:"playlist-cover","data-grid":l.Songs.filter(r=>r.Cover).length>=4,children:l.Songs.filter(r=>r.Cover).length>=4?l.Songs.filter((r,i)=>i<4).map((r,i)=>e("img",{src:r.Cover})):e("img",{src:l.Songs[0].Cover})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),a("div",{className:"text",children:[e("div",{className:"title",children:l.Title}),a("div",{className:"subtitle",children:[l.Songs.length," songs"]})]})]}),e(O,{})]},S))})})]})}function ae(){var l,S,r,i;const{View:f,Player:A}=m.useContext(U),n=E(I),[t,P]=f,[u,s]=A;let o=[{icon:e(L,{}),value:"library",label:h("APPS.MUSIC.LIBRARY")},{icon:e(F,{}),value:"search",label:h("APPS.MUSIC.SEARCH")}];return a("div",{className:"music-footer",children:[a("div",{className:"music-playing",onClick:()=>{n&&s(!0)},children:[a("div",{className:"song-info",children:[e("img",{src:((l=n==null?void 0:n.song)==null?void 0:l.Cover)??"./assets/img/icons/music/unknown.png",alt:""}),a("div",{className:"text",children:[e("div",{className:"title",children:((S=n==null?void 0:n.song)==null?void 0:S.Title)??h("APPS.MUSIC.NOT_PLAYING")}),((r=n==null?void 0:n.song)==null?void 0:r.Artist)&&e("div",{className:"subtitle",children:(i=n==null?void 0:n.song)==null?void 0:i.Artist})]})]}),e("div",{className:"controls",onClick:c=>{c.stopPropagation(),n&&I.patch({playing:!n.playing})},children:n&&n.playing?e(q,{}):e(L,{})})]}),e("div",{className:"items",children:o.map((c,v)=>a("div",{className:"item","data-active":t===c.value,onClick:()=>P(c.value),children:[c.icon,c.label]},v))})]})}function le(){var v,d,g,C;const{View:f,Player:A}=m.useContext(U),n=E(T.Settings),t=E(I),[P,u]=A,[s,o]=m.useState(!1),[l,S]=m.useState(null),[r,i]=m.useState("rgb(170, 170, 170)");m.useEffect(()=>{var N;t&&((N=t==null?void 0:t.song)!=null&&N.Cover)&&Y(t.song.Cover).then(p=>{p&&i(`
                    linear-gradient(0deg,
                        ${p.dominant} 0%,
                        ${p.average} 50%,
                        ${p.muted} 100%
                    )
                `)})},[(v=t==null?void 0:t.song)==null?void 0:v.Cover]);const c=N=>{if(!N)return"0:00";let p=Math.floor(N/60),b=Math.floor(N-p*60),$=b<10?"0"+b:b;return p+":"+$};return a(D.div,{className:"music-player",style:{background:r},initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{duration:.3},children:[e("div",{className:"music-player-header",onClick:()=>u(!1)}),a("div",{className:"music-player-body",children:[e("img",{className:"cover",src:((d=t==null?void 0:t.song)==null?void 0:d.Cover)??"./assets/img/icons/music/unknown.png"}),a("div",{className:"song-info",children:[e("div",{className:"title",children:((g=t==null?void 0:t.song)==null?void 0:g.Title)??h("APPS.MUSIC.NOT_PLAYING")}),e("div",{className:"subtitle",children:((C=t==null?void 0:t.song)==null?void 0:C.Artist)??""})]}),a("div",{className:"duration",children:[e(k,{type:"range",min:0,max:100,value:t?l||((t==null?void 0:t.current)??0/(t==null?void 0:t.duration)??0)*100:0,style:{background:t!=null&&t.current?`linear-gradient(to right, rgb(255, 255, 255) 0%, rgb(255, 255, 255) ${Math.floor(l||t.current/t.duration*100)}%, rgba(255, 255, 255, 0.3) ${Math.floor(l||t.current/t.duration*100)}%, rgba(255, 255, 255, 0.3) 100%)`:"rgba(255, 255, 255, 0.3)"},onMouseDown:()=>o(!0),onMouseUp:N=>{o(!1),l&&t&&(t.goTo(t.duration/100*l),S(null))},onChange:N=>S(N.target.value)}),a("div",{className:"time",children:[e("div",{className:"current",children:c(l?(t==null?void 0:t.duration)/100*l:t==null?void 0:t.current)}),e("div",{className:"total",children:c(t==null?void 0:t.duration)})]})]}),a("div",{className:"controls",children:[e(j,{onClick:()=>t==null?void 0:t.previous()}),e("div",{className:"play",onClick:()=>{t&&I.patch({playing:!t.playing})},children:t!=null&&t.playing?e(q,{}):e(L,{})}),e(H,{onClick:()=>t==null?void 0:t.next()})]}),a("div",{className:"volume",children:[e(B,{}),e(k,{type:"range",min:0,max:1,step:.05,style:{background:`linear-gradient(to right, rgb(255, 255, 255) 0%, rgb(255, 255, 255) ${n.sound.volume*100}%, rgba(255, 255, 255, 0.3) ${n.sound.volume*100}%, rgba(255, 255, 255, 0.3) 100%)`},value:n.sound.volume,onChange:N=>{T.Settings.patch({sound:{...T.Settings.value.sound,volume:N.target.value}})}}),e(W,{})]})]})]})}function re(){const{View:f,SelectedData:A,Func:n}=m.useContext(U),t=E(I),[P,u]=f,[s,o]=A,[l]=m.useState(!!s.Artist),[S,r]=m.useState(!1);return a("div",{className:"slide left",children:[e("div",{className:"music-header",children:a("div",{className:"space",children:[e(x,{onClick:()=>s.Artist?u("search"):u("library")}),!l&&(S?e(X,{onClick:()=>{M("Music",{action:"editPlaylist",id:s.Id,title:s.Title,cover:s.Cover}).then(i=>{if(!i)return G("warning","Failed to edit playlist");r(!1)})}}):e(z,{onClick:i=>{i.stopPropagation(),w.ContextMenu.set({buttons:[{title:h("APPS.MUSIC.EDIT_PLAYLIST"),cb:()=>r(!0)},{title:h("APPS.MUSIC.DELETE_PLAYLIST"),color:"red",cb:()=>{M("Music",{action:"deletePlaylist",id:s.Id}).then(c=>{c&&u("library")})}}]})}}))]})}),e("div",{className:"music-body",children:a("div",{className:"playlist-wrapper",children:[a("div",{className:"playlist-details",children:[a("div",{className:"cover-wrapper",style:{cursor:S?"pointer":"default"},onClick:()=>{S&&w.Gallery.set({onSelect(i){o({...s,Cover:i.src})}})},children:[s.Cover?e("img",{src:s.Cover}):s.Songs.length>0?e("div",{className:"playlist-cover","data-grid":s.Songs.filter(i=>i.Cover).length>=4,children:s.Songs.filter(i=>i.Cover).length>=4?s.Songs.filter((i,c)=>c<4).map((i,c)=>e("img",{src:i.Cover})):e("img",{src:s.Songs[0].Cover??"./assets/img/icons/music/unknown.png"})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),a("div",{className:"actions",children:[S&&e(Q,{}),S&&s.Cover&&e(J,{onClick:i=>{i.stopPropagation(),o({...s,Cover:null})}})]})]}),a("div",{className:"text",children:[S?e(k,{defaultValue:s.Title,onChange:i=>{if(i.target.value.length>30)return i.target.value=i.target.value.slice(0,30);o({...s,Title:i.target.value})}}):e("div",{className:"title",children:s.Title}),e("div",{className:"subtitle",children:l?s.Artist:`${Object.keys(s.Songs).length} ${h("APPS.MUSIC.SONGS").toLowerCase()}`})]}),a("div",{className:"buttons",children:[a("div",{className:"button",onClick:()=>{n.play({song:s.Songs[0],queue:[...s.Songs.filter((i,c)=>c>0)]})},children:[e(L,{})," ",h("APPS.MUSIC.PLAY")]}),a("div",{className:"button",onClick:()=>{n.play({song:s.Songs[Math.floor(Math.random()*s.Songs.length)],queue:[...s.Songs.filter((i,c)=>c>0)].sort(()=>Math.random()-.5)})},children:[e(K,{}),h("APPS.MUSIC.SHUFFLE")]})]})]}),e("div",{className:"playlist-tracks",children:s.Songs.map((i,c)=>{var d;let v=((d=t==null?void 0:t.song)==null?void 0:d.Path)===i.Path;return a("div",{className:"track","data-album":l,"data-playing":v,onClick:()=>{n.play({song:i,queue:[...s.Songs.filter((g,C)=>C>c)]})},children:[a("div",{className:"track-info",children:[S&&e(Z,{onClick:g=>{g.stopPropagation(),w.PopUp.set({title:h("APPS.MUSIC.REMOVE_SONG_POPUP.TITLE"),description:h("APPS.MUSIC.REMOVE_SONG_POPUP.DESCRIPTION"),buttons:[{title:h("APPS.MUSIC.REMOVE_SONG_POPUP.CANCEL")},{title:h("APPS.MUSIC.REMOVE_SONG_POPUP.PROCEED"),color:"red",cb:()=>{M("Music",{action:"removeSong",id:s.Id,song:i.Path}).then(C=>{C&&o({...s,Songs:s.Songs.filter((N,p)=>p!==c)})})}}]})}}),l?e("div",{className:"index",children:c+1}):e("img",{src:i.Cover??"./assets/img/icons/music/unknown.png"}),a("div",{className:"text",children:[e("div",{className:"title",children:i.Title}),e("div",{className:"subtitle",children:l?s.Artist:i.Artist})]})]}),e(R,{onClick:g=>{g.stopPropagation(),n.setContext(i)}})]},c)})})]})})]})}function oe(){const{Func:f,Data:A}=m.useContext(U),n=E(I),[t,P]=m.useState(""),[u]=A;return a("div",{className:"slide right",children:[e("div",{className:"music-header",children:a("div",{className:"search",children:[e("div",{className:"title",children:h("APPS.MUSIC.SEARCH")}),e(ee,{placeholder:h("APPS.MUSIC.SEARCH_PLACEHOLDER"),onChange:s=>P(s.target.value)})]})}),e("div",{className:"music-body",children:e("div",{className:"search-results",children:t.length>0&&Object.keys(u).map(s=>Object.keys(u[s]).filter(o=>{switch(s){case"Artists":return o.toLowerCase().includes(t.toLowerCase());case"Albums":return o.toLowerCase().includes(t.toLowerCase());case"Songs":return u[s][o].Title.toLowerCase().includes(t.toLowerCase())}}).map((o,l)=>{var r;let S;return s==="Songs"&&(S=((r=n==null?void 0:n.song)==null?void 0:r.Path)===u[s][o].Path),a("div",{className:"item","data-playing":S,onClick:()=>{s==="Songs"?f.play({song:u[s][o],queue:[...u.Songs.filter((i,c)=>u[s][o].Path!==i.Path&&c>l)]}):f.fetchAndSet(o,s)},children:[a("div",{className:"item-info",children:[e("img",{src:(s==="Artists"?u[s][o].Avatar:u[s][o].Cover)??"./assets/img/icons/music/unknown.png","data-artist":s==="Artists"}),a("div",{className:"text",children:[e("div",{className:"title",children:s==="Songs"?u[s][o].Title:o}),a("div",{className:"subtitle",children:[s==="Artists"&&h("APPS.MUSIC.ARTIST"),s==="Albums"&&`${h("APPS.MUSIC.ALBUM")} • ${u[s][o].Artist}`,s==="Songs"&&`${h("APPS.MUSIC.SONG")} • ${u[s][o].Artist}`]})]})]}),e("div",{className:"item-actions",children:s==="Songs"?e(R,{onClick:i=>{i.stopPropagation(),f.setContext(u[s][o])}}):e(O,{})})]})}))})})]})}const ce={Artists:[],Albums:[],Songs:{"music.mp3":{Title:"Like That",Artist:"Future",Cover:"https://townsquare.media/site/812/files/2024/03/attachment-future-metro-boomin-we-dont-trust-you-photo.jpg?w=1080&q=75"}}};const U=m.createContext(null);function ue(){const[f,A]=m.useState("search"),[n,t]=m.useState(null),[P,u]=m.useState(null),[s,o]=m.useState(!1),[l,S]=m.useState(null),r={search:e(oe,{}),artist:e(ie,{}),library:e(ne,{}),playlist:e(re,{})},i=(d,g,C)=>{if(d&&!(!n[g]&&!C))if(g==="Albums"){let N=Object.keys(n.Songs).filter(p=>n.Songs[p].Album===d).map(p=>n.Songs[p]);u({...n[g][d],Songs:N,Title:d}),A("playlist")}else if(g==="Artists"){let N=Object.keys(n.Songs).filter(b=>n.Songs[b].Artist===d).map(b=>n.Songs[b]),p=Object.keys(n.Albums).filter(b=>n.Albums[b].Artist===d).map(b=>({...n.Albums[b],Title:b}));u({...n[g][d],Name:d,songs:N,albums:p}),A("artist")}else g==="playlist"&&(u(d),A("playlist"))},c=d=>{var g,C;!d||!d.song||(I.value?I.patch({playing:!0,song:d.song,queue:d.queue??((g=I.value)==null?void 0:g.queue)??[]}):I.set({playing:!0,song:d.song,queue:d.queue??((C=I.value)==null?void 0:C.queue)??[]}))},v=d=>{if(!d)return G("warning","No song data found, can't set context menu.");let g=[{title:h("APPS.MUSIC.ADD_QUEUE"),color:null,cb:()=>{I.patch({queue:[...I.value.queue,d]})}},{title:h("APPS.MUSIC.ADD_PLAYLIST"),color:null,cb:()=>{S(d)}}];P&&(P!=null&&P.IsOwner)&&g.push({title:h("APPS.MUSIC.REMOVE_SONG"),color:"red",cb:()=>{M("Music",{action:"removeSong",id:P.Id,song:d.Path}).then(C=>{C&&u(N=>{let p=N.Songs.filter(b=>b.Path!==d.Path);return{...N,Songs:p}})})}}),w.ContextMenu.set({buttons:g})};return m.useEffect(()=>{_("Music")&&M("Music",{action:"getConfig"},ce).then(d=>{if(!d)return;let g=Object.keys(d.Songs).map(C=>({...d.Songs[C],Cover:d.Songs[C].Album&&d.Albums[d.Songs[C].Album]?d.Albums[d.Songs[C].Album].Cover:d.Songs[C].Cover,Path:C}));t({...d,Songs:g})})},[]),e("div",{className:"music-container",children:a(U.Provider,{value:{View:[f,A],Data:[n,t],SelectedData:[P,u],Player:[s,o],Playlist:[l,S],Func:{fetchAndSet:i,play:c,setContext:v}},children:[a(te,{initial:!1,children:[s&&e(le,{}),l&&e(se,{})]}),r[f],e(ae,{})]})})}export{U as MusicContext,ue as default};
