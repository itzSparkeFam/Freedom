import{u as N,r as v,E as $,p as C,q as f,a as t,F as y,j as i,L as a,m as O,c3 as Se,k as z,bv as Pe,C as b,c4 as Ee,aw as ue,bZ as pe,b as Y,_,I as he,f as M,a0 as Ce,d as ve,bR as J,a4 as Ie,t as te,K as Ne,a7 as ae,a8 as ge,A as q,ac as K,P as U,w as fe,e as ne,g as be,h as ce,D as se,H as X,i as re,bu as le,c5 as Ae,c6 as ie,N as de,az as Oe,S as me,$ as Re,x as Le,c7 as Te}from"./index-594e1857.js";import{S as oe}from"./Switch-ffaa3cda.js";const k={companies:[{job:"police",name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png",canCall:!0,canMessage:!0,bossRanks:["boss","lieutenant"],open:!0,location:{name:"Mission Row",coords:{x:428.9,y:-984.5}}},{job:"ambulance",name:"Ambulance",icon:"https://cdn-icons-png.flaticon.com/128/1032/1032989.png",canCall:!0,canMessage:!0,bossRanks:["boss","doctor"],open:!0,location:{name:"Pillbox",coords:{x:304.2,y:-587}}},{job:"mechanic",name:"Mechanic",icon:"https://cdn-icons-png.flaticon.com/128/10281/10281554.png",canCall:!0,canMessage:!0,bossRanks:["boss","worker"],open:!1,location:{name:"LS Customs",coords:{x:-336.6,y:-134.3}}},{job:"taxi",name:"Taxi",icon:"https://cdn-icons-png.flaticon.com/128/433/433449.png",canCall:!0,canMessage:!0,bossRanks:["boss","driver"],open:!1,location:{name:"Taxi HQ",coords:{x:984.2,y:-219}}}],company:{job:"police",duty:!0,receiveCalls:!0,isBoss:!0,balance:1e6,employees:[{id:1,name:"Breze",grade:1,gradeLabel:"Officer",canInteract:!0,online:!0},{id:2,name:"Loaf Scripts",grade:2,gradeLabel:"Sergeant",canInteract:!0,online:!0},{id:3,name:"Kash",grade:3,gradeLabel:"Lieutenant",canInteract:!0,online:!1}],grades:[{label:"Officer",grade:1},{label:"Sergeant",grade:2},{label:"Lieutenant",grade:3},{label:"Captain",grade:4}]},messageList:[{id:"1",lastMessage:"Is anyone available to help me?",sender:"Breze",number:"1234567890",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*2},{id:"2",lastMessage:"Hello, how can i help you?",sender:"Loaf Scripts",number:"4802940940",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*4},{id:"3",lastMessage:"Hey, i need backup at the bank",sender:"Sally",number:"2051440412",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*24*2}],messages:{1:[{id:"1",sender:"1234567890",content:"Is anyone available to help me?",timestamp:Date.now()-1e3*60*60*2},{id:"2",sender:"1234567323",content:"Hey, a unit is on its way to your location",timestamp:Date.now()-1e3*60*60*24*2},{id:"3",sender:"1234567890",content:"i'd like to report a crime, i'm at the pier",timestamp:Date.now()-1e3*60*60*24*2}],2:[{id:"1",sender:"4802940940",content:"Hey, can you help me?",timestamp:Date.now()-1e3*60*60*4},{id:"2",sender:"4802940940",content:"I need a unit to my location",timestamp:Date.now()-1e3*60*60*24*5},{id:"3",sender:"4802940940",content:"I need backup at the bank",timestamp:Date.now()-1e3*60*60*24*9}],3:[{id:"1",sender:"2051440412",content:"is there any way you have any job positions available?",timestamp:Date.now()-1e3*60*60*24*2},{id:"2",sender:"2051440412",content:"hello?",timestamp:Date.now()-1e3*60*60*24*4},{id:"3",sender:"2051440412",content:"hey, i have a question",timestamp:Date.now()-1e3*60*60*24*5}]},employees:[{firstname:"John",lastname:"Doe",grade:1,gradeLabel:"Officer",number:"1234567890",online:!0},{firstname:"Loaf",lastname:"Scripts",grade:2,gradeLabel:"Sergeant",number:"4802940940",online:!0},{firstname:"Kash",grade:3,gradeLabel:"Lieutenant",number:"2051440412",online:!1},{firstname:"Sally",grade:4,gradeLabel:"Captain",number:"1234567323",online:!0}]};function ye(){var S,E,o,u,p,A,c,g,D,H,j,x,P;const e=N(Y),n=N(I),[l,m]=v.useState(null);v.useEffect(()=>{$("Services")&&C("Services",{action:"getCompany"},k.company).then(s=>{if(!s)return f("warning","Failed to fetch company data");I.set(s)})},[]);const r=()=>{b.PopUp.set({title:a("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:a("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:a("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:s=>{m(s)},type:"number"},buttons:[{title:a("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:a("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{m(s=>{/^\d+$/.test(s)&&C("Services",{action:"depositMoney",amount:parseInt(s)},parseInt(s)+n.balance).then(h=>{if(typeof h!="number")return f("warning","Balance is not a number, not updating");I.patch({balance:h})})})}}]})},d=()=>{b.PopUp.set({title:a("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:a("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:a("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:s=>{m(s)},type:"number"},buttons:[{title:a("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:a("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{m(s=>{if(/^\d+$/.test(s)){if(n.balance-parseInt(s)<0){b.PopUp.set({title:a("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:a("APPS.SERVICES.WITHDRAW_POPUP.NOT_ENOUGH_MONEY").format({amount:s}),buttons:[{title:a("APPS.SERVICES.WITHDRAW_POPUP.PROCEED")}]});return}C("Services",{action:"withdrawMoney",amount:parseInt(s)},n.balance-parseInt(s)).then(h=>{if(typeof h!="number")return f("warning","Balance is not a number, not updating");I.patch({balance:h})})}})}}]})};return t(y,{children:n!=null&&n.job?i("div",{className:"actions-container",children:[t("div",{className:"category-title",children:a("APPS.SERVICES.SETTINGS")}),t("section",{children:i(y,{children:[n.duty!==void 0&&((E=(S=e==null?void 0:e.Companies)==null?void 0:S.Management)==null?void 0:E.Duty)!==!1&&i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[t(Se,{className:"orange"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:a("APPS.SERVICES.DUTY")}),t("div",{className:"description",children:a("APPS.SERVICES.DUTY_DESCRIPTION")})]})]}),t("div",{className:"item-value",children:t(oe,{checked:n.duty,onChange:()=>{C("Services",{action:"toggleDuty",duty:!n.duty},!0).then(()=>{var s;return I.patch({duty:!((s=I.value)!=null&&s.duty)})})}})})]}),(n.duty===void 0||n.duty===!0)&&i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[t(z,{className:"green"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:a("APPS.SERVICES.JOB_CALLS")}),i("div",{className:"description",children:[" ",a("APPS.SERVICES.JOB_CALLS_DESCRIPTION").format({toggle:n.receiveCalls?a("APPS.SERVICES.DISABLE"):a("APPS.SERVICES.ENABLE")})]})]})]}),t("div",{className:"item-value",children:t(oe,{checked:n.receiveCalls,onChange:()=>{C("Services",{action:"toggleCalls"},!n.receiveCalls).then(s=>{I.patch({receiveCalls:s})})}})})]})]})}),n.isBoss&&i(y,{children:[t("div",{className:"category-title",children:a("APPS.SERVICES.ACTIONS")}),i("section",{children:[i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[i("div",{className:"item-data",children:[t(Pe,{className:"green"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:a("APPS.SERVICES.BALANCE")}),t("div",{className:"description",children:"Current balance of the company"})]})]}),t("div",{className:"item-value",children:e.CurrencyFormat.replace("%s",(o=n.balance)==null?void 0:o.toLocaleString())})]}),(((p=(u=e==null?void 0:e.Companies)==null?void 0:u.Management)==null?void 0:p.Deposit)!==!1||((c=(A=e==null?void 0:e.Companies)==null?void 0:A.Management)==null?void 0:c.Withdraw)!==!1)&&i("div",{className:"item",children:[((D=(g=e==null?void 0:e.Companies)==null?void 0:g.Management)==null?void 0:D.Deposit)!==!1&&t("div",{className:"button",onClick:r,children:a("APPS.SERVICES.DEPOSIT_POPUP.TITLE")}),((j=(H=e==null?void 0:e.Companies)==null?void 0:H.Management)==null?void 0:j.Withdraw)!==!1&&t("div",{className:"button",onClick:d,children:a("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]}),t("div",{className:"category-title",children:a("APPS.SERVICES.MANAGE_EMPLOYEES")}),i("section",{children:[((P=(x=e==null?void 0:e.Companies)==null?void 0:x.Management)==null?void 0:P.Hire)!==!1&&i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{b.PopUp.set({title:a("APPS.SERVICES.HIRE_POPUP.TITLE"),description:a("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:a("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:s=>{m(s)}},buttons:[{title:a("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:a("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{m(s=>{if(/^\d+$/.test(s))return C("Services",{action:"hireEmployee",source:parseInt(s)},{id:s,name:"Joe Doe"}).then(h=>{var R,w;h&&I.patch({employees:[...(R=I.value)==null?void 0:R.employees,{id:h.id,name:h.name,grade:0,gradeLabel:(w=I.value)==null?void 0:w.grades[0].label,canInteract:!0}]})}),""})}}]})},children:[i("div",{className:"item-data",children:[t(Ee,{className:"blue"}),i("div",{className:"item-info",children:[t("div",{className:"title",children:a("APPS.SERVICES.HIRE")}),t("div",{className:"description",children:a("APPS.SERVICES.HIRE_POPUP.DESCRIPTION")})]})]}),t("div",{className:"item-value",children:t(ue,{})})]}),n.employees.map((s,h)=>i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{var w,Q,Z,ee;if(!s.canInteract||e.Companies.Management.Fire===!1&&e.Companies.Management.Promote===!1)return;const R=[((Q=(w=e==null?void 0:e.Companies)==null?void 0:w.Management)==null?void 0:Q.Promote)!==!1&&{title:a("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{b.ContextMenu.set({buttons:[...n.grades.map(L=>({title:L.label,cb:()=>{C("Services",{action:"setGrade",employee:s.id,grade:L.grade},!0).then(F=>{var G;if(!F)return f("warning","Failed to set grade");I.patch({employees:(G=I.value)==null?void 0:G.employees.map(W=>(W.id===s.id&&(W.grade=L.grade,W.gradeLabel=L.label),W))})})}}))]})},300)}},((ee=(Z=e==null?void 0:e.Companies)==null?void 0:Z.Management)==null?void 0:ee.Fire)!==!1&&{title:a("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{b.PopUp.set({title:a("APPS.SERVICES.FIRE_POPUP.TITLE"),description:a("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:s.name}),buttons:[{title:a("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:a("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{C("Services",{action:"fireEmployee",employee:s.id},!0).then(L=>{var F;if(!L)return f("warning","Failed to fire employee");I.patch({employees:(F=I.value)==null?void 0:F.employees.filter(G=>G.id!==s.id)})})}}]})}}];b.ContextMenu.set({buttons:R.filter(L=>L)})},children:[i("div",{className:"item-data",children:[t(pe,{}),i("div",{className:"item-info",children:[t("div",{className:"title",children:s.name}),i("div",{className:"description",children:[" ",s.gradeLabel]})]})]}),t("div",{className:"item-value",children:t("div",{className:"status","data-online":s.online})})]},h))]})]})]}):t("div",{className:"no-job",children:a("APPS.SERVICES.UNEMPLOYED")})})}function De(){const e=N(U.Settings),n=N(U.PhoneNumber),l=N(T),[m,r]=v.useState(0),[d,S]=v.useState(!1),[E,o]=v.useState(!1),[u,p]=v.useState([]),A=v.useRef(null),[c,g]=v.useState({content:"",attachments:[]});v.useEffect(()=>{$("Services")&&C("Services",{action:"getMessages",page:0,id:l.id,company:l.job},k.messages[l.id]).then(P=>{if(P&&P.length>0){p([...P.reverse()]);let s=document.querySelector(".chat-container");s.scrollTop=s.scrollHeight}else S(!0)})},[]);const D=()=>{if(c.content.length>0){let P={sender:n,id:l.id,company:l.job,content:c.content,timestamp:new Date};if(e.airplaneMode)return p(s=>[...s,{...P,delivered:!1}]);C("Services",{action:"sendMessage",...P},!0).then(s=>{s||f("error","Failed to send message"),p(h=>[...h,{...P,delivered:s}]),g({content:"",attachments:[]}),A.current.value=""})}},H=()=>{b.PopUp.set({title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{C("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(P=>{if(!P)return f("error","Failed to get location");let s={sender:n,content:`<!SENT-LOCATION-X=${te(P.x,2)}Y=${te(P.y,2)}!>`,attachments:[],id:l.id,company:l.job,timestamp:new Date};C("Services",{action:"sendMessage",...s},!0).then(h=>{p(h?R=>[...R,s]:R=>[...R,{...s,delivered:!1}])})})}}]})},j=()=>{if(d||E)return;let P=document.querySelector("#last");if(!P)return;!Ne(P)&&(o(!0),C("Services",{action:"getMessages",page:m+1,id:l.id,company:l.job},null).then(h=>{h&&h.length>0?(p([...h.reverse(),...u]),o(!1),h.length<25&&S(!0)):S(!0)}),r(h=>h+1))};_("services:newMessage",P=>{if(l.id!==P.channelId||P.sender===n||e.airplaneMode)return;p([...u,{...P,timestamp:new Date}]);let s=document.querySelector(".chat-container");s.scrollTop=s.scrollHeight});const x=P=>{if(P)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(P)};return i(y,{children:[i("div",{className:"chat-header",children:[t("div",{className:"back",onClick:()=>{V.set("messages"),T.reset()},children:t(he,{})}),i("div",{className:"user",children:[t("img",{src:l.icon??`./assets/img/avatar-placeholder-${e.display.theme}.svg`,className:"avatar"}),t("div",{className:"name",children:l.company??M(l.number)})]}),t(Ce,{className:"hidden"})]}),t("div",{className:"chat-container",onScroll:j,children:t("div",{className:"chat-body",children:u.map((P,s)=>t(Me,{index:s,messages:u,message:P,func:{isLocation:x}}))})}),t("div",{className:"chat-bottom",children:i("div",{className:"input",children:[t(ve,{placeholder:a("APPS.MESSAGES.PLACEHOLDER"),ref:A,value:c.content,onChange:P=>{g({content:P.target.value,attachments:c.attachments})},onKeyDown:P=>{P.key=="Enter"&&D()}}),i("div",{className:"buttons",children:[t("div",{className:"location",children:t(J,{onClick:H})}),c.content.length>0&&t("div",{className:"send",onClick:D,children:t(Ie,{})})]})]})})]})}const Me=({messages:e,message:n,index:l,func:m})=>{var c;const r=N(U.PhoneNumber),d=N(T);let S,E,o,u=l===0?"last":"",p=n.sender===r?"self":"other",A=((c=e[l+1])==null?void 0:c.sender)===r?"self":"other";if(e[l+1]?E=Math.abs(n.timestamp-e[l+1].timestamp)/36e5:A=void 0,m.isLocation(n.content)){let g=n.content.match(/X=(-?\d*\.?\d*)Y/)[1],D=n.content.match(/Y=(-?\d*\.?\d*)!>/)[1];o={x:g,y:D}}return i("div",{className:`message ${p}`,id:u,"data-id":n.id,children:[S,n.delivered===!1?i("div",{className:"content-wrapper",children:[t("div",{className:"content",children:ae(n.content)}),t(ge,{})]}):o?i("div",{className:"location",onClick:()=>{q.patch({active:{name:"Maps",data:{location:[o.y,o.x],name:`${M(n.sender)}'s location`,icon:d.icon}}})},children:[t("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),p==="other"&&i("div",{className:"sender",children:[M(n.sender)," ",a("APPS.MESSAGES.SENT_LOCATION")]})]}):n.content&&t("div",{className:"content",children:ae(n.content)}),n.delivered===!1?t("div",{className:"status",children:a("APPS.MESSAGES.NOT_DELIVERED")}):e[l+1]&&E>6?t("div",{className:"date",children:K(n.timestamp)}):p!==A&&t("div",{className:"date",children:K(n.timestamp)})]},l)},B=X(null);function Ve(){var S,E;const e=N(B),[n,l]=v.useState("all"),[m,r]=v.useState(""),d=o=>{if(!o)return f("error","No number provided");b.PopUp.set({title:a("APPS.SERVICES.CALL_POPUP.TITLE"),description:a("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:M(o)}),buttons:[{title:a("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:a("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let u=se(o);re({...u,number:o})}}]})};return i(O.div,{initial:{opacity:0,y:250},animate:{opacity:1,y:0},exit:{opacity:0,y:250},transition:{duration:.2,ease:"easeInOut"},className:"employee-list",children:[i("div",{className:"employee-list-header",children:[t("div",{className:"close",onClick:()=>B.set(null)}),t("div",{className:"selector",children:["all","available"].map((o,u)=>t("div",{className:"option","data-active":n===o,onClick:()=>l(o),children:a(`APPS.SERVICES.${o.toUpperCase()}`)},u))}),t(fe,{placeholder:a("APPS.SERVICES.SEARCH_EMPLOYEES"),onChange:o=>r(o.target.value)})]}),t("div",{className:"employee-list-body",children:(E=(S=e==null?void 0:e.filter(o=>(n==="all"?!0:o.online)&&ne(o.firstname,o.lastname).toLowerCase().includes(m.toLowerCase())))==null?void 0:S.sort((o,u)=>u.grade-o.grade))==null?void 0:E.map((o,u)=>i(O.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"employee-item",children:[i("div",{className:"user",children:[t("div",{className:"avatar",children:be(o.firstname,o.lastname)}),i("div",{className:"info",children:[ne(o.firstname,o.lastname),t("span",{children:o.gradeLabel})]})]}),t("div",{className:"buttons",children:i(y,{children:[t(z,{className:o.online&&o.number?"green":"red",onClick:()=>d(o.number)}),t(ce,{className:o.online&&o.number?"green":"red",onClick:()=>{if(!o.number)return f("error","No number provided");let p=se(o.number);q.patch({active:{name:"Messages",data:{number:o.number,name:p==null?void 0:p.name,avatar:p==null?void 0:p.avatar,view:"messages"}}})}})]})})]},u))})]})}function we(){var m;const[e,n]=v.useState([]),l=(m=N(q))==null?void 0:m.active;return v.useEffect(()=>{$("Services")&&C("Services",{action:"getCompanies"},k.companies).then(r=>{if(!r)return f("warning","Failed to fetch companies");n(r)})},[l]),_("services:updateOpen",r=>{if(!r)return;const{job:d,open:S}=r;n(E=>{const o=E.findIndex(u=>u.job===d);return o===-1?E:(E[o].open=S,[...E])})}),t(y,{children:t("div",{className:"companies-list",children:e.sort((r,d)=>r.open&&!d.open?-1:!r.open&&d.open?1:0).map(r=>t(_e,{company:r},r.name))})})}const _e=({company:e})=>{var o,u,p,A;const n=N(Y),l=()=>{C("Services",{action:"getEmployees",company:e.job},k.employees).then(c=>{if(!c)return f("warning","You do not have permission to view employees.");B.set(c)})},[m,r]=v.useState(!1),d=c=>{var g;!((g=c==null?void 0:c.location)!=null&&g.coords)||!c.name||q.patch({active:{name:"Maps",data:{location:[c.location.coords.y,c.location.coords.x],name:c.name,icon:c.icon}}})},S=(c,g)=>{n.Companies.Enabled&&b.PopUp.set({title:a("APPS.SERVICES.CALL_POPUP.TITLE"),description:a("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:Oe(c)}),buttons:[{title:a("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:a("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{re({company:c,companylabel:g})}}]})},E=c=>{C("Services",{action:"getChannelId",company:c.job},"1").then(g=>{if(!g)return f("error","Failed to get channel id");T.set({icon:c.icon,company:c.name,job:c.job,id:g}),V.set("chat")})};return i("div",{className:"item",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),"data-open":e.open,onClick:l,children:[i("div",{className:"info",children:[e.icon&&t("div",{className:"icon",children:t("img",{src:e.icon})}),i("div",{className:"company-details",children:[t("div",{className:"title",children:e.name}),i("div",{className:"location",children:[t(le,{}),(o=e.location)==null?void 0:o.name]})]})]}),e.open?i("div",{className:"actions",children:[e.customIcon&&t("div",{className:"custom-icon",onClick:c=>{c.stopPropagation(),C("Services",{action:"customIconClick",company:e.job})},children:Ae[e.customIcon]()}),((u=e.location)==null?void 0:u.coords)&&t(J,{className:"orange",onClick:c=>{c.stopPropagation(),d(e)}}),((p=n.Companies)==null?void 0:p.Enabled)!==!1&&e.canCall!==!1&&t(z,{className:"green",onClick:c=>{c.stopPropagation(),S(e.job,e.name)}}),e.canMessage!==!1&&t(ie,{className:"green",onClick:c=>{c.stopPropagation(),E(e)}})]}):i(y,{children:[i("div",{className:"actions",onMouseEnter:()=>r(!1),onMouseLeave:()=>r(!0),children:[((A=e.location)==null?void 0:A.coords)&&t(J,{className:"orange",onClick:c=>{c.stopPropagation(),d(e)}}),e.canMessage!==!1&&n.Companies.MessageOffline&&t(ie,{className:"green",onClick:c=>{c.stopPropagation(),E(e)}})]}),t(de,{children:m&&t(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"closed",children:a("APPS.SERVICES.CLOSED")})})]})]},e.name)};function Ue(){const e=N(U.PhoneNumber),[n,l]=v.useState({personal:[],job:[]}),[m,r]=v.useState("personal");return v.useEffect(()=>{$("Services")&&C("Services",{action:"getRecentMessages",page:0},k.messageList).then(d=>{if(!d)return f("warning","No recent messages found");l({personal:[...d.filter(S=>S.number===e)],job:[...d.filter(S=>S.number!==e)]})})},[]),_("services:channelDeleted",d=>{if(!d)return f("error","No channel ID provided");l({personal:n.personal.filter(S=>S.id!==d),job:n.job.filter(S=>S.id!==d)})}),t(y,{children:i("div",{className:"company-messages-container",children:[t("div",{className:"company-messages-header",children:t("div",{className:"selector",children:["personal","job"].map((d,S)=>t("div",{className:"option","data-active":m===d,onClick:()=>r(d),children:a(`APPS.SERVICES.${d.toUpperCase()}`)},S))})}),t(O.section,{...me(m==="personal"?"right":"left",m,.2),children:(n==null?void 0:n[m])&&(n==null?void 0:n[m].map((d,S)=>t(ke,{channel:d,type:m},S)))})]})})}const ke=({channel:e,type:n})=>{var d,S;const l=N(U.Settings),m=Re(()=>{var E;(E=Y)!=null&&E.value.Companies.DeleteConversations&&n!=="personal"&&b.ContextMenu.set({buttons:[{title:a("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),color:"red",cb:()=>{setTimeout(()=>{b.PopUp.set({title:a("APPS.MESSAGES.DELETE_CONVERSATION.TITLE"),description:a("APPS.MESSAGES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:a("APPS.MESSAGES.DELETE_CONVERSATION.CANCEL")},{title:a("APPS.MESSAGES.DELETE_CONVERSATION.DELETE"),color:"red",cb:()=>{C("Services",{action:"deleteChannel",id:e.id},!0).then(o=>{if(!o)return f("error","Failed to delete channel, deleteChannel returned false")})}}]})},100)}}]})}),r=E=>{if(E)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(E)};return i("div",{...m,className:"item",onClick:()=>{var E,o,u;T.set({...T==null?void 0:T.value,id:e.id,icon:n==="personal"&&((E=e==null?void 0:e.company)!=null&&E.icon)?e.company.icon:`./assets/img/avatar-placeholder-${l.display.theme}.svg`,company:n==="personal"&&((o=e==null?void 0:e.company)!=null&&o.name)?e.company.name:M(e.number),job:(u=e.company)==null?void 0:u.job,number:e.number}),V.set("chat")},children:[n==="personal"&&((d=e==null?void 0:e.company)!=null&&d.icon)?t("img",{src:e.company.icon}):t("img",{src:`./assets/img/avatar-placeholder-${l.display.theme}.svg`}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[t("div",{className:"user",children:n==="personal"&&((S=e==null?void 0:e.company)!=null&&S.name)?e.company.name:M(e.number)}),i("div",{className:"right",children:[t("div",{className:"time",children:K(e.timestamp)}),t(Le,{})]})]}),t("div",{className:"message",children:r(e.lastMessage)?a("APPS.MESSAGES.SENT_LOCATION_SHORT"):e.lastMessage})]})]})};function He(){const e=N(Y),n=N(V),[l,m]=v.useState([{icon:t(le,{}),title:a("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:t(ce,{}),title:a("APPS.SERVICES.MESSAGES"),value:"messages"}]);return v.useEffect(()=>{var r,d;((d=(r=e==null?void 0:e.Companies)==null?void 0:r.Management)==null?void 0:d.Enabled)!==!1&&m([...l,{icon:t(Te,{}),title:a("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),t("div",{className:"companies-footer",children:l.map((r,d)=>i("div",{className:"item","data-active":n===r.value,onClick:()=>V.set(r.value),children:[r.icon,r.title]},d))})}const V=X("companies"),T=X(null),I=X(null);function Fe(){const e=N(V),n=N(B),l={companies:t(we,{}),actions:t(ye,{}),messages:t(Ue,{}),chat:t(De,{})};let m={actions:a("APPS.SERVICES.ACTIONS"),messages:a("APPS.SERVICES.MESSAGES"),companies:a("APPS.SERVICES.COMPANIES")};return _("services:setCompany",r=>I.set(r)),_("services:setDuty",r=>I.patch({duty:r})),i("div",{className:"companies-container","data-view":e,children:[t(de,{children:n&&t(Ve,{})}),i(O.div,{...me(e==="chat"?"left":"right",e,.2),className:"companies-wrapper",children:[e!=="chat"&&t("div",{className:"companies-header",children:t("div",{className:"title",children:m[e]})}),t("div",{className:"companies-body",children:l[e]})]}),e!=="chat"&&t(He,{})]})}export{I as CompanyData,T as Data,V as View,Fe as default};
