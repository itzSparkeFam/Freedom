const _0x1fab63=_0x3465;!function(){for(var n=_0x3465,e=_0x13d5();;)try{if(931485==+parseInt(n(530))*(-parseInt(n(622))/2)+parseInt(n(592))/3+-parseInt(n(624))/4+parseInt(n(434))/5+-parseInt(n(608))/6+parseInt(n(565))/7*(parseInt(n(482))/8)+parseInt(n(442))/9*(parseInt(n(613))/10))break;e.push(e.shift())}catch(n){e.push(e.shift())}}();import{Post,getOwnedObjects}from"./api.js";import*as _0x61a051 from"three";import{TransformControls}from"three/addons/controls/TransformControls.js";let decorateMenu=null,editable=!1,editingData={};function setDecorateMenu(n){decorateMenu=n}function _0x3465(n,e){const t=_0x13d5();return(_0x3465=function(n,e){return n-=434,t[n]})(n,e)}const tracking={x:0,y:0},objectInfos={},furniData={prevY:[],prevX:[],prevZ:[],prevPitch:[],prevRoll:[],prevYaw:[]};let isTransforming=!1,editingId=null;const degToRad=n=>{var e=_0x3465,t={iBeee:function(n,e){return n*e},PhzxQ:function(n,e){return n/e}};return t[e(640)](n,t[e(620)](Math.PI,180))},radToDeg=n=>{var e=_0x3465,t={OgmZz:function(n,e){return n*e},wwnpX:function(n,e){return n/e}};return t[e(456)](n,t[e(514)](180,Math.PI))},selectLegacyObject=async n=>{var e=_0x3465,t={tzLWq:function(n,e){return n!=e},zJhaz:function(n,e){return n==e},WqFTr:function(n){return n()},yaIrn:function(n,e){return n==e},GDoLG:function(n,e){return n<e},BGEco:function(n,e){return n!=e}};if(t[e(572)](decorateMenu,null)&&t[e(629)](decorateMenu[e(458)],1)){var a=await t[e(584)](getOwnedObjects);if(!t[e(457)](a[decorateMenu[e(580)][e(497)+"u"][e(437)]][e(555)],n)){for(var r=null,o=0;t[e(463)](o,a[e(531)]);o++)if(t[e(457)](a[o][e(555)],n)){r=o;break}t[e(627)](r,null)&&(decorateMenu[e(580)][e(497)+"u"][e(437)]=r),decorateMenu[e(580)][e(497)+"u"][e(458)]()}}},mouseDownHandler=async n=>{var e=_0x3465,t={rAomm:function(n,e){return n&&e},FRmaM:function(n,e){return n!==e},WPfKk:e(525),EPvmf:function(n,e,t){return n(e,t)},MHeKL:e(645)+e(626),QHMru:function(n,e){return n!=e},CYbFv:function(n,e){return n==e},xCbMJ:function(n){return n()},nhqLc:function(n,e){return n<e},NYZvP:function(n,e){return n==e},CTppp:function(n){return n()},vHGly:function(n,e){return n(e)},dIpGF:e(556),PhYAU:function(n){return n()},awdYt:function(n,e){return n!=e}};if(!(isTransforming=!t[e(484)](isTransforming,!editingId)&&isTransforming)&&!t[e(509)](n[e(439)][e(511)],t[e(586)])){var n=tracking.x,a=tracking.y,r=await t[e(522)](Post,t[e(455)],{x:n,y:a});if(r[e(515)]&&t[e(509)](editingId,r[e(581)]))if(t[e(483)](decorateMenu,null)&&t[e(546)](decorateMenu[e(458)],1)){var o=await t[e(550)](getOwnedObjects);if(!t[e(546)](o[decorateMenu[e(580)][e(497)+"u"][e(437)]][e(555)],r[e(581)])){for(var i=null,c=0;t[e(436)](c,o[e(531)]);c++)if(t[e(563)](o[c][e(555)],r[e(581)])){i=c;break}t[e(483)](i,null)&&(decorateMenu[e(580)][e(497)+"u"][e(437)]=i),decorateMenu[e(580)][e(497)+"u"][e(458)]()}}else t[e(490)](clearData),editingId=r[e(581)],t[e(527)](changeEntity,editingId),isTransforming=!1;else if(!r[e(515)]){var u=t[e(517)][e(631)]("|");let n=0;for(;;){switch(u[n++]){case"0":t[e(493)](clearData);continue;case"1":if(t[e(440)](decorateMenu,null)&&t[e(546)](decorateMenu[e(458)],1))return;continue;case"2":isTransforming=!1;continue;case"3":transformControls[e(559)]=!1;continue;case"4":editingId=null;continue}break}}}},handleTracking=(window[_0x1fab63(619)+_0x1fab63(641)](_0x1fab63(470),mouseDownHandler),n=>{var e=_0x1fab63,t={mDwus:function(n,e){return n-e},QmjFd:function(n,e,t){return n(e,t)}},a=t[e(601)](n[e(538)],n[e(439)][e(452)]),n=t[e(601)](n[e(590)],n[e(439)][e(452)]);tracking.x=t[e(510)](normalize,a,document[e(597)+e(466)][e(587)+"h"]),tracking.y=t[e(510)](normalize,n,document[e(597)+e(466)][e(450)+"ht"])}),Scene=new _0x61a051[_0x1fab63(646)],Renderer=new _0x61a051[_0x1fab63(602)+_0x1fab63(535)]({alpha:!0}),Camera=(Renderer[_0x1fab63(616)](window[_0x1fab63(611)],window[_0x1fab63(569)+"t"]),document[_0x1fab63(579)+_0x1fab63(518)](_0x1fab63(488))[_0x1fab63(564)+"d"](Renderer[_0x1fab63(489)]),new _0x61a051[_0x1fab63(596)+_0x1fab63(523)](50,window[_0x1fab63(611)]/window[_0x1fab63(569)+"t"],.1,1e4)),boxGeometry=(Camera[_0x1fab63(468)][_0x1fab63(506)]=_0x1fab63(526),new _0x61a051[_0x1fab63(574)+"y"](1,1,1)),meshPhongMaterial=new _0x61a051[_0x1fab63(542)+_0x1fab63(435)]({color:16711935,transparent:!0,opacity:0}),Mesh=new _0x61a051[_0x1fab63(460)](boxGeometry,meshPhongMaterial);Mesh[_0x1fab63(468)][_0x1fab63(506)]=_0x1fab63(526),Mesh[_0x1fab63(445)][_0x1fab63(513)](1,1,1),Scene[_0x1fab63(480)](Mesh),Renderer[_0x1fab63(489)][_0x1fab63(562)][_0x1fab63(604)]=_0x1fab63(642);let animationFrameActive=null;function renderGeometry(){var n=_0x1fab63;animationFrameActive={kYFgd:function(n,e){return n(e)}}[n(545)](requestAnimationFrame,renderGeometry),Renderer[n(512)](Scene,Camera)}function showGeometry(){var n=_0x1fab63,e={PqtOR:n(578)};transformControls[n(559)]=!1,Renderer[n(489)][n(562)][n(604)]=e[n(505)]}function hideGeometry(){var n=_0x1fab63,e={qQlrR:n(642)};transformControls[n(559)]=!1,Renderer[n(489)][n(562)][n(604)]=e[n(444)]}function hideTransformControls(){var n=_0x1fab63;transformControls[n(559)]=!1}const transformControls=new TransformControls(Camera,Renderer[_0x1fab63(489)]),editEntity=(transformControls[_0x1fab63(619)+_0x1fab63(641)](_0x1fab63(539),()=>{var n=_0x1fab63,e={xfzuR:function(n,e){return n(e)},HeGrs:function(n,e){return n(e)},RIopF:function(n){return n()}},t=objectInfos[editingId];Mesh[n(634)].x&&Mesh[n(634)].y&&Mesh[n(634)].z&&t&&(t.x=Mesh[n(634)].x,t.y=-Mesh[n(634)].z,t.z=Mesh[n(634)].y,t[n(632)]=e[n(448)](radToDeg,Mesh[n(468)].x),t[n(644)]=e[n(471)](radToDeg,-Mesh[n(468)].z),t[n(485)]=e[n(471)](radToDeg,Mesh[n(468)].y),e[n(491)](editEntity),Renderer[n(512)](Scene,Camera))}),()=>{var n=_0x1fab63,e={XApZf:function(n,e,t){return n(e,t)},zVElt:n(595)+"y",RGVIf:function(n,e){return n(e)},RLvLz:function(n,e){return n(e)}},t=objectInfos[editingId];e[n(504)](Post,e[n(547)],{id:editingId,alpha:e[n(534)](parseInt,t[n(575)]),x:e[n(475)](parseFloat,t.x),y:e[n(534)](parseFloat,t.y),z:e[n(475)](parseFloat,t.z),pitch:e[n(534)](parseFloat,t[n(632)]),roll:e[n(534)](parseFloat,t[n(644)]),yaw:e[n(475)](parseFloat,t[n(485)])}),e[n(534)](setObjectHelperValues,t)}),storeData=(transformControls[_0x1fab63(619)+_0x1fab63(641)](_0x1fab63(617),()=>{var n=_0x1fab63;isTransforming=!0,{vZOcF:function(n){return n()}}[n(599)](storeData)}),transformControls[_0x1fab63(619)+_0x1fab63(641)](_0x1fab63(496),()=>{var n=_0x1fab63,e=objectInfos[editingId];e&&(e.x=Mesh[n(634)].x,e.y=-Mesh[n(634)].z,e.z=Mesh[n(634)].y,isTransforming=!1)}),transformControls[_0x1fab63(536)+_0x1fab63(549)](.1),transformControls[_0x1fab63(616)](.8),transformControls[_0x1fab63(459)+_0x1fab63(498)](degToRad(15)),transformControls[_0x1fab63(573)](Mesh),Scene[_0x1fab63(480)](transformControls),()=>{var e=_0x1fab63,t={SEEXx:function(n,e){return n!==e},aRaoh:function(n,e){return n!==e},DFdBw:e(623)+"2"},a=objectInfos[editingId];if(a&&t[e(566)](a.x,0)&&t[e(566)](a.y,0)&&t[e(467)](a.z,0)){var r=t[e(503)][e(631)]("|");let n=0;for(;;){switch(r[n++]){case"0":furniData[e(593)][e(502)](a[e(644)]);continue;case"1":furniData[e(451)][e(502)](a.x);continue;case"2":furniData[e(472)][e(502)](a[e(485)]);continue;case"3":furniData[e(594)][e(502)](a.z);continue;case"4":furniData[e(577)][e(502)](a[e(632)]);continue;case"5":furniData[e(618)][e(502)](a.y);continue}break}}});function cancelRenderGeometry(){var n=_0x1fab63;animationFrameActive&&({PLXlw:function(n,e){return n(e)}}[n(567)](cancelAnimationFrame,animationFrameActive),animationFrameActive=null)}function setEditMode(n){var e=_0x1fab63,t={oJChh:function(n,e){return n===e},zhhbj:e(551),QzzVf:e(500)};t[e(636)](n,t[e(606)])?transformControls[e(508)](t[e(606)]):transformControls[e(508)](t[e(521)])}function setRotationSnap(n){var e=_0x1fab63;transformControls[e(459)+e(498)](n)}function setTranslationSnap(n){var e=_0x1fab63;transformControls[e(536)+e(549)](n)}const normalize=(n,e)=>{var t=_0x1fab63,a={NaAxG:function(n,e){return n+e},ErrFM:function(n,e){return n/e},nfusq:function(n,e){return n*e},ldDOy:function(n,e){return n-e},ajxpr:function(n,e){return n-e}};return a[t(628)](a[t(494)](a[t(553)](1,a[t(625)](n,0)),a[t(453)](e,0)),0)},handleUpdatePositions=(window[_0x1fab63(619)+_0x1fab63(641)](_0x1fab63(633),handleTracking),n=>{var e=_0x1fab63,t={lYGHQ:function(n,e){return n(e)},cYXsl:function(n,e){return n(e)},sZpwd:function(n,e,t){return n(e,t)},vWgjo:function(n,e){return n(e)},jyeqe:function(n,e){return n(e)},ChlFF:function(n,e){return n(e)}},a=(Camera[e(634)][e(513)](n[e(438)][e(634)].x,n[e(438)][e(634)].z,-n[e(438)][e(634)].y),n[e(438)][e(468)].x),r=n[e(438)][e(468)].z,o=n[e(438)][e(468)].y;Camera[e(468)][e(513)](t[e(473)](degToRad,a),t[e(598)](degToRad,t[e(479)](zRotationHandler,a,r)),t[e(524)](degToRad,o)),Camera[e(474)]=n[e(438)][e(474)],Camera[e(449)+e(607)+"ix"](),n[e(581)][e(634)]&&(Mesh[e(634)][e(513)](n[e(581)][e(634)].x,n[e(581)][e(634)].z,-n[e(581)][e(634)].y),Mesh[e(468)][e(513)](t[e(552)](degToRad,n[e(581)][e(468)].x),t[e(598)](degToRad,n[e(581)][e(468)].z),t[e(476)](degToRad,-n[e(581)][e(468)].y)))});function _0x13d5(){const n=["setRotatio","Mesh","bFpyq","ty-y","GDoLG","DSuJE","y_info","ement","aRaoh","rotation","INbpV","mousedown","HeGrs","prevYaw","lYGHQ","fov","RLvLz","ChlFF","NzfXU","0|0|7|11|1","sZpwd","add","5|4","72ZfXNrX","QHMru","rAomm","yaw","oHjlu","TKSJf","#decorate","domElement","CTppp","RIopF","ty-yaw","PhYAU","ErrFM","load_entit","mouseUp","sortingMen","nSnap","eAvXt","translate","TbvJd","push","DFdBw","XApZf","PqtOR","order","HFPiQ","setMode","FRmaM","QmjFd","tagName","render","set","wwnpX","hit","UlcAZ","dIpGF","tor","ty-roll","inDUu","QzzVf","EPvmf","eCamera","vWgjo","CANVAS","YZX","vHGly","ZKaeD","ty-z","209063ugUzzw","length","ty-pitch","ewdNB","RGVIf","rer","setTransla","key","pageX","change","|2|8|13","exists","MeshPhongM","ect","BsVTB","kYFgd","CYbFv","zVElt","kxuAr","tionSnap","xCbMJ","rotate","jyeqe","nfusq","lper #enti","handle","1|0|4|3|2","toggleCurs","ipHsq","visible","#object-he","3|14|4|12|","style","NYZvP","appendChil","250915sIezRl","SEEXx","PLXlw","distance","innerHeigh","hetwy","lper #mode","tzLWq","attach","BoxGeometr","alpha","PYKFi","prevPitch","block","querySelec","categories","entity","jbAsP","ty-x","WqFTr","YsciU","WPfKk","scrollWidt","6|5|9|15|1","val","pageY","amBiJ","1620441pAPGSP","prevRoll","prevZ","edit_entit","Perspectiv","documentEl","cYXsl","vZOcF","2|5|0|1|4|","mDwus","WebGLRende","Jhned","display","LffsO","zhhbj","ectionMatr","648282EhvzUj","uVdlQ","toggleMous","innerWidth","IBsja","5451530nBsavH","hJGFV","DLzMQ","setSize","mouseDown","prevY","addEventLi","PhzxQ","l-name","10lErZKD","1|5|3|4|0|","6165680WHCyNo","ldDOy","ity","BGEco","NaAxG","zJhaz","keydown","split","pitch","mousemove","position","ground_obj","oJChh","QoKUU","wICwb","hash","iBeee","stener","none","eMovement","roll","select_ent","Scene","8366045PrUGRx","aterial","nhqLc","stash","cam","target","awdYt","WHGmd","18OaJMzm","3|1|0|2|6|","qQlrR","scale","IBSSe","XfEee","xfzuR","updateProj","scrollHeig","prevX","offsetTop","ajxpr","DLJfM","MHeKL","OgmZz","yaIrn","sort"];return(_0x13d5=function(){return n})()}const changeEntity=async n=>{var e=_0x1fab63,t={Jhned:function(n,e,t){return n(e,t)},WHGmd:e(495)+e(465),inDUu:function(n,e){return n(e)},hetwy:function(n,e){return n(e)}},n=await t[e(603)](Post,t[e(441)],{id:t[e(520)](parseInt,n)});t[e(570)](setEntityData,n)},zRotationHandler=(n,e)=>{var t=_0x1fab63,a={oHjlu:function(n,e){return e<n},INbpV:function(n,e){return n<e},TbvJd:function(n,e){return e<n},wICwb:function(n,e){return n<e}};return(!a[t(486)](n,0)||!a[t(469)](n,90))&&(a[t(501)](n,-180)&&a[t(638)](n,-90)||a[t(501)](n,0))?-e:e},setEntityData=n=>{var e=_0x1fab63,t={TKSJf:e(561)+e(588)+e(478)+e(540),DLzMQ:function(n,e){return n(e)},PYKFi:function(n,e){return n!==e},jbAsP:function(n){return n()}},a=t[e(487)][e(631)]("|");let r=0;for(;;){switch(a[r++]){case"0":editingData.z=n.z;continue;case"1":editingData[e(485)]=n[e(485)];continue;case"2":editingData[e(568)]=n[e(568)];continue;case"3":if(n[e(541)])continue;return editable=!1,void(transformControls[e(559)]=!1);case"4":editable=!0;continue;case"5":editingData[e(639)]=n[e(639)];continue;case"6":objectInfos[editingId]={id:n.id,hash:n[e(639)],alpha:n[e(575)],x:n.x,y:n.y,z:n.z,pitch:n[e(632)],roll:n[e(644)],yaw:n[e(485)],distance:n[e(568)],quaternion:{}};continue;case"7":editingData[e(632)]=n[e(632)];continue;case"8":transformControls[e(559)]=!0;continue;case"9":editingData[e(575)]=n[e(575)];continue;case"10":editingData.y=n.y;continue;case"11":editingData[e(644)]=n[e(644)];continue;case"12":editingId=n.id;continue;case"13":t[e(615)](setObjectHelperValues,n);continue;case"14":t[e(576)](editingId,n.id)&&t[e(582)](clearData);continue;case"15":editingData.x=n.x;continue}break}},setObjectHelperValues=n=>{var e=_0x1fab63,t={NzfXU:e(443)+e(481),hJGFV:function(n,e){return n(e)},LffsO:e(560)+e(554)+e(462),uVdlQ:e(560)+e(554)+e(583),amBiJ:function(n,e){return n(e)},BsVTB:e(560)+e(554)+e(529),XfEee:e(560)+e(571)+e(621),eAvXt:function(n,e){return n(e)},DSuJE:e(560)+e(554)+e(492),QoKUU:function(n,e){return n(e)},kxuAr:e(560)+e(554)+e(519),DLJfM:e(560)+e(554)+e(532)},a=t[e(477)][e(631)]("|");let r=0;for(;;){switch(a[r++]){case"0":t[e(614)]($,t[e(605)])[e(589)](n.y);continue;case"1":t[e(614)]($,t[e(609)])[e(589)](n.x);continue;case"2":t[e(591)]($,t[e(544)])[e(589)](n.z);continue;case"3":t[e(591)]($,t[e(447)])[e(589)](n[e(639)]);continue;case"4":t[e(499)]($,t[e(464)])[e(589)](n[e(485)]);continue;case"5":t[e(637)]($,t[e(548)])[e(589)](n[e(644)]);continue;case"6":t[e(614)]($,t[e(454)])[e(589)](n[e(632)]);continue}break}},clearData=()=>{var n=_0x1fab63,e={HFPiQ:n(600)+"3"}[n(507)][n(631)]("|");let t=0;for(;;){switch(e[t++]){case"0":furniData[n(594)]=[];continue;case"1":furniData[n(577)]=[];continue;case"2":furniData[n(618)]=[];continue;case"3":furniData[n(472)]=[];continue;case"4":furniData[n(593)]=[];continue;case"5":furniData[n(451)]=[];continue}break}};window[_0x1fab63(619)+_0x1fab63(641)](_0x1fab63(630),async n=>{var e=_0x1fab63,t={IBsja:function(n,e){return n===e},ipHsq:function(n,e){return n(e)},YsciU:e(610)+e(643),UlcAZ:function(n,e){return n===e},bFpyq:e(557)+"or",IBSSe:function(n,e){return n===e},ewdNB:function(n,e,t){return n(e,t)},ZKaeD:e(635)+e(543)};t[e(612)](n[e(537)],"F6")&&t[e(558)](Post,t[e(585)]),t[e(516)](n[e(537)],"F5")&&t[e(558)](Post,t[e(461)]),(t[e(446)](n[e(537)],"G")||t[e(446)](n[e(537)],"g"))&&(n=await t[e(533)](Post,t[e(528)],{id:t[e(558)](parseInt,editingId)}),t[e(558)](setEntityData,n))});export{setDecorateMenu,selectLegacyObject,renderGeometry,showGeometry,hideGeometry,hideTransformControls,cancelRenderGeometry,setEditMode,setRotationSnap,setTranslationSnap,handleUpdatePositions,changeEntity};